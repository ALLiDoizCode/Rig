X-Ratelimit-Reset: 1769189499
X-Ratelimit-Resource: core
X-Github-Request-Id: 545E:1E338F:1CE3DD7:199617C:6973A26B
Content-Type: application/json; charset=utf-8
Etag: W/"f4096a477bafdefb5addb2cef527544dd7d154491e9fc135eec41a153aee699e"
X-Accepted-Github-Permissions: issues=read
X-Frame-Options: deny
X-Xss-Protection: 0
Referrer-Policy: origin-when-cross-origin, strict-origin-when-cross-origin
Content-Security-Policy: default-src 'none'
X-Ratelimit-Remaining: 4998
X-Ratelimit-Limit: 5000
X-Ratelimit-Used: 2
Cache-Control: private, max-age=60, s-maxage=60
Vary: Accept, Authorization, Cookie, X-GitHub-OTP,Accept-Encoding, Accept, X-Requested-With
Link: <https://api.github.com/repositories/68390476/issues?direction=asc&per_page=45&sort=created&state=all&after=Y3Vyc29yOnYyOpLPAAABaaHKpHDOGUReFQ%3D%3D&page=2>; rel="next"
X-Github-Api-Version-Selected: 2022-11-28
Access-Control-Expose-Headers: ETag, Link, Location, Retry-After, X-GitHub-OTP, X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Used, X-RateLimit-Resource, X-RateLimit-Reset, X-OAuth-Scopes, X-Accepted-OAuth-Scopes, X-Poll-Interval, X-GitHub-Media-Type, X-GitHub-SSO, X-GitHub-Request-Id, Deprecation, Sunset
Access-Control-Allow-Origin: *
X-Content-Type-Options: nosniff
X-Github-Media-Type: github.v3; param=squirrel-girl-preview
Strict-Transport-Security: max-age=31536000; includeSubdomains; preload

[{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/1","repository_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/1/labels{/name}","comments_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/1/comments","events_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/1/events","html_url":"https://github.com/nigoroll/libvmod-dynamic/issues/1","id":179302563,"node_id":"MDU6SXNzdWUxNzkzMDI1NjM=","number":1,"title":"What changes are needed for \"make check\" to work","user":{"login":"danielmotaleite","id":11890049,"node_id":"MDQ6VXNlcjExODkwMDQ5","avatar_url":"https://avatars.githubusercontent.com/u/11890049?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmotaleite","html_url":"https://github.com/danielmotaleite","followers_url":"https://api.github.com/users/danielmotaleite/followers","following_url":"https://api.github.com/users/danielmotaleite/following{/other_user}","gists_url":"https://api.github.com/users/danielmotaleite/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmotaleite/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmotaleite/subscriptions","organizations_url":"https://api.github.com/users/danielmotaleite/orgs","repos_url":"https://api.github.com/users/danielmotaleite/repos","events_url":"https://api.github.com/users/danielmotaleite/events{/privacy}","received_events_url":"https://api.github.com/users/danielmotaleite/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2016-09-26T18:27:04Z","updated_at":"2016-11-28T08:17:58Z","closed_at":"2016-10-04T15:36:24Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"You say `The test suite may not currently run without global (but minor) changes to your system.` , but make no reference on what to change for then to work.\n\nPlease add  some more info\n\nThanks\n","closed_by":{"login":"nigoroll","id":1528104,"node_id":"MDQ6VXNlcjE1MjgxMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1528104?v=4","gravatar_id":"","url":"https://api.github.com/users/nigoroll","html_url":"https://github.com/nigoroll","followers_url":"https://api.github.com/users/nigoroll/followers","following_url":"https://api.github.com/users/nigoroll/following{/other_user}","gists_url":"https://api.github.com/users/nigoroll/gists{/gist_id}","starred_url":"https://api.github.com/users/nigoroll/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nigoroll/subscriptions","organizations_url":"https://api.github.com/users/nigoroll/orgs","repos_url":"https://api.github.com/users/nigoroll/repos","events_url":"https://api.github.com/users/nigoroll/events{/privacy}","received_events_url":"https://api.github.com/users/nigoroll/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/1/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/1/timeline","performed_via_github_app":null,"state_reason":"completed"},{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/2","repository_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/2/labels{/name}","comments_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/2/comments","events_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/2/events","html_url":"https://github.com/nigoroll/libvmod-dynamic/issues/2","id":181296166,"node_id":"MDU6SXNzdWUxODEyOTYxNjY=","number":2,"title":"Steal packaging goodies from vmod-querystring","user":{"login":"dridi","id":891744,"node_id":"MDQ6VXNlcjg5MTc0NA==","avatar_url":"https://avatars.githubusercontent.com/u/891744?v=4","gravatar_id":"","url":"https://api.github.com/users/dridi","html_url":"https://github.com/dridi","followers_url":"https://api.github.com/users/dridi/followers","following_url":"https://api.github.com/users/dridi/following{/other_user}","gists_url":"https://api.github.com/users/dridi/gists{/gist_id}","starred_url":"https://api.github.com/users/dridi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dridi/subscriptions","organizations_url":"https://api.github.com/users/dridi/orgs","repos_url":"https://api.github.com/users/dridi/repos","events_url":"https://api.github.com/users/dridi/events{/privacy}","received_events_url":"https://api.github.com/users/dridi/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":443804424,"node_id":"MDU6TGFiZWw0NDM4MDQ0MjQ=","url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/labels/enhancement","name":"enhancement","color":"84b6eb","default":true,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/milestones/1","html_url":"https://github.com/nigoroll/libvmod-dynamic/milestone/1","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/milestones/1/labels","id":2411902,"node_id":"MDk6TWlsZXN0b25lMjQxMTkwMg==","number":1,"title":"1.0","description":null,"creator":{"login":"dridi","id":891744,"node_id":"MDQ6VXNlcjg5MTc0NA==","avatar_url":"https://avatars.githubusercontent.com/u/891744?v=4","gravatar_id":"","url":"https://api.github.com/users/dridi","html_url":"https://github.com/dridi","followers_url":"https://api.github.com/users/dridi/followers","following_url":"https://api.github.com/users/dridi/following{/other_user}","gists_url":"https://api.github.com/users/dridi/gists{/gist_id}","starred_url":"https://api.github.com/users/dridi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dridi/subscriptions","organizations_url":"https://api.github.com/users/dridi/orgs","repos_url":"https://api.github.com/users/dridi/repos","events_url":"https://api.github.com/users/dridi/events{/privacy}","received_events_url":"https://api.github.com/users/dridi/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":4,"state":"open","created_at":"2017-03-26T20:50:32Z","updated_at":"2019-07-13T16:40:27Z","due_on":null,"closed_at":null},"comments":3,"created_at":"2016-10-06T00:09:42Z","updated_at":"2018-09-12T15:22:07Z","closed_at":"2018-09-12T15:22:07Z","author_association":"COLLABORATOR","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"The current packaging was inherited from vmod-example when it still had packaging built-in. RPM packaging was maintained, but the debian stuff was left alone so I'm not even sure it works.\n\nThis module could advertise turnkey [RPM](https://github.com/Dridi/libvmod-querystring/blob/master/Makefile.am#L41-L68) and [DPKG](https://github.com/Dridi/libvmod-querystring/blob/master/Makefile.am#L70-L97) packaging directly from `make` if you have the relevant tools on your system. And that includes chroot-type builds, like for instance building for Debian Sid on a Fedora system.\n\nDebian support is still experimental in vmod-querystring, but at least it is maintained.\n","closed_by":{"login":"nigoroll","id":1528104,"node_id":"MDQ6VXNlcjE1MjgxMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1528104?v=4","gravatar_id":"","url":"https://api.github.com/users/nigoroll","html_url":"https://github.com/nigoroll","followers_url":"https://api.github.com/users/nigoroll/followers","following_url":"https://api.github.com/users/nigoroll/following{/other_user}","gists_url":"https://api.github.com/users/nigoroll/gists{/gist_id}","starred_url":"https://api.github.com/users/nigoroll/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nigoroll/subscriptions","organizations_url":"https://api.github.com/users/nigoroll/orgs","repos_url":"https://api.github.com/users/nigoroll/repos","events_url":"https://api.github.com/users/nigoroll/events{/privacy}","received_events_url":"https://api.github.com/users/nigoroll/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/2/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/2/timeline","performed_via_github_app":null,"state_reason":"completed"},{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/3","repository_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/3/labels{/name}","comments_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/3/comments","events_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/3/events","html_url":"https://github.com/nigoroll/libvmod-dynamic/issues/3","id":184464855,"node_id":"MDU6SXNzdWUxODQ0NjQ4NTU=","number":3,"title":"Building vmod on debian jessie with varnish 4.1.3 fails","user":{"login":"filidorwiese","id":864967,"node_id":"MDQ6VXNlcjg2NDk2Nw==","avatar_url":"https://avatars.githubusercontent.com/u/864967?v=4","gravatar_id":"","url":"https://api.github.com/users/filidorwiese","html_url":"https://github.com/filidorwiese","followers_url":"https://api.github.com/users/filidorwiese/followers","following_url":"https://api.github.com/users/filidorwiese/following{/other_user}","gists_url":"https://api.github.com/users/filidorwiese/gists{/gist_id}","starred_url":"https://api.github.com/users/filidorwiese/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/filidorwiese/subscriptions","organizations_url":"https://api.github.com/users/filidorwiese/orgs","repos_url":"https://api.github.com/users/filidorwiese/repos","events_url":"https://api.github.com/users/filidorwiese/events{/privacy}","received_events_url":"https://api.github.com/users/filidorwiese/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":443804424,"node_id":"MDU6TGFiZWw0NDM4MDQ0MjQ=","url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/labels/enhancement","name":"enhancement","color":"84b6eb","default":true,"description":null},{"id":443804427,"node_id":"MDU6TGFiZWw0NDM4MDQ0Mjc=","url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/labels/question","name":"question","color":"cc317c","default":true,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/milestones/1","html_url":"https://github.com/nigoroll/libvmod-dynamic/milestone/1","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/milestones/1/labels","id":2411902,"node_id":"MDk6TWlsZXN0b25lMjQxMTkwMg==","number":1,"title":"1.0","description":null,"creator":{"login":"dridi","id":891744,"node_id":"MDQ6VXNlcjg5MTc0NA==","avatar_url":"https://avatars.githubusercontent.com/u/891744?v=4","gravatar_id":"","url":"https://api.github.com/users/dridi","html_url":"https://github.com/dridi","followers_url":"https://api.github.com/users/dridi/followers","following_url":"https://api.github.com/users/dridi/following{/other_user}","gists_url":"https://api.github.com/users/dridi/gists{/gist_id}","starred_url":"https://api.github.com/users/dridi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dridi/subscriptions","organizations_url":"https://api.github.com/users/dridi/orgs","repos_url":"https://api.github.com/users/dridi/repos","events_url":"https://api.github.com/users/dridi/events{/privacy}","received_events_url":"https://api.github.com/users/dridi/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":4,"state":"open","created_at":"2017-03-26T20:50:32Z","updated_at":"2019-07-13T16:40:27Z","due_on":null,"closed_at":null},"comments":8,"created_at":"2016-10-21T11:36:47Z","updated_at":"2018-09-12T15:20:53Z","closed_at":"2018-09-12T15:20:53Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hi! I'm trying to build libvmod-dynamic on a minimum Debian Jessie environment with Varnish 4.1.3 already installed. When trying to run autogen.sh I get this error:\n\n```\n$ /root/libvmod-dynamic/autogen.sh\n+ aclocal -I m4 -I /usr/share/aclocal\n+ libtoolize --copy --force\nlibtoolize: putting auxiliary files in AC_CONFIG_AUX_DIR, `build-aux'.\nlibtoolize: copying file `build-aux/ltmain.sh'\nlibtoolize: putting macros in AC_CONFIG_MACRO_DIR, `m4'.\nlibtoolize: copying file `m4/libtool.m4'\nlibtoolize: copying file `m4/ltoptions.m4'\nlibtoolize: copying file `m4/ltsugar.m4'\nlibtoolize: copying file `m4/ltversion.m4'\nlibtoolize: copying file `m4/lt~obsolete.m4'\n+ autoheader\n+ automake --add-missing --copy --foreign\nsrc/Makefile.am:4: error: 'vmod_LTLIBRARIES' is used but 'vmoddir' is undefined\nautomake: warnings are treated as errors\nsrc/Makefile.am:6: warning: variable 'libvmod_dynamic_la_SOURCES' is defined but no program or\nsrc/Makefile.am:6: library has 'libvmod_dynamic_la' as canonical name (possible typo)\nsrc/Makefile.am:10: warning: variable 'nodist_libvmod_dynamic_la_SOURCES' is defined but no program or\nsrc/Makefile.am:10: library has 'libvmod_dynamic_la' as canonical name (possible typo)\n```\n\nI'm probably missing something obvious. Could someone point me in the right direction?\n","closed_by":{"login":"nigoroll","id":1528104,"node_id":"MDQ6VXNlcjE1MjgxMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1528104?v=4","gravatar_id":"","url":"https://api.github.com/users/nigoroll","html_url":"https://github.com/nigoroll","followers_url":"https://api.github.com/users/nigoroll/followers","following_url":"https://api.github.com/users/nigoroll/following{/other_user}","gists_url":"https://api.github.com/users/nigoroll/gists{/gist_id}","starred_url":"https://api.github.com/users/nigoroll/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nigoroll/subscriptions","organizations_url":"https://api.github.com/users/nigoroll/orgs","repos_url":"https://api.github.com/users/nigoroll/repos","events_url":"https://api.github.com/users/nigoroll/events{/privacy}","received_events_url":"https://api.github.com/users/nigoroll/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/3/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/3/timeline","performed_via_github_app":null,"state_reason":"completed"},{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/4","repository_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/4/labels{/name}","comments_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/4/comments","events_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/4/events","html_url":"https://github.com/nigoroll/libvmod-dynamic/issues/4","id":185894138,"node_id":"MDU6SXNzdWUxODU4OTQxMzg=","number":4,"title":"Fetcherror no backend connection","user":{"login":"markhowells","id":3914721,"node_id":"MDQ6VXNlcjM5MTQ3MjE=","avatar_url":"https://avatars.githubusercontent.com/u/3914721?v=4","gravatar_id":"","url":"https://api.github.com/users/markhowells","html_url":"https://github.com/markhowells","followers_url":"https://api.github.com/users/markhowells/followers","following_url":"https://api.github.com/users/markhowells/following{/other_user}","gists_url":"https://api.github.com/users/markhowells/gists{/gist_id}","starred_url":"https://api.github.com/users/markhowells/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markhowells/subscriptions","organizations_url":"https://api.github.com/users/markhowells/orgs","repos_url":"https://api.github.com/users/markhowells/repos","events_url":"https://api.github.com/users/markhowells/events{/privacy}","received_events_url":"https://api.github.com/users/markhowells/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":443804422,"node_id":"MDU6TGFiZWw0NDM4MDQ0MjI=","url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/labels/bug","name":"bug","color":"ee0701","default":true,"description":null}],"state":"closed","locked":false,"assignee":{"login":"dridi","id":891744,"node_id":"MDQ6VXNlcjg5MTc0NA==","avatar_url":"https://avatars.githubusercontent.com/u/891744?v=4","gravatar_id":"","url":"https://api.github.com/users/dridi","html_url":"https://github.com/dridi","followers_url":"https://api.github.com/users/dridi/followers","following_url":"https://api.github.com/users/dridi/following{/other_user}","gists_url":"https://api.github.com/users/dridi/gists{/gist_id}","starred_url":"https://api.github.com/users/dridi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dridi/subscriptions","organizations_url":"https://api.github.com/users/dridi/orgs","repos_url":"https://api.github.com/users/dridi/repos","events_url":"https://api.github.com/users/dridi/events{/privacy}","received_events_url":"https://api.github.com/users/dridi/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"dridi","id":891744,"node_id":"MDQ6VXNlcjg5MTc0NA==","avatar_url":"https://avatars.githubusercontent.com/u/891744?v=4","gravatar_id":"","url":"https://api.github.com/users/dridi","html_url":"https://github.com/dridi","followers_url":"https://api.github.com/users/dridi/followers","following_url":"https://api.github.com/users/dridi/following{/other_user}","gists_url":"https://api.github.com/users/dridi/gists{/gist_id}","starred_url":"https://api.github.com/users/dridi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dridi/subscriptions","organizations_url":"https://api.github.com/users/dridi/orgs","repos_url":"https://api.github.com/users/dridi/repos","events_url":"https://api.github.com/users/dridi/events{/privacy}","received_events_url":"https://api.github.com/users/dridi/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":20,"created_at":"2016-10-28T10:50:32Z","updated_at":"2016-11-15T15:23:05Z","closed_at":"2016-11-15T15:23:05Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I'm trying to create a simple proxy for a site. As the details are unknown until runtime vmod_dynamic looked perfect.  However about 30% of the time i see the following in the log\n\n```\n-   VCL_call       BACKEND_FETCH\n-   VCL_return     fetch\n-   FetchError     no backend connection\n```\n\nHere's a tiny VCL that causes the problem.\n\n```\nvcl 4.0;\nimport dynamic;\nbackend default {\n    .host = \"10.0.0.1\";\n    .port = \"80\";\n}\nsub vcl_init {\n    new dynamic_dir = dynamic.director(  port=\"80\" );\n}\nsub vcl_recv {\n    set req.backend_hint = dynamic_dir.backend();\n}\nsub vcl_backend_fetch {\n    set bereq.backend = dynamic_dir.backend();\n}\n\n```\n\nAs it stands, I'd expect that to proxy any traffic that reaches it (I'm not expecting this to cache or anything yet). I've been testing using a range of sites but a simple test add the following to your hosts file on a desktop\n`<ip of your varnish> www.dalestrailseries.co.uk`\nand point your browser at http://www.dalestrailseries.co.uk \n\nAt best you'll either see a whole page or a broken page or just an error, click a sidebar link or two and it'll always break. The same issue exists with every site i've set up...  I've experimented with every timeout I can and nothing seems to change\n\nI should add that I'm totally new to Varnish - I apologise in advance if I've got the wrong end of the stick somewhere...\n\nI've attached the varnishlog\n\n[varnishlog.txt](https://github.com/nigoroll/libvmod-dynamic/files/558154/varnishlog.txt)\n","closed_by":{"login":"dridi","id":891744,"node_id":"MDQ6VXNlcjg5MTc0NA==","avatar_url":"https://avatars.githubusercontent.com/u/891744?v=4","gravatar_id":"","url":"https://api.github.com/users/dridi","html_url":"https://github.com/dridi","followers_url":"https://api.github.com/users/dridi/followers","following_url":"https://api.github.com/users/dridi/following{/other_user}","gists_url":"https://api.github.com/users/dridi/gists{/gist_id}","starred_url":"https://api.github.com/users/dridi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dridi/subscriptions","organizations_url":"https://api.github.com/users/dridi/orgs","repos_url":"https://api.github.com/users/dridi/repos","events_url":"https://api.github.com/users/dridi/events{/privacy}","received_events_url":"https://api.github.com/users/dridi/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/4/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/4/timeline","performed_via_github_app":null,"state_reason":"completed"},{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/5","repository_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/5/labels{/name}","comments_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/5/comments","events_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/5/events","html_url":"https://github.com/nigoroll/libvmod-dynamic/pull/5","id":187436711,"node_id":"MDExOlB1bGxSZXF1ZXN0OTI0MTQ2Njk=","number":5,"title":"Avoid deadlocking when going cold.","user":{"login":"felipewd","id":547142,"node_id":"MDQ6VXNlcjU0NzE0Mg==","avatar_url":"https://avatars.githubusercontent.com/u/547142?v=4","gravatar_id":"","url":"https://api.github.com/users/felipewd","html_url":"https://github.com/felipewd","followers_url":"https://api.github.com/users/felipewd/followers","following_url":"https://api.github.com/users/felipewd/following{/other_user}","gists_url":"https://api.github.com/users/felipewd/gists{/gist_id}","starred_url":"https://api.github.com/users/felipewd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/felipewd/subscriptions","organizations_url":"https://api.github.com/users/felipewd/orgs","repos_url":"https://api.github.com/users/felipewd/repos","events_url":"https://api.github.com/users/felipewd/events{/privacy}","received_events_url":"https://api.github.com/users/felipewd/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2016-11-04T20:58:18Z","updated_at":"2016-11-04T23:12:05Z","closed_at":"2016-11-04T23:11:58Z","author_association":"NONE","active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/pulls/5","html_url":"https://github.com/nigoroll/libvmod-dynamic/pull/5","diff_url":"https://github.com/nigoroll/libvmod-dynamic/pull/5.diff","patch_url":"https://github.com/nigoroll/libvmod-dynamic/pull/5.patch","merged_at":null},"body":"When we receive a cold/discard vmod event, we do a pthread_join with\r\nobj->mtx held.\r\n\r\nThis creates the possibility for a deadlock if, at the same time we're\r\nabout to pthread_join, another thread is in dynamic_update, which tries\r\nto hold the same mutex:\r\n\r\n\r\n```\r\nvmod_event                                       thread_A\r\nobj->active = 0\r\nlock(obj->mtx)\r\n.\r\n.                                                lock(obj->mtx)   -> deadlocks\r\n.                                                .\r\npthread_join(thread_A)                           .\r\n.                                                .\r\n.                                                unlock(obj->mtx)\r\n.\r\nunlock(obj->mtx)\r\n\r\n```\r\nThe solution is after we get the DNS results, we do an early check if\r\nthe obj is still active. If it's not, just exit there and finish the\r\nthread.\r\n\r\nThis fixes https://github.com/varnishcache/varnish-cache/issues/2103","closed_by":{"login":"felipewd","id":547142,"node_id":"MDQ6VXNlcjU0NzE0Mg==","avatar_url":"https://avatars.githubusercontent.com/u/547142?v=4","gravatar_id":"","url":"https://api.github.com/users/felipewd","html_url":"https://github.com/felipewd","followers_url":"https://api.github.com/users/felipewd/followers","following_url":"https://api.github.com/users/felipewd/following{/other_user}","gists_url":"https://api.github.com/users/felipewd/gists{/gist_id}","starred_url":"https://api.github.com/users/felipewd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/felipewd/subscriptions","organizations_url":"https://api.github.com/users/felipewd/orgs","repos_url":"https://api.github.com/users/felipewd/repos","events_url":"https://api.github.com/users/felipewd/events{/privacy}","received_events_url":"https://api.github.com/users/felipewd/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/5/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/5/timeline","performed_via_github_app":null,"state_reason":null},{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/6","repository_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/6/labels{/name}","comments_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/6/comments","events_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/6/events","html_url":"https://github.com/nigoroll/libvmod-dynamic/pull/6","id":187459577,"node_id":"MDExOlB1bGxSZXF1ZXN0OTI0MzEyNDI=","number":6,"title":"Avoid deadlocking when going cold - take 2","user":{"login":"felipewd","id":547142,"node_id":"MDQ6VXNlcjU0NzE0Mg==","avatar_url":"https://avatars.githubusercontent.com/u/547142?v=4","gravatar_id":"","url":"https://api.github.com/users/felipewd","html_url":"https://github.com/felipewd","followers_url":"https://api.github.com/users/felipewd/followers","following_url":"https://api.github.com/users/felipewd/following{/other_user}","gists_url":"https://api.github.com/users/felipewd/gists{/gist_id}","starred_url":"https://api.github.com/users/felipewd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/felipewd/subscriptions","organizations_url":"https://api.github.com/users/felipewd/orgs","repos_url":"https://api.github.com/users/felipewd/repos","events_url":"https://api.github.com/users/felipewd/events{/privacy}","received_events_url":"https://api.github.com/users/felipewd/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2016-11-04T23:29:34Z","updated_at":"2016-11-07T15:42:22Z","closed_at":"2016-11-07T15:42:22Z","author_association":"NONE","active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/pulls/6","html_url":"https://github.com/nigoroll/libvmod-dynamic/pull/6","diff_url":"https://github.com/nigoroll/libvmod-dynamic/pull/6.diff","patch_url":"https://github.com/nigoroll/libvmod-dynamic/pull/6.patch","merged_at":null},"body":"When we receive a cold/discard vmod event, we do a pthread_join with\r\nobj->mtx held.\r\n\r\nThis creates the possibility for a deadlock if, at the same time we're\r\nabout to pthread_join, another thread is in dynamic_update, which tries\r\nto hold the same mutex:\r\n\r\n```\r\nvmod_event                         thread_A\r\nobj->active = 0\r\nlock(obj->mtx)\r\n.\r\n.                                  lock(obj->mtx)       -> deadlock\r\n.                                  .\r\npthread_join(thread_A)             .\r\n.                                  .\r\n.                                  unlock(obj->mtx)\r\n.\r\nunlock(obj->mtx)\r\n\r\n```\r\nThe solution is after we get the DNS results, we do an early check if\r\nthe obj is still active. If it's not, just exit there and finish the\r\nthread.\r\n\r\nSince we're dropping the update and exiting the thread, the user can be confused if this is logged in SLT_Error or SLT_VCL_Log.\r\n\r\nThis fixes varnishcache/varnish-cache#2103","closed_by":{"login":"dridi","id":891744,"node_id":"MDQ6VXNlcjg5MTc0NA==","avatar_url":"https://avatars.githubusercontent.com/u/891744?v=4","gravatar_id":"","url":"https://api.github.com/users/dridi","html_url":"https://github.com/dridi","followers_url":"https://api.github.com/users/dridi/followers","following_url":"https://api.github.com/users/dridi/following{/other_user}","gists_url":"https://api.github.com/users/dridi/gists{/gist_id}","starred_url":"https://api.github.com/users/dridi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dridi/subscriptions","organizations_url":"https://api.github.com/users/dridi/orgs","repos_url":"https://api.github.com/users/dridi/repos","events_url":"https://api.github.com/users/dridi/events{/privacy}","received_events_url":"https://api.github.com/users/dridi/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/6/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/6/timeline","performed_via_github_app":null,"state_reason":null},{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/7","repository_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/7/labels{/name}","comments_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/7/comments","events_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/7/events","html_url":"https://github.com/nigoroll/libvmod-dynamic/issues/7","id":187761638,"node_id":"MDU6SXNzdWUxODc3NjE2Mzg=","number":7,"title":"infinite loop in dynamic_resolve","user":{"login":"felipewd","id":547142,"node_id":"MDQ6VXNlcjU0NzE0Mg==","avatar_url":"https://avatars.githubusercontent.com/u/547142?v=4","gravatar_id":"","url":"https://api.github.com/users/felipewd","html_url":"https://github.com/felipewd","followers_url":"https://api.github.com/users/felipewd/followers","following_url":"https://api.github.com/users/felipewd/following{/other_user}","gists_url":"https://api.github.com/users/felipewd/gists{/gist_id}","starred_url":"https://api.github.com/users/felipewd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/felipewd/subscriptions","organizations_url":"https://api.github.com/users/felipewd/orgs","repos_url":"https://api.github.com/users/felipewd/repos","events_url":"https://api.github.com/users/felipewd/events{/privacy}","received_events_url":"https://api.github.com/users/felipewd/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":443804422,"node_id":"MDU6TGFiZWw0NDM4MDQ0MjI=","url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/labels/bug","name":"bug","color":"ee0701","default":true,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":17,"created_at":"2016-11-07T16:39:59Z","updated_at":"2018-09-12T15:19:25Z","closed_at":"2018-09-12T15:19:25Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hi,\r\n\r\nWe're facing an infinite loop in dynamic_resolve:\r\n\r\n>         do {\r\n>                 if (next != NULL)\r\n>                         next = VTAILQ_NEXT(next, list);\r\n>                 if (next == NULL)\r\n>                         next = VTAILQ_FIRST(&dom->refs);\r\n>         } while (next != dom->current &&\r\n>             !next->be->dir->healthy(next->be->dir, NULL, NULL));\r\n\r\none possible cause for this is dom->current being NULL in first place.\r\n\r\nOnly one other function changes the value of dom->current and _could_ make this condition possible, it's dynamic_del:\r\n\r\n>         if (r == dom->current)\r\n>                 dom->current = VTAILQ_NEXT(r, list);\r\n\r\nSince this part of the code doesn't have the protection to go back do VTAILQ_FIRST in case NEXT is NULL.\r\n\r\nWe'll submit a patch to fix this.","closed_by":{"login":"nigoroll","id":1528104,"node_id":"MDQ6VXNlcjE1MjgxMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1528104?v=4","gravatar_id":"","url":"https://api.github.com/users/nigoroll","html_url":"https://github.com/nigoroll","followers_url":"https://api.github.com/users/nigoroll/followers","following_url":"https://api.github.com/users/nigoroll/following{/other_user}","gists_url":"https://api.github.com/users/nigoroll/gists{/gist_id}","starred_url":"https://api.github.com/users/nigoroll/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nigoroll/subscriptions","organizations_url":"https://api.github.com/users/nigoroll/orgs","repos_url":"https://api.github.com/users/nigoroll/repos","events_url":"https://api.github.com/users/nigoroll/events{/privacy}","received_events_url":"https://api.github.com/users/nigoroll/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/7/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/7/timeline","performed_via_github_app":null,"state_reason":"completed"},{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/8","repository_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/8/labels{/name}","comments_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/8/comments","events_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/8/events","html_url":"https://github.com/nigoroll/libvmod-dynamic/pull/8","id":187761915,"node_id":"MDExOlB1bGxSZXF1ZXN0OTI2MTg2MDg=","number":8,"title":"Never allow a NULL reference in dom->current","user":{"login":"felipewd","id":547142,"node_id":"MDQ6VXNlcjU0NzE0Mg==","avatar_url":"https://avatars.githubusercontent.com/u/547142?v=4","gravatar_id":"","url":"https://api.github.com/users/felipewd","html_url":"https://github.com/felipewd","followers_url":"https://api.github.com/users/felipewd/followers","following_url":"https://api.github.com/users/felipewd/following{/other_user}","gists_url":"https://api.github.com/users/felipewd/gists{/gist_id}","starred_url":"https://api.github.com/users/felipewd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/felipewd/subscriptions","organizations_url":"https://api.github.com/users/felipewd/orgs","repos_url":"https://api.github.com/users/felipewd/repos","events_url":"https://api.github.com/users/felipewd/events{/privacy}","received_events_url":"https://api.github.com/users/felipewd/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2016-11-07T16:40:53Z","updated_at":"2016-12-01T15:02:02Z","closed_at":"2016-12-01T15:02:02Z","author_association":"NONE","active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/pulls/8","html_url":"https://github.com/nigoroll/libvmod-dynamic/pull/8","diff_url":"https://github.com/nigoroll/libvmod-dynamic/pull/8.diff","patch_url":"https://github.com/nigoroll/libvmod-dynamic/pull/8.patch","merged_at":null},"body":"If dom->current is the very last position on the queue and we're going\r\nto delete it, VTAILQ_NEXT is going to be NULL. When this happens,\r\ngo back to the first element.\r\n\r\nThis fixes issue #7","closed_by":{"login":"dridi","id":891744,"node_id":"MDQ6VXNlcjg5MTc0NA==","avatar_url":"https://avatars.githubusercontent.com/u/891744?v=4","gravatar_id":"","url":"https://api.github.com/users/dridi","html_url":"https://github.com/dridi","followers_url":"https://api.github.com/users/dridi/followers","following_url":"https://api.github.com/users/dridi/following{/other_user}","gists_url":"https://api.github.com/users/dridi/gists{/gist_id}","starred_url":"https://api.github.com/users/dridi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dridi/subscriptions","organizations_url":"https://api.github.com/users/dridi/orgs","repos_url":"https://api.github.com/users/dridi/repos","events_url":"https://api.github.com/users/dridi/events{/privacy}","received_events_url":"https://api.github.com/users/dridi/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/8/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/8/timeline","performed_via_github_app":null,"state_reason":null},{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/9","repository_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/9/labels{/name}","comments_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/9/comments","events_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/9/events","html_url":"https://github.com/nigoroll/libvmod-dynamic/issues/9","id":189007684,"node_id":"MDU6SXNzdWUxODkwMDc2ODQ=","number":9,"title":"Condition(Segmentation fault by instruction at 0x8) not true","user":{"login":"dridi","id":891744,"node_id":"MDQ6VXNlcjg5MTc0NA==","avatar_url":"https://avatars.githubusercontent.com/u/891744?v=4","gravatar_id":"","url":"https://api.github.com/users/dridi","html_url":"https://github.com/dridi","followers_url":"https://api.github.com/users/dridi/followers","following_url":"https://api.github.com/users/dridi/following{/other_user}","gists_url":"https://api.github.com/users/dridi/gists{/gist_id}","starred_url":"https://api.github.com/users/dridi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dridi/subscriptions","organizations_url":"https://api.github.com/users/dridi/orgs","repos_url":"https://api.github.com/users/dridi/repos","events_url":"https://api.github.com/users/dridi/events{/privacy}","received_events_url":"https://api.github.com/users/dridi/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":443804422,"node_id":"MDU6TGFiZWw0NDM4MDQ0MjI=","url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/labels/bug","name":"bug","color":"ee0701","default":true,"description":null}],"state":"closed","locked":false,"assignee":{"login":"dridi","id":891744,"node_id":"MDQ6VXNlcjg5MTc0NA==","avatar_url":"https://avatars.githubusercontent.com/u/891744?v=4","gravatar_id":"","url":"https://api.github.com/users/dridi","html_url":"https://github.com/dridi","followers_url":"https://api.github.com/users/dridi/followers","following_url":"https://api.github.com/users/dridi/following{/other_user}","gists_url":"https://api.github.com/users/dridi/gists{/gist_id}","starred_url":"https://api.github.com/users/dridi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dridi/subscriptions","organizations_url":"https://api.github.com/users/dridi/orgs","repos_url":"https://api.github.com/users/dridi/repos","events_url":"https://api.github.com/users/dridi/events{/privacy}","received_events_url":"https://api.github.com/users/dridi/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"dridi","id":891744,"node_id":"MDQ6VXNlcjg5MTc0NA==","avatar_url":"https://avatars.githubusercontent.com/u/891744?v=4","gravatar_id":"","url":"https://api.github.com/users/dridi","html_url":"https://github.com/dridi","followers_url":"https://api.github.com/users/dridi/followers","following_url":"https://api.github.com/users/dridi/following{/other_user}","gists_url":"https://api.github.com/users/dridi/gists{/gist_id}","starred_url":"https://api.github.com/users/dridi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dridi/subscriptions","organizations_url":"https://api.github.com/users/dridi/orgs","repos_url":"https://api.github.com/users/dridi/repos","events_url":"https://api.github.com/users/dridi/events{/privacy}","received_events_url":"https://api.github.com/users/dridi/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":1,"created_at":"2016-11-14T00:40:46Z","updated_at":"2016-11-28T23:21:25Z","closed_at":"2016-11-28T23:21:25Z","author_association":"COLLABORATOR","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I managed to make Varnish panic while I was writing a test case:\r\n\r\n```\r\nvarnishtest \"debugging\"\r\n\r\nserver s1 {\r\n\trxreq\r\n\ttxresp\r\n\r\n\taccept\r\n\trxreq\r\n\ttxresp\r\n\r\n\taccept\r\n\trxreq\r\n\ttxresp\r\n} -start\r\n\r\nvarnish v1 -vcl {\r\n\timport ${vmod_dynamic};\r\n\r\n\tbackend dummy { .host = \"${bad_ip}\"; .port = \"9080\"; }\r\n\r\n\tacl ipv4_loopback {\r\n\t\t\"127/24\";\r\n\t}\r\n\r\n\tsub vcl_init {\r\n\t\tnew d1 = dynamic.director(\r\n\t\t\tport = \"${s1_port}\",\r\n\t\t\twhitelist = ipv4_loopback,\r\n\t\t\tdomain_usage_timeout = 1s);\r\n\t\td1.debug(true);\r\n\t}\r\n\r\n\tsub vcl_recv {\r\n\t\tset req.backend_hint = d1.backend();\r\n\t}\r\n} -start\r\n\r\nlogexpect l1 -v v1 -g raw {\r\n\texpect * * Debug\t\"vmod-dynamic: vcl1 d1 localhost addr 127.0.0.1\"\r\n\texpect * * VCL_acl\t\"^MATCH ipv4_loopback\"\r\n\texpect * * Debug\t\"vmod-dynamic: vcl1 d1 localhost add-backend d1(127.0.0.1)\"\r\n\texpect * * Debug\t\"vmod-dynamic: vcl1 d1 localhost ref-backend d1(127.0.0.1) (1 in total)\"\r\n\texpect * * Debug\t\"vmod-dynamic: vcl1 d1 img.localhost addr 127.0.0.1\"\r\n\texpect * * VCL_acl\t\"^MATCH ipv4_loopback\"\r\n\texpect * * Debug\t\"vmod-dynamic: vcl1 d1 img.localhost ref-backend d1(127.0.0.1) (2 in total)\"\r\n\texpect * * VCL_Log\t\"vmod-dynamic: vcl1 d1 localhost deleted\"\r\n\texpect * * Debug\t\"vmod-dynamic: vcl1 d1 localhost unref-backend d1(127.0.0.1) (1 remaining)\"\r\n} -start\r\n\r\nclient c1 {\r\n\ttxreq -hdr \"Host: localhost\"\r\n\trxresp\r\n\texpect resp.status == 200\r\n\r\n\tdelay 1.5\r\n\r\n\ttxreq -hdr \"Host: img.localhost\"\r\n\trxresp\r\n\texpect resp.status == 200\r\n\r\n\ttxreq -hdr \"Host: www.localhost\"\r\n\trxresp\r\n\texpect resp.status == 200\r\n} -run\r\n\r\nlogexpect l1 -wait\r\n```\r\n\r\nFiling it here to make sure not to forget it, it may be related to recent changes in master.","closed_by":{"login":"dridi","id":891744,"node_id":"MDQ6VXNlcjg5MTc0NA==","avatar_url":"https://avatars.githubusercontent.com/u/891744?v=4","gravatar_id":"","url":"https://api.github.com/users/dridi","html_url":"https://github.com/dridi","followers_url":"https://api.github.com/users/dridi/followers","following_url":"https://api.github.com/users/dridi/following{/other_user}","gists_url":"https://api.github.com/users/dridi/gists{/gist_id}","starred_url":"https://api.github.com/users/dridi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dridi/subscriptions","organizations_url":"https://api.github.com/users/dridi/orgs","repos_url":"https://api.github.com/users/dridi/repos","events_url":"https://api.github.com/users/dridi/events{/privacy}","received_events_url":"https://api.github.com/users/dridi/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/9/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/9/timeline","performed_via_github_app":null,"state_reason":"completed"},{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/10","repository_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/10/labels{/name}","comments_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/10/comments","events_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/10/events","html_url":"https://github.com/nigoroll/libvmod-dynamic/pull/10","id":190753343,"node_id":"MDExOlB1bGxSZXF1ZXN0OTQ2MzkzNTI=","number":10,"title":"Fix use-after-free","user":{"login":"rnsanchez","id":87608,"node_id":"MDQ6VXNlcjg3NjA4","avatar_url":"https://avatars.githubusercontent.com/u/87608?v=4","gravatar_id":"","url":"https://api.github.com/users/rnsanchez","html_url":"https://github.com/rnsanchez","followers_url":"https://api.github.com/users/rnsanchez/followers","following_url":"https://api.github.com/users/rnsanchez/following{/other_user}","gists_url":"https://api.github.com/users/rnsanchez/gists{/gist_id}","starred_url":"https://api.github.com/users/rnsanchez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnsanchez/subscriptions","organizations_url":"https://api.github.com/users/rnsanchez/orgs","repos_url":"https://api.github.com/users/rnsanchez/repos","events_url":"https://api.github.com/users/rnsanchez/events{/privacy}","received_events_url":"https://api.github.com/users/rnsanchez/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2016-11-21T15:42:48Z","updated_at":"2016-11-21T15:54:18Z","closed_at":"2016-11-21T15:46:58Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/pulls/10","html_url":"https://github.com/nigoroll/libvmod-dynamic/pull/10","diff_url":"https://github.com/nigoroll/libvmod-dynamic/pull/10.diff","patch_url":"https://github.com/nigoroll/libvmod-dynamic/pull/10.patch","merged_at":"2016-11-21T15:46:58Z"},"body":"Clang's static analyzer found a use-after-free in dynamic_stop().  dom\r\npointer is passed to dynamic_free() which deallocate its contents, but\r\nupon returning from dynamic_free(), dom and its possibly-stale contents\r\nare used unguarded in VTAILQ_REMOVE(), immediately.\r\n\r\nThis use-after-free could explain the hard-to-reproduce issue #7.","closed_by":{"login":"dridi","id":891744,"node_id":"MDQ6VXNlcjg5MTc0NA==","avatar_url":"https://avatars.githubusercontent.com/u/891744?v=4","gravatar_id":"","url":"https://api.github.com/users/dridi","html_url":"https://github.com/dridi","followers_url":"https://api.github.com/users/dridi/followers","following_url":"https://api.github.com/users/dridi/following{/other_user}","gists_url":"https://api.github.com/users/dridi/gists{/gist_id}","starred_url":"https://api.github.com/users/dridi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dridi/subscriptions","organizations_url":"https://api.github.com/users/dridi/orgs","repos_url":"https://api.github.com/users/dridi/repos","events_url":"https://api.github.com/users/dridi/events{/privacy}","received_events_url":"https://api.github.com/users/dridi/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/10/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/10/timeline","performed_via_github_app":null,"state_reason":null},{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/11","repository_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/11/labels{/name}","comments_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/11/comments","events_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/11/events","html_url":"https://github.com/nigoroll/libvmod-dynamic/pull/11","id":191737172,"node_id":"MDExOlB1bGxSZXF1ZXN0OTUzMjg4OTI=","number":11,"title":"Fix #9 in two parts","user":{"login":"rnsanchez","id":87608,"node_id":"MDQ6VXNlcjg3NjA4","avatar_url":"https://avatars.githubusercontent.com/u/87608?v=4","gravatar_id":"","url":"https://api.github.com/users/rnsanchez","html_url":"https://github.com/rnsanchez","followers_url":"https://api.github.com/users/rnsanchez/followers","following_url":"https://api.github.com/users/rnsanchez/following{/other_user}","gists_url":"https://api.github.com/users/rnsanchez/gists{/gist_id}","starred_url":"https://api.github.com/users/rnsanchez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnsanchez/subscriptions","organizations_url":"https://api.github.com/users/rnsanchez/orgs","repos_url":"https://api.github.com/users/rnsanchez/repos","events_url":"https://api.github.com/users/rnsanchez/events{/privacy}","received_events_url":"https://api.github.com/users/rnsanchez/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":443804422,"node_id":"MDU6TGFiZWw0NDM4MDQ0MjI=","url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/labels/bug","name":"bug","color":"ee0701","default":true,"description":null}],"state":"closed","locked":false,"assignee":{"login":"dridi","id":891744,"node_id":"MDQ6VXNlcjg5MTc0NA==","avatar_url":"https://avatars.githubusercontent.com/u/891744?v=4","gravatar_id":"","url":"https://api.github.com/users/dridi","html_url":"https://github.com/dridi","followers_url":"https://api.github.com/users/dridi/followers","following_url":"https://api.github.com/users/dridi/following{/other_user}","gists_url":"https://api.github.com/users/dridi/gists{/gist_id}","starred_url":"https://api.github.com/users/dridi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dridi/subscriptions","organizations_url":"https://api.github.com/users/dridi/orgs","repos_url":"https://api.github.com/users/dridi/repos","events_url":"https://api.github.com/users/dridi/events{/privacy}","received_events_url":"https://api.github.com/users/dridi/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"dridi","id":891744,"node_id":"MDQ6VXNlcjg5MTc0NA==","avatar_url":"https://avatars.githubusercontent.com/u/891744?v=4","gravatar_id":"","url":"https://api.github.com/users/dridi","html_url":"https://github.com/dridi","followers_url":"https://api.github.com/users/dridi/followers","following_url":"https://api.github.com/users/dridi/following{/other_user}","gists_url":"https://api.github.com/users/dridi/gists{/gist_id}","starred_url":"https://api.github.com/users/dridi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dridi/subscriptions","organizations_url":"https://api.github.com/users/dridi/orgs","repos_url":"https://api.github.com/users/dridi/repos","events_url":"https://api.github.com/users/dridi/events{/privacy}","received_events_url":"https://api.github.com/users/dridi/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":8,"created_at":"2016-11-25T16:37:24Z","updated_at":"2016-11-29T10:30:31Z","closed_at":"2016-11-28T23:21:25Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/pulls/11","html_url":"https://github.com/nigoroll/libvmod-dynamic/pull/11","diff_url":"https://github.com/nigoroll/libvmod-dynamic/pull/11.diff","patch_url":"https://github.com/nigoroll/libvmod-dynamic/pull/11.patch","merged_at":null},"body":"With the patches in this PR, I cannot reproduce the problem proposed in #9 anymore.\r\n\r\nThe first commit fixes three other cases of use-after-free.  While inspecting `dynamic_free()`, it is my understanding that given the opportunity, memory being accessed just after deallocation could lead to unexpected results.  By itself, this commit does not fix #9.\r\n\r\nThe second commit avoids cleaning up the `purged_domains` list in the case domain `addr` (received in `dynamic_search()`) was not found in the `active_domains` list, thus leaving `dom` uninitialized.\r\n\r\nPlease review, since this might not be a trivial change.","closed_by":{"login":"dridi","id":891744,"node_id":"MDQ6VXNlcjg5MTc0NA==","avatar_url":"https://avatars.githubusercontent.com/u/891744?v=4","gravatar_id":"","url":"https://api.github.com/users/dridi","html_url":"https://github.com/dridi","followers_url":"https://api.github.com/users/dridi/followers","following_url":"https://api.github.com/users/dridi/following{/other_user}","gists_url":"https://api.github.com/users/dridi/gists{/gist_id}","starred_url":"https://api.github.com/users/dridi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dridi/subscriptions","organizations_url":"https://api.github.com/users/dridi/orgs","repos_url":"https://api.github.com/users/dridi/repos","events_url":"https://api.github.com/users/dridi/events{/privacy}","received_events_url":"https://api.github.com/users/dridi/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/11/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/11/timeline","performed_via_github_app":null,"state_reason":null},{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/12","repository_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/12/labels{/name}","comments_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/12/comments","events_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/12/events","html_url":"https://github.com/nigoroll/libvmod-dynamic/issues/12","id":198042367,"node_id":"MDU6SXNzdWUxOTgwNDIzNjc=","number":12,"title":"assert in dynamic_free","user":{"login":"felipewd","id":547142,"node_id":"MDQ6VXNlcjU0NzE0Mg==","avatar_url":"https://avatars.githubusercontent.com/u/547142?v=4","gravatar_id":"","url":"https://api.github.com/users/felipewd","html_url":"https://github.com/felipewd","followers_url":"https://api.github.com/users/felipewd/followers","following_url":"https://api.github.com/users/felipewd/following{/other_user}","gists_url":"https://api.github.com/users/felipewd/gists{/gist_id}","starred_url":"https://api.github.com/users/felipewd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/felipewd/subscriptions","organizations_url":"https://api.github.com/users/felipewd/orgs","repos_url":"https://api.github.com/users/felipewd/repos","events_url":"https://api.github.com/users/felipewd/events{/privacy}","received_events_url":"https://api.github.com/users/felipewd/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":443804422,"node_id":"MDU6TGFiZWw0NDM4MDQ0MjI=","url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/labels/bug","name":"bug","color":"ee0701","default":true,"description":null}],"state":"closed","locked":false,"assignee":{"login":"dridi","id":891744,"node_id":"MDQ6VXNlcjg5MTc0NA==","avatar_url":"https://avatars.githubusercontent.com/u/891744?v=4","gravatar_id":"","url":"https://api.github.com/users/dridi","html_url":"https://github.com/dridi","followers_url":"https://api.github.com/users/dridi/followers","following_url":"https://api.github.com/users/dridi/following{/other_user}","gists_url":"https://api.github.com/users/dridi/gists{/gist_id}","starred_url":"https://api.github.com/users/dridi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dridi/subscriptions","organizations_url":"https://api.github.com/users/dridi/orgs","repos_url":"https://api.github.com/users/dridi/repos","events_url":"https://api.github.com/users/dridi/events{/privacy}","received_events_url":"https://api.github.com/users/dridi/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"dridi","id":891744,"node_id":"MDQ6VXNlcjg5MTc0NA==","avatar_url":"https://avatars.githubusercontent.com/u/891744?v=4","gravatar_id":"","url":"https://api.github.com/users/dridi","html_url":"https://github.com/dridi","followers_url":"https://api.github.com/users/dridi/followers","following_url":"https://api.github.com/users/dridi/following{/other_user}","gists_url":"https://api.github.com/users/dridi/gists{/gist_id}","starred_url":"https://api.github.com/users/dridi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dridi/subscriptions","organizations_url":"https://api.github.com/users/dridi/orgs","repos_url":"https://api.github.com/users/dridi/repos","events_url":"https://api.github.com/users/dridi/events{/privacy}","received_events_url":"https://api.github.com/users/dridi/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":0,"created_at":"2016-12-29T17:36:42Z","updated_at":"2017-01-02T10:56:07Z","closed_at":"2017-01-02T10:56:07Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hey @Dridi,\r\n\r\nWe caught this assert today:\r\n\r\n```\r\n\"Assert error in dynamic_free(), vmod_dynamic.c line 506:\r\n  Condition((dom->thread) == 0) not true.\r\nBacktrace:\r\n  0x43e6d0: pan_backtrace+0x1d\r\n  0x43eb27: pan_ic+0x2f3\r\n  0x7abdfedfa32e: libvmod_dynamic.so(+0x232e) [0x7abdfedfa32e]\r\n  0x7abdfedfb54b: libvmod_dynamic.so(vmod_event+0x31b) [0x7abdfedfb54b]\r\n  0x7abd29304219: vgc.so(+0x2e219) [0x7abd29304219]\r\n  0x44d354: vcl_failsafe_event+0x223\r\n  0x44d881: vcl_set_state+0x366\r\n  0x44e3de: VCL_Poll+0xb1\r\n  0x41cfba: cli_cb_before+0x6c\r\n  0x7fcd16dac0b4: libvarnish.so(+0x80b4) [0x7fcd16dac0b4]\r\n\r\n\"\r\n```\r\n","closed_by":{"login":"dridi","id":891744,"node_id":"MDQ6VXNlcjg5MTc0NA==","avatar_url":"https://avatars.githubusercontent.com/u/891744?v=4","gravatar_id":"","url":"https://api.github.com/users/dridi","html_url":"https://github.com/dridi","followers_url":"https://api.github.com/users/dridi/followers","following_url":"https://api.github.com/users/dridi/following{/other_user}","gists_url":"https://api.github.com/users/dridi/gists{/gist_id}","starred_url":"https://api.github.com/users/dridi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dridi/subscriptions","organizations_url":"https://api.github.com/users/dridi/orgs","repos_url":"https://api.github.com/users/dridi/repos","events_url":"https://api.github.com/users/dridi/events{/privacy}","received_events_url":"https://api.github.com/users/dridi/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/12/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/12/timeline","performed_via_github_app":null,"state_reason":"completed"},{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/13","repository_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/13/labels{/name}","comments_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/13/comments","events_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/13/events","html_url":"https://github.com/nigoroll/libvmod-dynamic/pull/13","id":198042563,"node_id":"MDExOlB1bGxSZXF1ZXN0OTk2ODA0MzU=","number":13,"title":"Always set dom->thread to 0 after a pthread join.","user":{"login":"felipewd","id":547142,"node_id":"MDQ6VXNlcjU0NzE0Mg==","avatar_url":"https://avatars.githubusercontent.com/u/547142?v=4","gravatar_id":"","url":"https://api.github.com/users/felipewd","html_url":"https://github.com/felipewd","followers_url":"https://api.github.com/users/felipewd/followers","following_url":"https://api.github.com/users/felipewd/following{/other_user}","gists_url":"https://api.github.com/users/felipewd/gists{/gist_id}","starred_url":"https://api.github.com/users/felipewd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/felipewd/subscriptions","organizations_url":"https://api.github.com/users/felipewd/orgs","repos_url":"https://api.github.com/users/felipewd/repos","events_url":"https://api.github.com/users/felipewd/events{/privacy}","received_events_url":"https://api.github.com/users/felipewd/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":443804424,"node_id":"MDU6TGFiZWw0NDM4MDQ0MjQ=","url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/labels/enhancement","name":"enhancement","color":"84b6eb","default":true,"description":null}],"state":"closed","locked":false,"assignee":{"login":"dridi","id":891744,"node_id":"MDQ6VXNlcjg5MTc0NA==","avatar_url":"https://avatars.githubusercontent.com/u/891744?v=4","gravatar_id":"","url":"https://api.github.com/users/dridi","html_url":"https://github.com/dridi","followers_url":"https://api.github.com/users/dridi/followers","following_url":"https://api.github.com/users/dridi/following{/other_user}","gists_url":"https://api.github.com/users/dridi/gists{/gist_id}","starred_url":"https://api.github.com/users/dridi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dridi/subscriptions","organizations_url":"https://api.github.com/users/dridi/orgs","repos_url":"https://api.github.com/users/dridi/repos","events_url":"https://api.github.com/users/dridi/events{/privacy}","received_events_url":"https://api.github.com/users/dridi/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"dridi","id":891744,"node_id":"MDQ6VXNlcjg5MTc0NA==","avatar_url":"https://avatars.githubusercontent.com/u/891744?v=4","gravatar_id":"","url":"https://api.github.com/users/dridi","html_url":"https://github.com/dridi","followers_url":"https://api.github.com/users/dridi/followers","following_url":"https://api.github.com/users/dridi/following{/other_user}","gists_url":"https://api.github.com/users/dridi/gists{/gist_id}","starred_url":"https://api.github.com/users/dridi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dridi/subscriptions","organizations_url":"https://api.github.com/users/dridi/orgs","repos_url":"https://api.github.com/users/dridi/repos","events_url":"https://api.github.com/users/dridi/events{/privacy}","received_events_url":"https://api.github.com/users/dridi/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":4,"created_at":"2016-12-29T17:38:07Z","updated_at":"2017-01-02T23:16:17Z","closed_at":"2017-01-02T23:16:17Z","author_association":"NONE","active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/pulls/13","html_url":"https://github.com/nigoroll/libvmod-dynamic/pull/13","diff_url":"https://github.com/nigoroll/libvmod-dynamic/pull/13.diff","patch_url":"https://github.com/nigoroll/libvmod-dynamic/pull/13.patch","merged_at":null},"body":"After a pthread_join we need to guarantee that dom->thread is set to 0\r\nto avoid problems in dynamic_free.\r\n\r\nTo avoid copy+paste problems, let's do this in a simple function.\r\n\r\nFixes #12 ","closed_by":{"login":"felipewd","id":547142,"node_id":"MDQ6VXNlcjU0NzE0Mg==","avatar_url":"https://avatars.githubusercontent.com/u/547142?v=4","gravatar_id":"","url":"https://api.github.com/users/felipewd","html_url":"https://github.com/felipewd","followers_url":"https://api.github.com/users/felipewd/followers","following_url":"https://api.github.com/users/felipewd/following{/other_user}","gists_url":"https://api.github.com/users/felipewd/gists{/gist_id}","starred_url":"https://api.github.com/users/felipewd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/felipewd/subscriptions","organizations_url":"https://api.github.com/users/felipewd/orgs","repos_url":"https://api.github.com/users/felipewd/repos","events_url":"https://api.github.com/users/felipewd/events{/privacy}","received_events_url":"https://api.github.com/users/felipewd/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/13/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/13/timeline","performed_via_github_app":null,"state_reason":null},{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/14","repository_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/14/labels{/name}","comments_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/14/comments","events_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/14/events","html_url":"https://github.com/nigoroll/libvmod-dynamic/issues/14","id":200291644,"node_id":"MDU6SXNzdWUyMDAyOTE2NDQ=","number":14,"title":"Difficulty building against Varnish 5.0 on Ubuntu 16.04","user":{"login":"scottybrisbane","id":5016282,"node_id":"MDQ6VXNlcjUwMTYyODI=","avatar_url":"https://avatars.githubusercontent.com/u/5016282?v=4","gravatar_id":"","url":"https://api.github.com/users/scottybrisbane","html_url":"https://github.com/scottybrisbane","followers_url":"https://api.github.com/users/scottybrisbane/followers","following_url":"https://api.github.com/users/scottybrisbane/following{/other_user}","gists_url":"https://api.github.com/users/scottybrisbane/gists{/gist_id}","starred_url":"https://api.github.com/users/scottybrisbane/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/scottybrisbane/subscriptions","organizations_url":"https://api.github.com/users/scottybrisbane/orgs","repos_url":"https://api.github.com/users/scottybrisbane/repos","events_url":"https://api.github.com/users/scottybrisbane/events{/privacy}","received_events_url":"https://api.github.com/users/scottybrisbane/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":443804427,"node_id":"MDU6TGFiZWw0NDM4MDQ0Mjc=","url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/labels/question","name":"question","color":"cc317c","default":true,"description":null}],"state":"closed","locked":false,"assignee":{"login":"dridi","id":891744,"node_id":"MDQ6VXNlcjg5MTc0NA==","avatar_url":"https://avatars.githubusercontent.com/u/891744?v=4","gravatar_id":"","url":"https://api.github.com/users/dridi","html_url":"https://github.com/dridi","followers_url":"https://api.github.com/users/dridi/followers","following_url":"https://api.github.com/users/dridi/following{/other_user}","gists_url":"https://api.github.com/users/dridi/gists{/gist_id}","starred_url":"https://api.github.com/users/dridi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dridi/subscriptions","organizations_url":"https://api.github.com/users/dridi/orgs","repos_url":"https://api.github.com/users/dridi/repos","events_url":"https://api.github.com/users/dridi/events{/privacy}","received_events_url":"https://api.github.com/users/dridi/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"dridi","id":891744,"node_id":"MDQ6VXNlcjg5MTc0NA==","avatar_url":"https://avatars.githubusercontent.com/u/891744?v=4","gravatar_id":"","url":"https://api.github.com/users/dridi","html_url":"https://github.com/dridi","followers_url":"https://api.github.com/users/dridi/followers","following_url":"https://api.github.com/users/dridi/following{/other_user}","gists_url":"https://api.github.com/users/dridi/gists{/gist_id}","starred_url":"https://api.github.com/users/dridi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dridi/subscriptions","organizations_url":"https://api.github.com/users/dridi/orgs","repos_url":"https://api.github.com/users/dridi/repos","events_url":"https://api.github.com/users/dridi/events{/privacy}","received_events_url":"https://api.github.com/users/dridi/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":5,"created_at":"2017-01-12T06:50:18Z","updated_at":"2017-02-28T06:35:56Z","closed_at":"2017-02-28T06:35:56Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I'm having trouble compiling the vmod against Varnish 5.0 on a Ubuntu 16.04 machine. When running `./autogen.sh` I receive the following output:\r\n\r\n```\r\n+ aclocal -I m4 -I /usr/share/aclocal\r\n+ libtoolize --copy --force\r\nlibtoolize: putting auxiliary files in AC_CONFIG_AUX_DIR, 'build-aux'.\r\nlibtoolize: copying file 'build-aux/ltmain.sh'\r\nlibtoolize: putting macros in AC_CONFIG_MACRO_DIRS, 'm4'.\r\nlibtoolize: copying file 'm4/libtool.m4'\r\nlibtoolize: copying file 'm4/ltoptions.m4'\r\nlibtoolize: copying file 'm4/ltsugar.m4'\r\nlibtoolize: copying file 'm4/ltversion.m4'\r\nlibtoolize: copying file 'm4/lt~obsolete.m4'\r\n+ autoheader\r\n+ automake --add-missing --copy --foreign\r\nconfigure.ac:11: installing 'build-aux/compile'\r\nconfigure.ac:9: installing 'build-aux/missing'\r\nsrc/Makefile.am:4: error: 'vmod_LTLIBRARIES' is used but 'vmoddir' is undefined\r\nautomake: warnings are treated as errors\r\nsrc/Makefile.am:6: warning: variable 'libvmod_dynamic_la_SOURCES' is defined but no program or\r\nsrc/Makefile.am:6: library has 'libvmod_dynamic_la' as canonical name (possible typo)\r\nsrc/Makefile.am:10: warning: variable 'nodist_libvmod_dynamic_la_SOURCES' is defined but no program or\r\nsrc/Makefile.am:10: library has 'libvmod_dynamic_la' as canonical name (possible typo)\r\n```\r\n\r\nChances are I've missed something, but could someone please point me in the right direction?","closed_by":{"login":"dridi","id":891744,"node_id":"MDQ6VXNlcjg5MTc0NA==","avatar_url":"https://avatars.githubusercontent.com/u/891744?v=4","gravatar_id":"","url":"https://api.github.com/users/dridi","html_url":"https://github.com/dridi","followers_url":"https://api.github.com/users/dridi/followers","following_url":"https://api.github.com/users/dridi/following{/other_user}","gists_url":"https://api.github.com/users/dridi/gists{/gist_id}","starred_url":"https://api.github.com/users/dridi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dridi/subscriptions","organizations_url":"https://api.github.com/users/dridi/orgs","repos_url":"https://api.github.com/users/dridi/repos","events_url":"https://api.github.com/users/dridi/events{/privacy}","received_events_url":"https://api.github.com/users/dridi/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/14/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/14/timeline","performed_via_github_app":null,"state_reason":"completed"},{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/15","repository_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/15/labels{/name}","comments_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/15/comments","events_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/15/events","html_url":"https://github.com/nigoroll/libvmod-dynamic/issues/15","id":215410291,"node_id":"MDU6SXNzdWUyMTU0MTAyOTE=","number":15,"title":"How to see the vmod-dynamic logs","user":{"login":"danielmotaleite","id":11890049,"node_id":"MDQ6VXNlcjExODkwMDQ5","avatar_url":"https://avatars.githubusercontent.com/u/11890049?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmotaleite","html_url":"https://github.com/danielmotaleite","followers_url":"https://api.github.com/users/danielmotaleite/followers","following_url":"https://api.github.com/users/danielmotaleite/following{/other_user}","gists_url":"https://api.github.com/users/danielmotaleite/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmotaleite/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmotaleite/subscriptions","organizations_url":"https://api.github.com/users/danielmotaleite/orgs","repos_url":"https://api.github.com/users/danielmotaleite/repos","events_url":"https://api.github.com/users/danielmotaleite/events{/privacy}","received_events_url":"https://api.github.com/users/danielmotaleite/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"dridi","id":891744,"node_id":"MDQ6VXNlcjg5MTc0NA==","avatar_url":"https://avatars.githubusercontent.com/u/891744?v=4","gravatar_id":"","url":"https://api.github.com/users/dridi","html_url":"https://github.com/dridi","followers_url":"https://api.github.com/users/dridi/followers","following_url":"https://api.github.com/users/dridi/following{/other_user}","gists_url":"https://api.github.com/users/dridi/gists{/gist_id}","starred_url":"https://api.github.com/users/dridi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dridi/subscriptions","organizations_url":"https://api.github.com/users/dridi/orgs","repos_url":"https://api.github.com/users/dridi/repos","events_url":"https://api.github.com/users/dridi/events{/privacy}","received_events_url":"https://api.github.com/users/dridi/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"dridi","id":891744,"node_id":"MDQ6VXNlcjg5MTc0NA==","avatar_url":"https://avatars.githubusercontent.com/u/891744?v=4","gravatar_id":"","url":"https://api.github.com/users/dridi","html_url":"https://github.com/dridi","followers_url":"https://api.github.com/users/dridi/followers","following_url":"https://api.github.com/users/dridi/following{/other_user}","gists_url":"https://api.github.com/users/dridi/gists{/gist_id}","starred_url":"https://api.github.com/users/dridi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dridi/subscriptions","organizations_url":"https://api.github.com/users/dridi/orgs","repos_url":"https://api.github.com/users/dridi/repos","events_url":"https://api.github.com/users/dridi/events{/privacy}","received_events_url":"https://api.github.com/users/dridi/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":3,"created_at":"2017-03-20T12:49:48Z","updated_at":"2017-03-20T17:04:03Z","closed_at":"2017-03-20T17:04:03Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hi\r\n\r\nI usually debug varnish using varnishlog, but since i added vmod-dynamic i have the problem that i do not see any log related with vmod-dynamic.\r\n\r\nhttps://github.com/nigoroll/libvmod-dynamic/blob/master/src/vmod_dynamic.vcc seems to say that it should log something, but refers no way to enable that log\r\n\r\nSo how can enable/check the vmod log? is there any vmod option that i'm unfamiliar with?\r\n\r\nThanks","closed_by":{"login":"dridi","id":891744,"node_id":"MDQ6VXNlcjg5MTc0NA==","avatar_url":"https://avatars.githubusercontent.com/u/891744?v=4","gravatar_id":"","url":"https://api.github.com/users/dridi","html_url":"https://github.com/dridi","followers_url":"https://api.github.com/users/dridi/followers","following_url":"https://api.github.com/users/dridi/following{/other_user}","gists_url":"https://api.github.com/users/dridi/gists{/gist_id}","starred_url":"https://api.github.com/users/dridi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dridi/subscriptions","organizations_url":"https://api.github.com/users/dridi/orgs","repos_url":"https://api.github.com/users/dridi/repos","events_url":"https://api.github.com/users/dridi/events{/privacy}","received_events_url":"https://api.github.com/users/dridi/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/15/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/15/timeline","performed_via_github_app":null,"state_reason":"completed"},{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/16","repository_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/16/labels{/name}","comments_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/16/comments","events_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/16/events","html_url":"https://github.com/nigoroll/libvmod-dynamic/issues/16","id":215742988,"node_id":"MDU6SXNzdWUyMTU3NDI5ODg=","number":16,"title":"Varnish complains about \"No backends or directors found in VCL program\"","user":{"login":"otrosien","id":129439,"node_id":"MDQ6VXNlcjEyOTQzOQ==","avatar_url":"https://avatars.githubusercontent.com/u/129439?v=4","gravatar_id":"","url":"https://api.github.com/users/otrosien","html_url":"https://github.com/otrosien","followers_url":"https://api.github.com/users/otrosien/followers","following_url":"https://api.github.com/users/otrosien/following{/other_user}","gists_url":"https://api.github.com/users/otrosien/gists{/gist_id}","starred_url":"https://api.github.com/users/otrosien/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/otrosien/subscriptions","organizations_url":"https://api.github.com/users/otrosien/orgs","repos_url":"https://api.github.com/users/otrosien/repos","events_url":"https://api.github.com/users/otrosien/events{/privacy}","received_events_url":"https://api.github.com/users/otrosien/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":443804427,"node_id":"MDU6TGFiZWw0NDM4MDQ0Mjc=","url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/labels/question","name":"question","color":"cc317c","default":true,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":11,"created_at":"2017-03-21T13:41:41Z","updated_at":"2017-03-26T19:22:43Z","closed_at":"2017-03-26T19:22:43Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I need to add a dummy backend server in order to make varnish happy. Is that intended? Is there any possible side-effect of doing so?","closed_by":{"login":"dridi","id":891744,"node_id":"MDQ6VXNlcjg5MTc0NA==","avatar_url":"https://avatars.githubusercontent.com/u/891744?v=4","gravatar_id":"","url":"https://api.github.com/users/dridi","html_url":"https://github.com/dridi","followers_url":"https://api.github.com/users/dridi/followers","following_url":"https://api.github.com/users/dridi/following{/other_user}","gists_url":"https://api.github.com/users/dridi/gists{/gist_id}","starred_url":"https://api.github.com/users/dridi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dridi/subscriptions","organizations_url":"https://api.github.com/users/dridi/orgs","repos_url":"https://api.github.com/users/dridi/repos","events_url":"https://api.github.com/users/dridi/events{/privacy}","received_events_url":"https://api.github.com/users/dridi/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/16/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/16/timeline","performed_via_github_app":null,"state_reason":"completed"},{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/17","repository_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/17/labels{/name}","comments_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/17/comments","events_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/17/events","html_url":"https://github.com/nigoroll/libvmod-dynamic/issues/17","id":216841913,"node_id":"MDU6SXNzdWUyMTY4NDE5MTM=","number":17,"title":"max_connections","user":{"login":"danielmotaleite","id":11890049,"node_id":"MDQ6VXNlcjExODkwMDQ5","avatar_url":"https://avatars.githubusercontent.com/u/11890049?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmotaleite","html_url":"https://github.com/danielmotaleite","followers_url":"https://api.github.com/users/danielmotaleite/followers","following_url":"https://api.github.com/users/danielmotaleite/following{/other_user}","gists_url":"https://api.github.com/users/danielmotaleite/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmotaleite/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmotaleite/subscriptions","organizations_url":"https://api.github.com/users/danielmotaleite/orgs","repos_url":"https://api.github.com/users/danielmotaleite/repos","events_url":"https://api.github.com/users/danielmotaleite/events{/privacy}","received_events_url":"https://api.github.com/users/danielmotaleite/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":443804424,"node_id":"MDU6TGFiZWw0NDM4MDQ0MjQ=","url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/labels/enhancement","name":"enhancement","color":"84b6eb","default":true,"description":null}],"state":"closed","locked":false,"assignee":{"login":"dridi","id":891744,"node_id":"MDQ6VXNlcjg5MTc0NA==","avatar_url":"https://avatars.githubusercontent.com/u/891744?v=4","gravatar_id":"","url":"https://api.github.com/users/dridi","html_url":"https://github.com/dridi","followers_url":"https://api.github.com/users/dridi/followers","following_url":"https://api.github.com/users/dridi/following{/other_user}","gists_url":"https://api.github.com/users/dridi/gists{/gist_id}","starred_url":"https://api.github.com/users/dridi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dridi/subscriptions","organizations_url":"https://api.github.com/users/dridi/orgs","repos_url":"https://api.github.com/users/dridi/repos","events_url":"https://api.github.com/users/dridi/events{/privacy}","received_events_url":"https://api.github.com/users/dridi/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"dridi","id":891744,"node_id":"MDQ6VXNlcjg5MTc0NA==","avatar_url":"https://avatars.githubusercontent.com/u/891744?v=4","gravatar_id":"","url":"https://api.github.com/users/dridi","html_url":"https://github.com/dridi","followers_url":"https://api.github.com/users/dridi/followers","following_url":"https://api.github.com/users/dridi/following{/other_user}","gists_url":"https://api.github.com/users/dridi/gists{/gist_id}","starred_url":"https://api.github.com/users/dridi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dridi/subscriptions","organizations_url":"https://api.github.com/users/dridi/orgs","repos_url":"https://api.github.com/users/dridi/repos","events_url":"https://api.github.com/users/dridi/events{/privacy}","received_events_url":"https://api.github.com/users/dridi/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/milestones/1","html_url":"https://github.com/nigoroll/libvmod-dynamic/milestone/1","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/milestones/1/labels","id":2411902,"node_id":"MDk6TWlsZXN0b25lMjQxMTkwMg==","number":1,"title":"1.0","description":null,"creator":{"login":"dridi","id":891744,"node_id":"MDQ6VXNlcjg5MTc0NA==","avatar_url":"https://avatars.githubusercontent.com/u/891744?v=4","gravatar_id":"","url":"https://api.github.com/users/dridi","html_url":"https://github.com/dridi","followers_url":"https://api.github.com/users/dridi/followers","following_url":"https://api.github.com/users/dridi/following{/other_user}","gists_url":"https://api.github.com/users/dridi/gists{/gist_id}","starred_url":"https://api.github.com/users/dridi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dridi/subscriptions","organizations_url":"https://api.github.com/users/dridi/orgs","repos_url":"https://api.github.com/users/dridi/repos","events_url":"https://api.github.com/users/dridi/events{/privacy}","received_events_url":"https://api.github.com/users/dridi/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":4,"state":"open","created_at":"2017-03-26T20:50:32Z","updated_at":"2019-07-13T16:40:27Z","due_on":null,"closed_at":null},"comments":2,"created_at":"2017-03-24T16:41:53Z","updated_at":"2017-03-29T16:20:48Z","closed_at":"2017-03-29T16:20:48Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"In normal varnish, we can set the .max_connections in the backend... how to do this with libvmod-dynamic? what is the current max for libvmod-dynamic?\r\n\r\nThanks!","closed_by":{"login":"dridi","id":891744,"node_id":"MDQ6VXNlcjg5MTc0NA==","avatar_url":"https://avatars.githubusercontent.com/u/891744?v=4","gravatar_id":"","url":"https://api.github.com/users/dridi","html_url":"https://github.com/dridi","followers_url":"https://api.github.com/users/dridi/followers","following_url":"https://api.github.com/users/dridi/following{/other_user}","gists_url":"https://api.github.com/users/dridi/gists{/gist_id}","starred_url":"https://api.github.com/users/dridi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dridi/subscriptions","organizations_url":"https://api.github.com/users/dridi/orgs","repos_url":"https://api.github.com/users/dridi/repos","events_url":"https://api.github.com/users/dridi/events{/privacy}","received_events_url":"https://api.github.com/users/dridi/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/17/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/17/timeline","performed_via_github_app":null,"state_reason":"completed"},{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/18","repository_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/18/labels{/name}","comments_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/18/comments","events_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/18/events","html_url":"https://github.com/nigoroll/libvmod-dynamic/pull/18","id":217088207,"node_id":"MDExOlB1bGxSZXF1ZXN0MTEyNjQzODA4","number":18,"title":"Test with a dedicated hosts file if possible","user":{"login":"dridi","id":891744,"node_id":"MDQ6VXNlcjg5MTc0NA==","avatar_url":"https://avatars.githubusercontent.com/u/891744?v=4","gravatar_id":"","url":"https://api.github.com/users/dridi","html_url":"https://github.com/dridi","followers_url":"https://api.github.com/users/dridi/followers","following_url":"https://api.github.com/users/dridi/following{/other_user}","gists_url":"https://api.github.com/users/dridi/gists{/gist_id}","starred_url":"https://api.github.com/users/dridi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dridi/subscriptions","organizations_url":"https://api.github.com/users/dridi/orgs","repos_url":"https://api.github.com/users/dridi/repos","events_url":"https://api.github.com/users/dridi/events{/privacy}","received_events_url":"https://api.github.com/users/dridi/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":443804424,"node_id":"MDU6TGFiZWw0NDM4MDQ0MjQ=","url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/labels/enhancement","name":"enhancement","color":"84b6eb","default":true,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/milestones/1","html_url":"https://github.com/nigoroll/libvmod-dynamic/milestone/1","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/milestones/1/labels","id":2411902,"node_id":"MDk6TWlsZXN0b25lMjQxMTkwMg==","number":1,"title":"1.0","description":null,"creator":{"login":"dridi","id":891744,"node_id":"MDQ6VXNlcjg5MTc0NA==","avatar_url":"https://avatars.githubusercontent.com/u/891744?v=4","gravatar_id":"","url":"https://api.github.com/users/dridi","html_url":"https://github.com/dridi","followers_url":"https://api.github.com/users/dridi/followers","following_url":"https://api.github.com/users/dridi/following{/other_user}","gists_url":"https://api.github.com/users/dridi/gists{/gist_id}","starred_url":"https://api.github.com/users/dridi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dridi/subscriptions","organizations_url":"https://api.github.com/users/dridi/orgs","repos_url":"https://api.github.com/users/dridi/repos","events_url":"https://api.github.com/users/dridi/events{/privacy}","received_events_url":"https://api.github.com/users/dridi/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":4,"state":"open","created_at":"2017-03-26T20:50:32Z","updated_at":"2019-07-13T16:40:27Z","due_on":null,"closed_at":null},"comments":4,"created_at":"2017-03-26T20:50:36Z","updated_at":"2019-07-13T16:40:27Z","closed_at":"2019-07-13T16:40:27Z","author_association":"COLLABORATOR","active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/pulls/18","html_url":"https://github.com/nigoroll/libvmod-dynamic/pull/18","diff_url":"https://github.com/nigoroll/libvmod-dynamic/pull/18.diff","patch_url":"https://github.com/nigoroll/libvmod-dynamic/pull/18.patch","merged_at":null},"body":"Ironically, this breaks my setup. I never needed to tweak my NSS\r\nconfiguration or add entries to /etc/hosts to resolve *.localhost\r\nto the loop-back interface.\r\n\r\nHowever, we can now guess at configure time whether the test suite\r\nis expected to work. Although there's no real guarantee because of\r\nthe huge TOCTOU race between `./configure` and `make check`.","closed_by":{"login":"nigoroll","id":1528104,"node_id":"MDQ6VXNlcjE1MjgxMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1528104?v=4","gravatar_id":"","url":"https://api.github.com/users/nigoroll","html_url":"https://github.com/nigoroll","followers_url":"https://api.github.com/users/nigoroll/followers","following_url":"https://api.github.com/users/nigoroll/following{/other_user}","gists_url":"https://api.github.com/users/nigoroll/gists{/gist_id}","starred_url":"https://api.github.com/users/nigoroll/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nigoroll/subscriptions","organizations_url":"https://api.github.com/users/nigoroll/orgs","repos_url":"https://api.github.com/users/nigoroll/repos","events_url":"https://api.github.com/users/nigoroll/events{/privacy}","received_events_url":"https://api.github.com/users/nigoroll/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/18/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/18/timeline","performed_via_github_app":null,"state_reason":null},{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/19","repository_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/19/labels{/name}","comments_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/19/comments","events_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/19/events","html_url":"https://github.com/nigoroll/libvmod-dynamic/issues/19","id":218275226,"node_id":"MDU6SXNzdWUyMTgyNzUyMjY=","number":19,"title":"question: is it possible to use dynamic with saintmode?","user":{"login":"danielmotaleite","id":11890049,"node_id":"MDQ6VXNlcjExODkwMDQ5","avatar_url":"https://avatars.githubusercontent.com/u/11890049?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmotaleite","html_url":"https://github.com/danielmotaleite","followers_url":"https://api.github.com/users/danielmotaleite/followers","following_url":"https://api.github.com/users/danielmotaleite/following{/other_user}","gists_url":"https://api.github.com/users/danielmotaleite/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmotaleite/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmotaleite/subscriptions","organizations_url":"https://api.github.com/users/danielmotaleite/orgs","repos_url":"https://api.github.com/users/danielmotaleite/repos","events_url":"https://api.github.com/users/danielmotaleite/events{/privacy}","received_events_url":"https://api.github.com/users/danielmotaleite/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":443804427,"node_id":"MDU6TGFiZWw0NDM4MDQ0Mjc=","url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/labels/question","name":"question","color":"cc317c","default":true,"description":null},{"id":443804428,"node_id":"MDU6TGFiZWw0NDM4MDQ0Mjg=","url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/labels/wontfix","name":"wontfix","color":"ffffff","default":true,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2017-03-30T17:47:03Z","updated_at":"2017-03-31T11:13:20Z","closed_at":"2017-03-31T09:50:14Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hi\r\n\r\nI was looking into use saintmode for some static files, but as dynamic do not defines the backends the same way, i'm not sure if it is possible to use it or not.\r\n\r\nhttps://github.com/varnish/varnish-modules/blob/master/src/vmod_saintmode.vcc\r\n\r\nSo have you any ideia if is possible and how to use both saintmode and dynamic? \r\n\r\nthanks","closed_by":{"login":"dridi","id":891744,"node_id":"MDQ6VXNlcjg5MTc0NA==","avatar_url":"https://avatars.githubusercontent.com/u/891744?v=4","gravatar_id":"","url":"https://api.github.com/users/dridi","html_url":"https://github.com/dridi","followers_url":"https://api.github.com/users/dridi/followers","following_url":"https://api.github.com/users/dridi/following{/other_user}","gists_url":"https://api.github.com/users/dridi/gists{/gist_id}","starred_url":"https://api.github.com/users/dridi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dridi/subscriptions","organizations_url":"https://api.github.com/users/dridi/orgs","repos_url":"https://api.github.com/users/dridi/repos","events_url":"https://api.github.com/users/dridi/events{/privacy}","received_events_url":"https://api.github.com/users/dridi/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/19/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/19/timeline","performed_via_github_app":null,"state_reason":"completed"},{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/20","repository_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/20/labels{/name}","comments_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/20/comments","events_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/20/events","html_url":"https://github.com/nigoroll/libvmod-dynamic/issues/20","id":219622749,"node_id":"MDU6SXNzdWUyMTk2MjI3NDk=","number":20,"title":"FAIL: tests/test10.vtc","user":{"login":"danielmotaleite","id":11890049,"node_id":"MDQ6VXNlcjExODkwMDQ5","avatar_url":"https://avatars.githubusercontent.com/u/11890049?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmotaleite","html_url":"https://github.com/danielmotaleite","followers_url":"https://api.github.com/users/danielmotaleite/followers","following_url":"https://api.github.com/users/danielmotaleite/following{/other_user}","gists_url":"https://api.github.com/users/danielmotaleite/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmotaleite/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmotaleite/subscriptions","organizations_url":"https://api.github.com/users/danielmotaleite/orgs","repos_url":"https://api.github.com/users/danielmotaleite/repos","events_url":"https://api.github.com/users/danielmotaleite/events{/privacy}","received_events_url":"https://api.github.com/users/danielmotaleite/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2017-04-05T15:25:54Z","updated_at":"2017-04-10T19:14:06Z","closed_at":"2017-04-10T17:20:13Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Trying to compile and test this on varnish 5.1.1 i get:\r\n\r\n\r\n\r\n```\r\nchecking for a BSD-compatible install... /usr/bin/install -c\r\nchecking whether build environment is sane... yes\r\nchecking for a thread-safe mkdir -p... /bin/mkdir -p\r\nchecking for gawk... no\r\nchecking for mawk... mawk\r\nchecking whether make sets $(MAKE)... yes\r\nchecking whether make supports nested variables... yes\r\nchecking whether make supports nested variables... (cached) yes\r\nchecking for style of include used by make... GNU\r\nchecking for gcc... gcc\r\nchecking whether the C compiler works... yes\r\nchecking for C compiler default output file name... a.out\r\nchecking for suffix of executables... \r\nchecking whether we are cross compiling... no\r\nchecking for suffix of object files... o\r\nchecking whether we are using the GNU C compiler... yes\r\nchecking whether gcc accepts -g... yes\r\nchecking for gcc option to accept ISO C89... none needed\r\nchecking whether gcc understands -c and -o together... yes\r\nchecking dependency style of gcc... none\r\nchecking for ar... ar\r\nchecking the archiver (ar) interface... ar\r\nchecking build system type... x86_64-pc-linux-gnu\r\nchecking host system type... x86_64-pc-linux-gnu\r\nchecking how to print strings... printf\r\nchecking for a sed that does not truncate output... /bin/sed\r\nchecking for grep that handles long lines and -e... /bin/grep\r\nchecking for egrep... /bin/grep -E\r\nchecking for fgrep... /bin/grep -F\r\nchecking for ld used by gcc... /usr/bin/ld\r\nchecking if the linker (/usr/bin/ld) is GNU ld... yes\r\nchecking for BSD- or MS-compatible name lister (nm)... /usr/bin/nm -B\r\nchecking the name lister (/usr/bin/nm -B) interface... BSD nm\r\nchecking whether ln -s works... yes\r\nchecking the maximum length of command line arguments... 1572864\r\nchecking whether the shell understands some XSI constructs... yes\r\nchecking whether the shell understands \"+=\"... yes\r\nchecking how to convert x86_64-pc-linux-gnu file names to x86_64-pc-linux-gnu format... func_convert_file_noop\r\nchecking how to convert x86_64-pc-linux-gnu file names to toolchain format... func_convert_file_noop\r\nchecking for /usr/bin/ld option to reload object files... -r\r\nchecking for objdump... objdump\r\nchecking how to recognize dependent libraries... pass_all\r\nchecking for dlltool... no\r\nchecking how to associate runtime and link libraries... printf %s\\n\r\nchecking for archiver @FILE support... @\r\nchecking for strip... strip\r\nchecking for ranlib... ranlib\r\nchecking command to parse /usr/bin/nm -B output from gcc object... ok\r\nchecking for sysroot... no\r\nchecking for mt... mt\r\nchecking if mt is a manifest tool... no\r\nchecking how to run the C preprocessor... gcc -E\r\nchecking for ANSI C header files... yes\r\nchecking for sys/types.h... yes\r\nchecking for sys/stat.h... yes\r\nchecking for stdlib.h... yes\r\nchecking for string.h... yes\r\nchecking for memory.h... yes\r\nchecking for strings.h... yes\r\nchecking for inttypes.h... yes\r\nchecking for stdint.h... yes\r\nchecking for unistd.h... yes\r\nchecking for dlfcn.h... yes\r\nchecking for objdir... .libs\r\nchecking if gcc supports -fno-rtti -fno-exceptions... no\r\nchecking for gcc option to produce PIC... -fPIC -DPIC\r\nchecking if gcc PIC flag -fPIC -DPIC works... yes\r\nchecking if gcc static flag -static works... yes\r\nchecking if gcc supports -c -o file.o... yes\r\nchecking if gcc supports -c -o file.o... (cached) yes\r\nchecking whether the gcc linker (/usr/bin/ld -m elf_x86_64) supports shared libraries... yes\r\nchecking whether -lc should be explicitly linked in... no\r\nchecking dynamic linker characteristics... GNU/Linux ld.so\r\nchecking how to hardcode library paths into programs... immediate\r\nchecking for shl_load... no\r\nchecking for shl_load in -ldld... no\r\nchecking for dlopen... no\r\nchecking for dlopen in -ldl... yes\r\nchecking whether a program can dlopen itself... yes\r\nchecking whether a statically linked program can dlopen itself... no\r\nchecking whether stripping libraries is possible... yes\r\nchecking if libtool supports shared libraries... yes\r\nchecking whether to build shared libraries... yes\r\nchecking whether to build static libraries... no\r\nchecking for rst2man... rst2man\r\nchecking for pkg-config... /usr/bin/pkg-config\r\nchecking pkg-config is at least version 0.21... yes\r\nchecking for VARNISHAPI... yes\r\nchecking for explicit_bzero... no\r\nchecking for Varnish... 5.1.1\r\nchecking vsha256.h usability... yes\r\nchecking vsha256.h presence... yes\r\nchecking for vsha256.h... yes\r\nchecking cache/cache.h usability... yes\r\nchecking cache/cache.h presence... yes\r\nchecking for cache/cache.h... yes\r\nchecking for gcc option to accept ISO C99... -std=gnu99\r\nchecking for a Python interpreter with version >= 2.7... python\r\nchecking for python... /usr/bin/python\r\nchecking for python version... 2.7\r\nchecking for python platform... linux2\r\nchecking for python script directory... ${prefix}/lib/python2.7/dist-packages\r\nchecking for python extension module directory... ${exec_prefix}/lib/python2.7/dist-packages\r\nchecking that generated files are newer than configure... done\r\nconfigure: creating ./config.status\r\nconfig.status: creating Makefile\r\nconfig.status: creating src/Makefile\r\nconfig.status: creating config.h\r\nconfig.status: executing depfiles commands\r\nconfig.status: executing libtool commands\r\nconfigure: WARNING: unrecognized options: --disable-maintainer-mode\r\n   dh_auto_build\r\n\tmake -j1\r\nmake[1]: Entering directory '/usr/src/libvmod-dynamic'\r\nmake  all-recursive\r\nmake[2]: Entering directory '/usr/src/libvmod-dynamic'\r\nMaking all in src\r\nmake[3]: Entering directory '/usr/src/libvmod-dynamic/src'\r\n/usr/bin/python /usr/share/varnish/vmodtool.py -o vcc_dynamic_if ./vmod_dynamic.vcc\r\n/bin/bash ../libtool  --tag=CC   --mode=compile gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I..    -I/usr/include/varnish  -Wall -Werror -g -O2 -c -o vmod_dynamic.lo vmod_dynamic.c\r\nlibtool: compile:  gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -I/usr/include/varnish -Wall -Werror -g -O2 -c vmod_dynamic.c  -fPIC -DPIC -o .libs/vmod_dynamic.o\r\n/bin/bash ../libtool  --tag=CC   --mode=compile gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I..    -I/usr/include/varnish  -Wall -Werror -g -O2 -c -o vcc_dynamic_if.lo vcc_dynamic_if.c\r\nlibtool: compile:  gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -I/usr/include/varnish -Wall -Werror -g -O2 -c vcc_dynamic_if.c  -fPIC -DPIC -o .libs/vcc_dynamic_if.o\r\n/bin/bash ../libtool  --tag=CC   --mode=link gcc -std=gnu99 -I/usr/include/varnish  -Wall -Werror -g -O2 -lvarnishapi  -module -export-dynamic -avoid-version -shared  -o libvmod_dynamic.la -rpath /usr/lib/varnish/vmods vmod_dynamic.lo vcc_dynamic_if.lo  \r\nlibtool: link: gcc -shared  -fPIC -DPIC  .libs/vmod_dynamic.o .libs/vcc_dynamic_if.o   -lvarnishapi  -O2   -Wl,-soname -Wl,libvmod_dynamic.so -o .libs/libvmod_dynamic.so\r\nlibtool: link: ( cd \".libs\" && rm -f \"libvmod_dynamic.la\" && ln -s \"../libvmod_dynamic.la\" \"libvmod_dynamic.la\" )\r\nrst2man vmod_dynamic.man.rst vmod_dynamic.3\r\nmake[3]: Leaving directory '/usr/src/libvmod-dynamic/src'\r\nmake[3]: Entering directory '/usr/src/libvmod-dynamic'\r\nmake[3]: Leaving directory '/usr/src/libvmod-dynamic'\r\nmake[2]: Leaving directory '/usr/src/libvmod-dynamic'\r\nmake[1]: Leaving directory '/usr/src/libvmod-dynamic'\r\n   dh_auto_test\r\n\tmake -j1 check\r\nmake[1]: Entering directory '/usr/src/libvmod-dynamic'\r\nMaking check in src\r\nmake[2]: Entering directory '/usr/src/libvmod-dynamic/src'\r\nmake  check-TESTS\r\nmake[3]: Entering directory '/usr/src/libvmod-dynamic/src'\r\nmake[4]: Entering directory '/usr/src/libvmod-dynamic/src'\r\nPASS: tests/test01.vtc\r\nPASS: tests/test02.vtc\r\nPASS: tests/test03.vtc\r\nPASS: tests/test04.vtc\r\nPASS: tests/test05.vtc\r\nPASS: tests/test06.vtc\r\nPASS: tests/test07.vtc\r\nPASS: tests/test08.vtc\r\nPASS: tests/test09.vtc\r\nFAIL: tests/test10.vtc\r\nmake[5]: Entering directory '/usr/src/libvmod-dynamic/src'\r\nmake[5]: Nothing to be done for 'all'.\r\nmake[5]: Leaving directory '/usr/src/libvmod-dynamic/src'\r\n============================================================================\r\nTestsuite summary for libvmod-dynamic 0.2\r\n============================================================================\r\n# TOTAL: 10\r\n# PASS:  9\r\n# SKIP:  0\r\n# XFAIL: 0\r\n# FAIL:  1\r\n# XPASS: 0\r\n# ERROR: 0\r\n============================================================================\r\nSee src/test-suite.log\r\n============================================================================\r\nMakefile:767: recipe for target 'test-suite.log' failed\r\nmake[4]: *** [test-suite.log] Error 1\r\nmake[4]: Leaving directory '/usr/src/libvmod-dynamic/src'\r\nMakefile:873: recipe for target 'check-TESTS' failed\r\nmake[3]: *** [check-TESTS] Error 2\r\nmake[3]: Leaving directory '/usr/src/libvmod-dynamic/src'\r\nMakefile:939: recipe for target 'check-am' failed\r\nmake[2]: *** [check-am] Error 2\r\nmake[2]: Leaving directory '/usr/src/libvmod-dynamic/src'\r\nMakefile:481: recipe for target 'check-recursive' failed\r\nmake[1]: *** [check-recursive] Error 1\r\nmake[1]: Leaving directory '/usr/src/libvmod-dynamic'\r\ndh_auto_test: make -j1 check returned exit code 2\r\ndebian/rules:12: recipe for target 'build' failed\r\nmake: *** [build] Error 2\r\n\r\n````\r\n\r\nThe log i get: \r\n```\r\n=============================================\r\n   libvmod-dynamic 0.2: src/test-suite.log\r\n=============================================\r\n\r\n# TOTAL: 10\r\n# PASS:  9\r\n# SKIP:  0\r\n# XFAIL: 0\r\n# FAIL:  1\r\n# XPASS: 0\r\n# ERROR: 0\r\n\r\n.. contents:: :depth: 2\r\n\r\nFAIL: tests/test10\r\n==================\r\n\r\n**** top   0.0 extmacro def pwd=/usr/src/libvmod-dynamic/src\r\n**** top   0.0 extmacro def vmod_dynamic=dynamic from \"/usr/src/libvmod-dynamic/src/.libs/libvmod_dynamic.so\"\r\n**** top   0.0 extmacro def localhost=127.0.0.1\r\n**** top   0.0 extmacro def bad_backend=127.0.0.1 18925\r\n**** top   0.0 extmacro def bad_ip=192.0.2.255\r\n**** top   0.0 macro def tmpdir=/tmp/vtc.12295.77019977\r\n*    top   0.0 TEST ./tests/test10.vtc starting\r\n**   top   0.0 === varnishtest \"max_connections\"\r\n*    top   0.0 TEST max_connections\r\n**   top   0.0 === barrier b1 cond 2\r\n**   top   0.0 === server s1 {\r\n**   s1    0.0 Starting server\r\n**** s1    0.0 macro def s1_addr=127.0.0.1\r\n**** s1    0.0 macro def s1_port=37297\r\n**** s1    0.0 macro def s1_sock=127.0.0.1 37297\r\n*    s1    0.0 Listen on 127.0.0.1 37297\r\n**   top   0.0 === varnish v1 -vcl+backend {\r\n**   s1    0.0 Started on 127.0.0.1 37297\r\n**   v1    0.0 Launch\r\n***  v1    0.0 CMD: cd ${pwd} && exec varnishd  -d -n /tmp/vtc.12295.77019977/v1 -l 2m,1m,- -p auto_restart=off -p syslog_cli_traffic=off -p sigsegv_handler=on -p thread_pool_min=10 -p debug=+vtc_mode -a '127.0.0.1:0' -M '127.0.0.1 21937' -P /tmp/vtc.12295.77019977/v1/varnishd.pid \r\n***  v1    0.0 CMD: cd /usr/src/libvmod-dynamic/src && exec varnishd  -d -n /tmp/vtc.12295.77019977/v1 -l 2m,1m,- -p auto_restart=off -p syslog_cli_traffic=off -p sigsegv_handler=on -p thread_pool_min=10 -p debug=+vtc_mode -a '127.0.0.1:0' -M '127.0.0.1 21937' -P /tmp/vtc.12295.77019977/v1/varnishd.pid \r\n***  v1    0.0 PID: 12301\r\n**** v1    0.0 macro def v1_pid=12301\r\n**** v1    0.0 macro def v1_name=/tmp/vtc.12295.77019977/v1\r\n***  v1    0.0 debug|Debug: Platform: Linux,4.7.0-0.bpo.1-amd64,x86_64,-junix,-smalloc,-smalloc,-hcritbit\r\n***  v1    0.0 debug|200 285     \r\n***  v1    0.0 debug|-----------------------------\r\n***  v1    0.0 debug|Varnish Cache CLI 1.0\r\n***  v1    0.0 debug|-----------------------------\r\n***  v1    0.0 debug|Linux,4.7.0-0.bpo.1-amd64,x86_64,-junix,-smalloc,-smalloc,-hcritbit\r\n***  v1    0.0 debug|varnish-5.1.1 revision de38712\r\n***  v1    0.0 debug|\r\n***  v1    0.0 debug|Type 'help' for command list.\r\n***  v1    0.0 debug|Type 'quit' to close CLI session.\r\n***  v1    0.0 debug|Type 'start' to launch worker process.\r\n***  v1    0.0 debug|\r\n**** v1    0.1 CLIPOLL 1 0x1 0x0\r\n***  v1    0.1 CLI connection fd = 10\r\n***  v1    0.1 CLI RX  107\r\n**** v1    0.1 CLI RX|stvjhhhfmktflzoagpgicdcedgmqaylg\r\n**** v1    0.1 CLI RX|\r\n**** v1    0.1 CLI RX|Authentication required.\r\n**** v1    0.1 CLI TX|auth 8c27b560d816ab69953f630bf040144ecc8919912555de6832188a04f87db7d9\r\n***  v1    0.1 CLI RX  200\r\n**** v1    0.1 CLI RX|-----------------------------\r\n**** v1    0.1 CLI RX|Varnish Cache CLI 1.0\r\n**** v1    0.1 CLI RX|-----------------------------\r\n**** v1    0.1 CLI RX|Linux,4.7.0-0.bpo.1-amd64,x86_64,-junix,-smalloc,-smalloc,-hcritbit\r\n**** v1    0.1 CLI RX|varnish-5.1.1 revision de38712\r\n**** v1    0.1 CLI RX|\r\n**** v1    0.1 CLI RX|Type 'help' for command list.\r\n**** v1    0.1 CLI RX|Type 'quit' to close CLI session.\r\n**** v1    0.1 CLI RX|Type 'start' to launch worker process.\r\n**** v1    0.1 CLI TX|vcl.inline vcl1 << %XJEIFLH|)Xspa8P\r\n**** v1    0.1 CLI TX|vcl 4.0;\r\n**** v1    0.1 CLI TX|backend s1 { .host = \"127.0.0.1\"; .port = \"37297\"; }\r\n**** v1    0.1 CLI TX|\r\n**** v1    0.1 CLI TX|\r\n**** v1    0.1 CLI TX|\\timport dynamic from \"/usr/src/libvmod-dynamic/src/.libs/libvmod_dynamic.so\";\r\n**** v1    0.1 CLI TX|\r\n**** v1    0.1 CLI TX|\\tsub vcl_init {\r\n**** v1    0.1 CLI TX|\\t\\tnew d1 = dynamic.director(\r\n**** v1    0.1 CLI TX|\\t\\t\\tport = \"37297\",\r\n**** v1    0.1 CLI TX|\\t\\t\\tmax_connections = 1);\r\n**** v1    0.1 CLI TX|\\t}\r\n**** v1    0.1 CLI TX|\r\n**** v1    0.1 CLI TX|\\tsub vcl_recv {\r\n**** v1    0.1 CLI TX|\\t\\tset req.backend_hint = d1.backend(\"127.0.0.1\");\r\n**** v1    0.1 CLI TX|\\t\\treturn (pass);\r\n**** v1    0.1 CLI TX|\\t}\r\n**** v1    0.1 CLI TX|\r\n**** v1    0.1 CLI TX|\\tsub vcl_backend_error {\r\n**** v1    0.1 CLI TX|\\t\\tset beresp.status = 429;\r\n**** v1    0.1 CLI TX|\\t}\r\n**** v1    0.1 CLI TX|\r\n**** v1    0.1 CLI TX|%XJEIFLH|)Xspa8P\r\n***  v1    0.3 CLI RX  200\r\n**** v1    0.3 CLI RX|VCL compiled.\r\n**** v1    0.3 CLI TX|vcl.use vcl1\r\n***  v1    0.3 CLI RX  200\r\n**   v1    0.3 Start\r\n**** v1    0.3 CLI TX|start\r\n***  v1    0.3 debug|Debug: Child (12311) Started\r\n***  v1    0.4 CLI RX  200\r\n***  v1    0.4 wait-running\r\n**** v1    0.4 CLI TX|status\r\n***  v1    0.4 debug|Info: Child (12311) said Child starts\r\n***  v1    0.4 CLI RX  200\r\n**** v1    0.4 CLI RX|Child in state running\r\n**** v1    0.4 CLI TX|debug.xid 999\r\n**** v1    0.4 vsl|          0 CLI             - Rd vcl.load \"vcl1\" vcl_vcl1.1491405606.451286077/vgc.so 1auto\r\n**** v1    0.4 vsl|          0 CLI             - Wr 200 55 Loaded \"vcl_vcl1.1491405606.451286077/vgc.so\" as \"vcl1\"\r\n**** v1    0.4 vsl|          0 CLI             - Rd vcl.use \"vcl1\"\r\n**** v1    0.4 vsl|          0 CLI             - Wr 200 0 \r\n**** v1    0.4 vsl|          0 CLI             - Rd start\r\n**** v1    0.4 vsl|          0 CLI             - Wr 200 0 \r\n***  v1    0.4 CLI RX  200\r\n**** v1    0.4 CLI RX|XID is 999\r\n**** v1    0.4 CLI TX|debug.listen_address\r\n***  v1    0.5 CLI RX  200\r\n**** v1    0.5 CLI RX|127.0.0.1 36231\r\n**   v1    0.5 Listen on 127.0.0.1 36231\r\n**** v1    0.5 macro def v1_addr=127.0.0.1\r\n**** v1    0.5 macro def v1_port=36231\r\n**** v1    0.5 macro def v1_sock=127.0.0.1 36231\r\n**   top   0.5 === client c1 {\r\n**   c1    0.5 Starting client\r\n**   top   0.5 === client c2 {\r\n**   c2    0.5 Starting client\r\n**   c2    0.5 Waiting for client\r\n***  c2    0.5 Connect to 127.0.0.1 36231\r\n***  c1    0.5 Connect to 127.0.0.1 36231\r\n***  c2    0.5 connected fd 11 from 127.0.0.1 46416 to 127.0.0.1 36231\r\n***  c1    0.5 connected fd 12 from 127.0.0.1 46418 to 127.0.0.1 36231\r\n**   c2    0.5 === txreq\r\n**** c2    0.5 txreq|GET / HTTP/1.1\\r\r\n**** c2    0.5 txreq|\\r\r\n**   c1    0.5 === txreq\r\n**   c2    0.5 === rxresp\r\n**** c1    0.5 txreq|GET / HTTP/1.1\\r\r\n**** c1    0.5 txreq|\\r\r\n**   c1    0.5 === rxresp\r\n***  s1    0.5 accepted fd 5\r\n**   s1    0.5 === rxreq\r\n**** s1    0.5 rxhdr|GET / HTTP/1.1\\r\r\n**** s1    0.5 rxhdr|X-Forwarded-For: 127.0.0.1\\r\r\n**** s1    0.5 rxhdr|X-Varnish: 1004\\r\r\n**** s1    0.5 rxhdr|\\r\r\n**** s1    0.5 rxhdrlen = 63\r\n**** s1    0.5 http[ 0] |GET\r\n**** s1    0.5 http[ 1] |/\r\n**** s1    0.5 http[ 2] |HTTP/1.1\r\n**** s1    0.5 http[ 3] |X-Forwarded-For: 127.0.0.1\r\n**** s1    0.5 http[ 4] |X-Varnish: 1004\r\n**** s1    0.5 bodylen = 0\r\n**   s1    0.5 === barrier b1 sync\r\n**** s1    0.5 Barrier(b1) wait 1 of 2\r\n**** v1    0.5 vsl|          0 CLI             - Rd debug.xid 999 \r\n**** v1    0.5 vsl|          0 CLI             - Wr 200 10 XID is 999\r\n**** v1    0.5 vsl|          0 CLI             - Rd debug.listen_address \r\n**** v1    0.5 vsl|          0 CLI             - Wr 200 16 127.0.0.1 36231\r\n\r\n**** v1    0.5 vsl|       1000 Begin           c sess 0 HTTP/1\r\n**** v1    0.5 vsl|       1000 SessOpen        c 127.0.0.1 46416 127.0.0.1:36231 127.0.0.1 36231 1491405606.804795 20\r\n**** v1    0.5 vsl|       1001 Begin           c sess 0 HTTP/1\r\n**** v1    0.5 vsl|       1001 SessOpen        c 127.0.0.1 46418 127.0.0.1:36231 127.0.0.1 36231 1491405606.804846 21\r\n**** v1    0.5 vsl|       1000 Link            c req 1002 rxreq\r\n**** v1    0.5 vsl|       1001 Link            c req 1003 rxreq\r\n**** v1    0.5 vsl|          0 Timestamp       - vmod-dynamic vcl1.d1(127.0.0.1) Lookup: 1491405606.805036 0.000000 0.000000\r\n**** v1    0.5 vsl|          0 Timestamp       - vmod-dynamic vcl1.d1(127.0.0.1) Results: 1491405606.805164 0.000128 0.000128\r\n**** v1    0.5 vsl|          0 Timestamp       - vmod-dynamic vcl1.d1(127.0.0.1) Update: 1491405606.805242 0.000206 0.000078\r\n**** v1    3.4 vsl|          0 CLI             - Rd ping\r\n**** v1    3.4 vsl|          0 CLI             - Wr 200 19 PONG 1491405609 1.0\r\n**** v1    6.4 vsl|          0 CLI             - Rd ping\r\n**** v1    6.4 vsl|          0 CLI             - Wr 200 19 PONG 1491405612 1.0\r\n**** v1    9.4 vsl|          0 CLI             - Rd ping\r\n**** v1    9.4 vsl|          0 CLI             - Wr 200 19 PONG 1491405615 1.0\r\n**** v1   12.4 vsl|          0 CLI             - Rd ping\r\n**** v1   12.4 vsl|          0 CLI             - Wr 200 19 PONG 1491405618 1.0\r\n**** v1   15.4 vsl|          0 CLI             - Rd ping\r\n**** v1   15.4 vsl|          0 CLI             - Wr 200 19 PONG 1491405621 1.0\r\n**** v1   18.4 vsl|          0 CLI             - Rd ping\r\n**** v1   18.4 vsl|          0 CLI             - Wr 200 19 PONG 1491405624 1.0\r\n**** v1   21.4 vsl|          0 CLI             - Rd ping\r\n**** v1   21.4 vsl|          0 CLI             - Wr 200 19 PONG 1491405627 1.0\r\n**** v1   24.4 vsl|          0 CLI             - Rd ping\r\n**** v1   24.4 vsl|          0 CLI             - Wr 200 19 PONG 1491405630 1.0\r\n**** v1   27.4 vsl|          0 CLI             - Rd ping\r\n**** v1   27.4 vsl|          0 CLI             - Wr 200 19 PONG 1491405633 1.0\r\n**** v1   30.4 vsl|          0 CLI             - Rd ping\r\n**** v1   30.4 vsl|          0 CLI             - Wr 200 19 PONG 1491405636 1.0\r\n---- c1   30.5 HTTP rx timeout (fd:12 30000 ms)\r\n---- c2   30.5 HTTP rx timeout (fd:11 30000 ms)\r\n*    top  30.5 RESETTING after ./tests/test10.vtc\r\n**   s1   30.5 Waiting for server (4/-1)\r\n**** s1   30.5 macro undef s1_addr\r\n**** s1   30.5 macro undef s1_port\r\n**** s1   30.5 macro undef s1_sock\r\n**   c1   30.5 Waiting for client\r\n**   v1   30.5 Wait\r\n**** v1   30.5 CLI TX|backend.list\r\n**** v1   30.5 vsl|       1005 Begin           b bereq 1003 pass\r\n**** v1   30.5 vsl|       1005 Timestamp       b Start: 1491405606.805094 0.000000 0.000000\r\n**** v1   30.5 vsl|       1005 BereqMethod     b GET\r\n**** v1   30.5 vsl|       1005 BereqURL        b /\r\n**** v1   30.5 vsl|       1005 BereqProtocol   b HTTP/1.1\r\n**** v1   30.5 vsl|       1005 BereqHeader     b X-Forwarded-For: 127.0.0.1\r\n**** v1   30.5 vsl|       1005 BereqHeader     b X-Varnish: 1005\r\n**** v1   30.5 vsl|       1005 VCL_call        b BACKEND_FETCH\r\n**** v1   30.5 vsl|       1005 VCL_return      b fetch\r\n**** v1   30.5 vsl|       1005 BackendOpen     b 24 vcl1.d1(127.0.0.1) 127.0.0.1 37297 127.0.0.1 45930\r\n**** v1   30.5 vsl|       1005 BackendStart    b 127.0.0.1 37297\r\n**** v1   30.5 vsl|       1005 Timestamp       b Bereq: 1491405606.805499 0.000405 0.000405\r\n**** v1   30.5 vsl|       1005 FetchError      b HTC status -1\r\n**** v1   30.5 vsl|       1005 BackendClose    b 24 vcl1.d1(127.0.0.1)\r\n**** v1   30.5 vsl|       1005 Timestamp       b Beresp: 1491405636.835078 30.029983 30.029578\r\n**** v1   30.5 vsl|       1005 Timestamp       b Error: 1491405636.835090 30.029996 0.000013\r\n**** v1   30.5 vsl|       1005 BerespProtocol  b HTTP/1.1\r\n**** v1   30.5 vsl|       1005 BerespStatus    b 503\r\n**** v1   30.5 vsl|       1005 BerespReason    b Service Unavailable\r\n**** v1   30.5 vsl|       1005 BerespReason    b Backend fetch failed\r\n**** v1   30.5 vsl|       1005 BerespHeader    b Date: Wed, 05 Apr 2017 15:20:36 GMT\r\n**** v1   30.5 vsl|       1005 BerespHeader    b Server: Varnish\r\n**** v1   30.5 vsl|       1005 VCL_call        b BACKEND_ERROR\r\n**** v1   30.5 vsl|       1005 BerespStatus    b 429\r\n**** v1   30.5 vsl|       1005 BerespReason    b Unknown HTTP Status\r\n**** v1   30.5 vsl|       1005 BerespHeader    b Content-Type: text/html; charset=utf-8\r\n**** v1   30.5 vsl|       1005 BerespHeader    b Retry-After: 5\r\n**** v1   30.5 vsl|       1005 VCL_return      b deliver\r\n**** v1   30.5 vsl|       1005 Storage         b malloc Transient\r\n**** v1   30.5 vsl|       1005 ObjProtocol     b HTTP/1.1\r\n**** v1   30.5 vsl|       1005 ObjStatus       b 429\r\n**** v1   30.5 vsl|       1005 ObjReason       b Unknown HTTP Status\r\n**** v1   30.5 vsl|       1005 ObjHeader       b Date: Wed, 05 Apr 2017 15:20:36 GMT\r\n**** v1   30.5 vsl|       1005 ObjHeader       b Server: Varnish\r\n**** v1   30.5 vsl|       1005 ObjHeader       b Content-Type: text/html; charset=utf-8\r\n**** v1   30.5 vsl|       1005 ObjHeader       b Retry-After: 5\r\n**** v1   30.5 vsl|       1005 Length          b 278\r\n**** v1   30.5 vsl|       1005 BereqAcct       b 63 0 63 0 0 0\r\n**** v1   30.5 vsl|       1005 End             b \r\n**** v1   30.5 vsl|       1003 Begin           c req 1001 rxreq\r\n**** v1   30.5 vsl|       1003 Timestamp       c Start: 1491405606.804885 0.000000 0.000000\r\n**** v1   30.5 vsl|       1003 Timestamp       c Req: 1491405606.804885 0.000000 0.000000\r\n**** v1   30.5 vsl|       1003 ReqStart        c 127.0.0.1 46418\r\n**** v1   30.5 vsl|       1003 ReqMethod       c GET\r\n**** v1   30.5 vsl|       1003 ReqURL          c /\r\n**** v1   30.5 vsl|       1003 ReqProtocol     c HTTP/1.1\r\n**** v1   30.5 vsl|       1003 ReqHeader       c X-Forwarded-For: 127.0.0.1\r\n**** v1   30.5 vsl|       1003 VCL_call        c RECV\r\n**** v1   30.5 vsl|       1003 VCL_return      c pass\r\n**** v1   30.5 vsl|       1003 VCL_call        c HASH\r\n**** v1   30.5 vsl|       1003 VCL_return      c lookup\r\n**** v1   30.5 vsl|       1003 VCL_call        c PASS\r\n**** v1   30.5 vsl|       1003 VCL_return      c fetch\r\n**** v1   30.5 vsl|       1003 Link            c bereq 1005 pass\r\n**** v1   30.5 vsl|       1003 Timestamp       c Fetch: 1491405636.835360 30.030474 30.030474\r\n**** v1   30.5 vsl|       1003 RespProtocol    c HTTP/1.1\r\n**** v1   30.5 vsl|       1003 RespStatus      c 429\r\n**** v1   30.5 vsl|       1003 RespReason      c Unknown HTTP Status\r\n**** v1   30.5 vsl|       1003 RespHeader      c Date: Wed, 05 Apr 2017 15:20:36 GMT\r\n**** v1   30.5 vsl|       1003 RespHeader      c Server: Varnish\r\n**** v1   30.5 vsl|       1003 RespHeader      c Content-Type: text/html; charset=utf-8\r\n**** v1   30.5 vsl|       1003 RespHeader      c Retry-After: 5\r\n**** v1   30.5 vsl|       1003 RespHeader      c X-Varnish: 1003\r\n**** v1   30.5 vsl|       1003 RespHeader      c Age: 0\r\n**** v1   30.5 vsl|       1003 RespHeader      c Via: 1.1 varnish (Varnish/5.1)\r\n**** v1   30.5 vsl|       1003 VCL_call        c DELIVER\r\n**** v1   30.5 vsl|       1003 VCL_return      c deliver\r\n**** v1   30.5 vsl|       1003 Timestamp       c Process: 1491405636.835399 30.030514 0.000039\r\n**** v1   30.5 vsl|       1003 RespHeader      c Content-Length: 278\r\n**** v1   30.5 vsl|       1003 Debug           c RES_MODE 2\r\n**** v1   30.5 vsl|       1003 RespHeader      c Connection: keep-alive\r\n**** v1   30.5 vsl|       1003 Timestamp       c Resp: 1491405636.835462 30.030577 0.000063\r\n**** v1   30.5 vsl|       1003 ReqAcct         c 18 0 18 248 278 526\r\n**** v1   30.5 vsl|       1003 End             c \r\n***  v1   30.6 CLI RX  200\r\n**** v1   30.6 CLI RX|Backend name                   Admin      Probe                Last updated\r\n**** v1   30.6 CLI RX|vcl1.s1                        probe      Healthy (no probe)   Wed, 05 Apr 2017 15:20:06 GMT\r\n**** v1   30.6 CLI RX|vcl1.d1(127.0.0.1)             probe      Healthy (no probe)   Wed, 05 Apr 2017 15:20:06 GMT\r\n***  v1   30.6 debug|Debug: Stopping Child\r\n**** v1   30.6 vsl|          0 CLI             - Rd backend.list \r\n**** v1   30.6 vsl|          0 CLI             - Wr 200 261 Backend name                   Admin      Probe                Last updated\r\nvcl1.s1                        probe      Healthy (no probe)   Wed, 05 Apr 2017 15:20:06 GMT\r\nvcl1.d1(127.0.0.1)             probe      Healthy (no probe)   Wed, 05 Apr\r\n**** v1   30.6 vsl|          0 CLI             - EOF on CLI connection, worker stops\r\n***  v1   31.6 debug|Info: Child (12311) ended\r\n***  v1   31.6 debug|Info: Child (12311) said Child dies\r\n***  v1   31.6 debug|Debug: Child cleanup complete\r\n**** v1   31.6 STDOUT poll 0x10\r\n**   v1   31.6 R 12301 Status: 0000 (u 0.164000 s 0.040000)\r\n*    top  31.6 TEST ./tests/test10.vtc FAILED\r\n#    top  TEST ./tests/test10.vtc FAILED (31.646) exit=2\r\n```","closed_by":{"login":"dridi","id":891744,"node_id":"MDQ6VXNlcjg5MTc0NA==","avatar_url":"https://avatars.githubusercontent.com/u/891744?v=4","gravatar_id":"","url":"https://api.github.com/users/dridi","html_url":"https://github.com/dridi","followers_url":"https://api.github.com/users/dridi/followers","following_url":"https://api.github.com/users/dridi/following{/other_user}","gists_url":"https://api.github.com/users/dridi/gists{/gist_id}","starred_url":"https://api.github.com/users/dridi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dridi/subscriptions","organizations_url":"https://api.github.com/users/dridi/orgs","repos_url":"https://api.github.com/users/dridi/repos","events_url":"https://api.github.com/users/dridi/events{/privacy}","received_events_url":"https://api.github.com/users/dridi/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/20/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/20/timeline","performed_via_github_app":null,"state_reason":"completed"},{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/21","repository_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/21/labels{/name}","comments_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/21/comments","events_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/21/events","html_url":"https://github.com/nigoroll/libvmod-dynamic/issues/21","id":225908469,"node_id":"MDU6SXNzdWUyMjU5MDg0Njk=","number":21,"title":"Respect TTL in DNS record","user":{"login":"teohhanhui","id":548843,"node_id":"MDQ6VXNlcjU0ODg0Mw==","avatar_url":"https://avatars.githubusercontent.com/u/548843?v=4","gravatar_id":"","url":"https://api.github.com/users/teohhanhui","html_url":"https://github.com/teohhanhui","followers_url":"https://api.github.com/users/teohhanhui/followers","following_url":"https://api.github.com/users/teohhanhui/following{/other_user}","gists_url":"https://api.github.com/users/teohhanhui/gists{/gist_id}","starred_url":"https://api.github.com/users/teohhanhui/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/teohhanhui/subscriptions","organizations_url":"https://api.github.com/users/teohhanhui/orgs","repos_url":"https://api.github.com/users/teohhanhui/repos","events_url":"https://api.github.com/users/teohhanhui/events{/privacy}","received_events_url":"https://api.github.com/users/teohhanhui/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":12,"created_at":"2017-05-03T07:58:07Z","updated_at":"2019-07-13T16:46:03Z","closed_at":"2017-08-11T16:13:11Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"It'd be great if the DNS resolution can respect the TTL specified in the DNS record (as it should), and also not to apply the TTL if it resolved to no address.","closed_by":{"login":"nigoroll","id":1528104,"node_id":"MDQ6VXNlcjE1MjgxMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1528104?v=4","gravatar_id":"","url":"https://api.github.com/users/nigoroll","html_url":"https://github.com/nigoroll","followers_url":"https://api.github.com/users/nigoroll/followers","following_url":"https://api.github.com/users/nigoroll/following{/other_user}","gists_url":"https://api.github.com/users/nigoroll/gists{/gist_id}","starred_url":"https://api.github.com/users/nigoroll/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nigoroll/subscriptions","organizations_url":"https://api.github.com/users/nigoroll/orgs","repos_url":"https://api.github.com/users/nigoroll/repos","events_url":"https://api.github.com/users/nigoroll/events{/privacy}","received_events_url":"https://api.github.com/users/nigoroll/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/21/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/21/timeline","performed_via_github_app":null,"state_reason":"completed"},{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/22","repository_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/22/labels{/name}","comments_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/22/comments","events_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/22/events","html_url":"https://github.com/nigoroll/libvmod-dynamic/issues/22","id":233509305,"node_id":"MDU6SXNzdWUyMzM1MDkzMDU=","number":22,"title":"m4 include issues","user":{"login":"redbox-cdn","id":7666840,"node_id":"MDQ6VXNlcjc2NjY4NDA=","avatar_url":"https://avatars.githubusercontent.com/u/7666840?v=4","gravatar_id":"","url":"https://api.github.com/users/redbox-cdn","html_url":"https://github.com/redbox-cdn","followers_url":"https://api.github.com/users/redbox-cdn/followers","following_url":"https://api.github.com/users/redbox-cdn/following{/other_user}","gists_url":"https://api.github.com/users/redbox-cdn/gists{/gist_id}","starred_url":"https://api.github.com/users/redbox-cdn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/redbox-cdn/subscriptions","organizations_url":"https://api.github.com/users/redbox-cdn/orgs","repos_url":"https://api.github.com/users/redbox-cdn/repos","events_url":"https://api.github.com/users/redbox-cdn/events{/privacy}","received_events_url":"https://api.github.com/users/redbox-cdn/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2017-06-05T06:57:30Z","updated_at":"2018-09-12T15:18:06Z","closed_at":"2018-09-12T15:18:06Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"hi \r\n\r\nI am facing following error. Does anyone know what is missing ?\r\n\r\n### here is my details\r\nCentos 6.7\r\nVarnish4.1.6\r\npkg-config 0.23\r\nautomake 1.12.1\r\nautoconf  2.69\r\nm4  1.4.13\r\n\r\n```\r\n./configure\r\n\r\n./configure: line 10817: PKG_PROG_PKG_CONFIG: command not found\r\n./configure: line 10818: PKG_PROG_PKG_CONFIG: command not found\r\n./configure: line 10819: PKG_PROG_PKG_CONFIG: command not found\r\n./configure: line 10820: PKG_PROG_PKG_CONFIG: command not found\r\n./configure: line 10821: PKG_PROG_PKG_CONFIG: command not found\r\n./configure: line 10822: PKG_PROG_PKG_CONFIG: command not found\r\n./configure: line 10824: syntax error near unexpected token `0.21'\r\n./configure: line 10824: `      PKG_PROG_PKG_CONFIG(0.21)'\r\n```\r\n\r\n```\r\n\r\nautogen.sh \r\n+ aclocal -I m4 -I /usr/local/varnish/share/aclocal\r\nconfigure.ac:14: warning: AC_LANG_CONFTEST: no AC_LANG_SOURCE call detected in body\r\n../../lib/autoconf/lang.m4:193: AC_LANG_CONFTEST is expanded from...\r\n../../lib/autoconf/general.m4:2661: _AC_LINK_IFELSE is expanded from...\r\n../../lib/autoconf/general.m4:2678: AC_LINK_IFELSE is expanded from...\r\nm4/libtool.m4:1022: _LT_SYS_MODULE_PATH_AIX is expanded from...\r\nm4/libtool.m4:4161: _LT_LINKER_SHLIBS is expanded from...\r\nm4/libtool.m4:5236: _LT_LANG_C_CONFIG is expanded from...\r\nm4/libtool.m4:138: _LT_SETUP is expanded from...\r\nm4/libtool.m4:67: LT_INIT is expanded from...\r\nconfigure.ac:14: the top level\r\nconfigure.ac:14: warning: AC_LANG_CONFTEST: no AC_LANG_SOURCE call detected in body\r\n../../lib/autoconf/lang.m4:193: AC_LANG_CONFTEST is expanded from...\r\n../../lib/autoconf/general.m4:2661: _AC_LINK_IFELSE is expanded from...\r\n../../lib/autoconf/general.m4:2678: AC_LINK_IFELSE is expanded from...\r\nm4/libtool.m4:4161: _LT_LINKER_SHLIBS is expanded from...\r\nm4/libtool.m4:5236: _LT_LANG_C_CONFIG is expanded from...\r\nm4/libtool.m4:138: _LT_SETUP is expanded from...\r\nm4/libtool.m4:67: LT_INIT is expanded from...\r\nconfigure.ac:14: the top level\r\nconfigure.ac:25: warning: PKG_PROG_PKG_CONFIG is m4_require'd but not m4_defun'd\r\nm4/ax_pkg_check_var.m4:10: PKG_CHECK_VAR is expanded from...\r\n/usr/local/varnish/share/aclocal/varnish.m4:36: _VARNISH_PKG_CONFIG is expanded from...\r\n/usr/local/varnish/share/aclocal/varnish.m4:255: VARNISH_PREREQ is expanded from...\r\nconfigure.ac:25: the top level\r\nconfigure.ac:28: warning: PKG_PROG_PKG_CONFIG is m4_require'd but not m4_defun'd\r\nm4/ax_pkg_check_var.m4:10: PKG_CHECK_VAR is expanded from...\r\nconfigure.ac:28: the top level\r\n+ libtoolize --copy --force\r\nlibtoolize: putting auxiliary files in AC_CONFIG_AUX_DIR, `build-aux'.\r\nlibtoolize: copying file `build-aux/ltmain.sh'\r\nlibtoolize: putting macros in AC_CONFIG_MACRO_DIR, `m4'.\r\nlibtoolize: copying file `m4/libtool.m4'\r\nlibtoolize: copying file `m4/ltoptions.m4'\r\nlibtoolize: copying file `m4/ltsugar.m4'\r\nlibtoolize: copying file `m4/ltversion.m4'\r\nlibtoolize: copying file `m4/lt~obsolete.m4'\r\n+ autoheader\r\nconfigure.ac:14: warning: AC_LANG_CONFTEST: no AC_LANG_SOURCE call detected in body\r\n../../lib/autoconf/lang.m4:193: AC_LANG_CONFTEST is expanded from...\r\n../../lib/autoconf/general.m4:2661: _AC_LINK_IFELSE is expanded from...\r\n../../lib/autoconf/general.m4:2678: AC_LINK_IFELSE is expanded from...\r\nm4/libtool.m4:1022: _LT_SYS_MODULE_PATH_AIX is expanded from...\r\nm4/libtool.m4:4161: _LT_LINKER_SHLIBS is expanded from...\r\nm4/libtool.m4:5236: _LT_LANG_C_CONFIG is expanded from...\r\nm4/libtool.m4:138: _LT_SETUP is expanded from...\r\nm4/libtool.m4:67: LT_INIT is expanded from...\r\nconfigure.ac:14: the top level\r\nconfigure.ac:14: warning: AC_LANG_CONFTEST: no AC_LANG_SOURCE call detected in body\r\n../../lib/autoconf/lang.m4:193: AC_LANG_CONFTEST is expanded from...\r\n../../lib/autoconf/general.m4:2661: _AC_LINK_IFELSE is expanded from...\r\n../../lib/autoconf/general.m4:2678: AC_LINK_IFELSE is expanded from...\r\nm4/libtool.m4:4161: _LT_LINKER_SHLIBS is expanded from...\r\nm4/libtool.m4:5236: _LT_LANG_C_CONFIG is expanded from...\r\nm4/libtool.m4:138: _LT_SETUP is expanded from...\r\nm4/libtool.m4:67: LT_INIT is expanded from...\r\nconfigure.ac:14: the top level\r\nconfigure.ac:25: warning: PKG_PROG_PKG_CONFIG is m4_require'd but not m4_defun'd\r\nm4/ax_pkg_check_var.m4:10: PKG_CHECK_VAR is expanded from...\r\naclocal.m4:1349: _VARNISH_PKG_CONFIG is expanded from...\r\naclocal.m4:1568: VARNISH_PREREQ is expanded from...\r\nconfigure.ac:25: the top level\r\nconfigure.ac:28: warning: PKG_PROG_PKG_CONFIG is m4_require'd but not m4_defun'd\r\nm4/ax_pkg_check_var.m4:10: PKG_CHECK_VAR is expanded from...\r\nconfigure.ac:28: the top level\r\n+ automake --add-missing --copy --foreign\r\nconfigure.ac:14: warning: AC_LANG_CONFTEST: no AC_LANG_SOURCE call detected in body\r\n../../lib/autoconf/lang.m4:193: AC_LANG_CONFTEST is expanded from...\r\n../../lib/autoconf/general.m4:2661: _AC_LINK_IFELSE is expanded from...\r\n../../lib/autoconf/general.m4:2678: AC_LINK_IFELSE is expanded from...\r\nm4/libtool.m4:1022: _LT_SYS_MODULE_PATH_AIX is expanded from...\r\nm4/libtool.m4:4161: _LT_LINKER_SHLIBS is expanded from...\r\nm4/libtool.m4:5236: _LT_LANG_C_CONFIG is expanded from...\r\nm4/libtool.m4:138: _LT_SETUP is expanded from...\r\nm4/libtool.m4:67: LT_INIT is expanded from...\r\nconfigure.ac:14: the top level\r\nconfigure.ac:14: warning: AC_LANG_CONFTEST: no AC_LANG_SOURCE call detected in body\r\n../../lib/autoconf/lang.m4:193: AC_LANG_CONFTEST is expanded from...\r\n../../lib/autoconf/general.m4:2661: _AC_LINK_IFELSE is expanded from...\r\n../../lib/autoconf/general.m4:2678: AC_LINK_IFELSE is expanded from...\r\nm4/libtool.m4:4161: _LT_LINKER_SHLIBS is expanded from...\r\nm4/libtool.m4:5236: _LT_LANG_C_CONFIG is expanded from...\r\nm4/libtool.m4:138: _LT_SETUP is expanded from...\r\nm4/libtool.m4:67: LT_INIT is expanded from...\r\nconfigure.ac:14: the top level\r\nconfigure.ac:25: warning: PKG_PROG_PKG_CONFIG is m4_require'd but not m4_defun'd\r\nm4/ax_pkg_check_var.m4:10: PKG_CHECK_VAR is expanded from...\r\naclocal.m4:1349: _VARNISH_PKG_CONFIG is expanded from...\r\naclocal.m4:1568: VARNISH_PREREQ is expanded from...\r\nconfigure.ac:25: the top level\r\nconfigure.ac:28: warning: PKG_PROG_PKG_CONFIG is m4_require'd but not m4_defun'd\r\nm4/ax_pkg_check_var.m4:10: PKG_CHECK_VAR is expanded from...\r\nconfigure.ac:28: the top level\r\n+ autoconf\r\nconfigure.ac:14: warning: AC_LANG_CONFTEST: no AC_LANG_SOURCE call detected in body\r\n../../lib/autoconf/lang.m4:193: AC_LANG_CONFTEST is expanded from...\r\n../../lib/autoconf/general.m4:2661: _AC_LINK_IFELSE is expanded from...\r\n../../lib/autoconf/general.m4:2678: AC_LINK_IFELSE is expanded from...\r\nm4/libtool.m4:1022: _LT_SYS_MODULE_PATH_AIX is expanded from...\r\nm4/libtool.m4:4161: _LT_LINKER_SHLIBS is expanded from...\r\nm4/libtool.m4:5236: _LT_LANG_C_CONFIG is expanded from...\r\nm4/libtool.m4:138: _LT_SETUP is expanded from...\r\nm4/libtool.m4:67: LT_INIT is expanded from...\r\nconfigure.ac:14: the top level\r\nconfigure.ac:14: warning: AC_LANG_CONFTEST: no AC_LANG_SOURCE call detected in body\r\n../../lib/autoconf/lang.m4:193: AC_LANG_CONFTEST is expanded from...\r\n../../lib/autoconf/general.m4:2661: _AC_LINK_IFELSE is expanded from...\r\n../../lib/autoconf/general.m4:2678: AC_LINK_IFELSE is expanded from...\r\nm4/libtool.m4:4161: _LT_LINKER_SHLIBS is expanded from...\r\nm4/libtool.m4:5236: _LT_LANG_C_CONFIG is expanded from...\r\nm4/libtool.m4:138: _LT_SETUP is expanded from...\r\nm4/libtool.m4:67: LT_INIT is expanded from...\r\nconfigure.ac:14: the top level\r\nconfigure.ac:25: warning: PKG_PROG_PKG_CONFIG is m4_require'd but not m4_defun'd\r\nm4/ax_pkg_check_var.m4:10: PKG_CHECK_VAR is expanded from...\r\naclocal.m4:1349: _VARNISH_PKG_CONFIG is expanded from...\r\naclocal.m4:1568: VARNISH_PREREQ is expanded from...\r\nconfigure.ac:25: the top level\r\nconfigure.ac:28: warning: PKG_PROG_PKG_CONFIG is m4_require'd but not m4_defun'd\r\nm4/ax_pkg_check_var.m4:10: PKG_CHECK_VAR is expanded from...\r\nconfigure.ac:28: the top level\r\n\r\n\r\n```","closed_by":{"login":"nigoroll","id":1528104,"node_id":"MDQ6VXNlcjE1MjgxMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1528104?v=4","gravatar_id":"","url":"https://api.github.com/users/nigoroll","html_url":"https://github.com/nigoroll","followers_url":"https://api.github.com/users/nigoroll/followers","following_url":"https://api.github.com/users/nigoroll/following{/other_user}","gists_url":"https://api.github.com/users/nigoroll/gists{/gist_id}","starred_url":"https://api.github.com/users/nigoroll/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nigoroll/subscriptions","organizations_url":"https://api.github.com/users/nigoroll/orgs","repos_url":"https://api.github.com/users/nigoroll/repos","events_url":"https://api.github.com/users/nigoroll/events{/privacy}","received_events_url":"https://api.github.com/users/nigoroll/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/22/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/22/timeline","performed_via_github_app":null,"state_reason":"completed"},{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/23","repository_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/23/labels{/name}","comments_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/23/comments","events_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/23/events","html_url":"https://github.com/nigoroll/libvmod-dynamic/issues/23","id":247464302,"node_id":"MDU6SXNzdWUyNDc0NjQzMDI=","number":23,"title":"probe not happy with .url = \"/xxx\";","user":{"login":"razvanphp","id":4599319,"node_id":"MDQ6VXNlcjQ1OTkzMTk=","avatar_url":"https://avatars.githubusercontent.com/u/4599319?v=4","gravatar_id":"","url":"https://api.github.com/users/razvanphp","html_url":"https://github.com/razvanphp","followers_url":"https://api.github.com/users/razvanphp/followers","following_url":"https://api.github.com/users/razvanphp/following{/other_user}","gists_url":"https://api.github.com/users/razvanphp/gists{/gist_id}","starred_url":"https://api.github.com/users/razvanphp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/razvanphp/subscriptions","organizations_url":"https://api.github.com/users/razvanphp/orgs","repos_url":"https://api.github.com/users/razvanphp/repos","events_url":"https://api.github.com/users/razvanphp/events{/privacy}","received_events_url":"https://api.github.com/users/razvanphp/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2017-08-02T17:26:56Z","updated_at":"2017-08-11T16:11:32Z","closed_at":"2017-08-11T16:11:32Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hey,\r\n\r\nFirst of all, thanks for this nice extension, it's finally allowing us to get rid of some local nginx instances and use only varnish to connect to AWS ALB directly.\r\n\r\nProblem is, we can't make the probes happy, they fail ~for some reason and I can't understand why~ because the dynamic vmod probes don't send a valid HTTP/1.1 request, more specifically, the `Host` header is missing.\r\n\r\nHere how it looks on the nginx side:\r\n```\r\n10.132.58.46 - - [02/Aug/2017:18:19:54 +0000] \"GET /ping HTTP/1.1\" 200 14 \"-\" \"curl/7.38.0\"\r\n10.132.58.46 - - [02/Aug/2017:18:19:55 +0000] \"GET /ping HTTP/1.1\" 200 14 \"-\" \"-\"\r\n10.132.58.46 - - [02/Aug/2017:18:19:54 +0000] \"GET /ping HTTP/1.1\" 400 166 \"-\" \"-\"\r\n```\r\ncurl works, normal backend works, dynamic backend probe gets 400 because:\r\n```\r\n2017/08/02 18:48:29 [info] 1784#1784: *710 client sent HTTP/1.1 request without \"Host\" header while reading client request headers, client: 10.132.58.46, server: _, request: \"GET /ping HTTP/1.1\"\r\n```\r\n\r\nSo, according to RFC 2316, section 14.23, HTTP 1.1 requests must contain a host header. If they don't, a server must reply with error 400.\r\n\r\nThis module should just put the DNS name of the backend as `Host` header, or just the IP like curl does when no server name is specified:\r\n```\r\n$ curl 10.132.17.10/ping -v\r\n* Hostname was NOT found in DNS cache\r\n*   Trying 10.132.17.10...\r\n* Connected to 10.132.17.10 (10.132.17.10) port 80 (#0)\r\n> GET /ping HTTP/1.1\r\n> User-Agent: curl/7.38.0\r\n> Host: 10.132.17.10\r\n> Accept: */*\r\n>\r\n< HTTP/1.1 200 OK\r\n```\r\n\r\nMaybe you can also check what the original varnish code for probe does. Currently the workaround is:\r\n```\r\nprobe www_probe {\r\n    .request =\r\n      \"GET /ping HTTP/1.1\"\r\n      \"Host: www.foo.bar\"\r\n      \"Connection: close\";\r\n    .timeout = 1s;\r\n    .window = 8;\r\n    .initial = 7;\r\n    .threshold = 6;\r\n    .interval = 5s;\r\n}\r\n```\r\n\r\nCheers,\r\nR","closed_by":{"login":"nigoroll","id":1528104,"node_id":"MDQ6VXNlcjE1MjgxMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1528104?v=4","gravatar_id":"","url":"https://api.github.com/users/nigoroll","html_url":"https://github.com/nigoroll","followers_url":"https://api.github.com/users/nigoroll/followers","following_url":"https://api.github.com/users/nigoroll/following{/other_user}","gists_url":"https://api.github.com/users/nigoroll/gists{/gist_id}","starred_url":"https://api.github.com/users/nigoroll/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nigoroll/subscriptions","organizations_url":"https://api.github.com/users/nigoroll/orgs","repos_url":"https://api.github.com/users/nigoroll/repos","events_url":"https://api.github.com/users/nigoroll/events{/privacy}","received_events_url":"https://api.github.com/users/nigoroll/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/23/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/23/timeline","performed_via_github_app":null,"state_reason":"completed"},{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/24","repository_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/24/labels{/name}","comments_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/24/comments","events_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/24/events","html_url":"https://github.com/nigoroll/libvmod-dynamic/issues/24","id":250079481,"node_id":"MDU6SXNzdWUyNTAwNzk0ODE=","number":24,"title":"make failed after latest commits","user":{"login":"rashidul0405","id":1697082,"node_id":"MDQ6VXNlcjE2OTcwODI=","avatar_url":"https://avatars.githubusercontent.com/u/1697082?v=4","gravatar_id":"","url":"https://api.github.com/users/rashidul0405","html_url":"https://github.com/rashidul0405","followers_url":"https://api.github.com/users/rashidul0405/followers","following_url":"https://api.github.com/users/rashidul0405/following{/other_user}","gists_url":"https://api.github.com/users/rashidul0405/gists{/gist_id}","starred_url":"https://api.github.com/users/rashidul0405/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rashidul0405/subscriptions","organizations_url":"https://api.github.com/users/rashidul0405/orgs","repos_url":"https://api.github.com/users/rashidul0405/repos","events_url":"https://api.github.com/users/rashidul0405/events{/privacy}","received_events_url":"https://api.github.com/users/rashidul0405/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2017-08-14T16:12:02Z","updated_at":"2017-09-05T14:51:44Z","closed_at":"2017-09-05T14:51:44Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"If I build using Apr 10, 2017 commit it works fine. \r\n\r\nHowever, current latest version produces the following error:\r\n\r\nvarnish 4.1.8\r\n\r\n```\r\nubuntu@16.04 $ make\r\nmake  all-recursive\r\nmake[1]: Entering directory '/home/ubuntu/dynamic/libvmod-dynamic'\r\nMaking all in src\r\nmake[2]: Entering directory '/home/ubuntu/dynamic/libvmod-dynamic/src'\r\n  CC       vmod_dynamic.lo\r\nIn file included from vmod_dynamic.c:47:0:\r\nvmod_dynamic.c: In function dynamic_get:\r\nvmod_dynamic.c:698:21: error: passing argument 2 of Lck__New from incompatible pointer type [-Werror=incompatible-pointer-types]\r\n  Lck_New(&dom->mtx, lck_be);\r\n                     ^\r\n/usr/include/varnish/cache/cache.h:835:35: note: in definition of macro Lck_New\r\n #define Lck_New(a, b) Lck__New(a, b, #b)\r\n                                   ^\r\n/usr/include/varnish/cache/cache.h:828:6: note: expected struct VSC_C_lck * but argument is of type struct VSC_lck *\r\n void Lck__New(struct lock *lck, struct VSC_C_lck *, const char *);\r\n      ^\r\nvmod_dynamic.c: In function vmod_event:\r\nvmod_dynamic.c:732:12: error: assignment from incompatible pointer type [-Werror=incompatible-pointer-types]\r\n    lck_dir = Lck_CreateClass(\"dynamic.director\");\r\n            ^\r\nvmod_dynamic.c:733:11: error: assignment from incompatible pointer type [-Werror=incompatible-pointer-types]\r\n    lck_be = Lck_CreateClass(\"dynamic.backend\");\r\n           ^\r\nvmod_dynamic.c:744:4: error: implicit declaration of function Lck_DestroyClass [-Werror=implicit-function-declaration]\r\n    Lck_DestroyClass(&lck_dir);\r\n    ^\r\nvmod_dynamic.c: In function dynamic_share_parse:\r\nvmod_dynamic.c:782:2: error: implicit declaration of function NEEDLESS [-Werror=implicit-function-declaration]\r\n  NEEDLESS(return(0));\r\n  ^\r\nvmod_dynamic.c:782:11: error: expected expression before return\r\n  NEEDLESS(return(0));\r\n           ^\r\nIn file included from vmod_dynamic.c:47:0:\r\nvmod_dynamic.c: In function vmod_director__init:\r\nvmod_dynamic.c:858:21: error: passing argument 2 of Lck__New from incompatible pointer type [-Werror=incompatible-pointer-types]\r\n  Lck_New(&obj->mtx, lck_dir);\r\n                     ^\r\n/usr/include/varnish/cache/cache.h:835:35: note: in definition of macro Lck_New\r\n #define Lck_New(a, b) Lck__New(a, b, #b)\r\n                                   ^\r\n/usr/include/varnish/cache/cache.h:828:6: note: expected struct VSC_C_lck * but argument is of type struct VSC_lck *\r\n void Lck__New(struct lock *lck, struct VSC_C_lck *, const char *);\r\n      ^\r\ncc1: all warnings being treated as errors\r\nMakefile:651: recipe for target 'vmod_dynamic.lo' failed\r\nmake[2]: *** [vmod_dynamic.lo] Error 1\r\nmake[2]: Leaving directory '/home/ubuntu/dynamic/libvmod-dynamic/src'\r\nMakefile:485: recipe for target 'all-recursive' failed\r\nmake[1]: *** [all-recursive] Error 1\r\nmake[1]: Leaving directory '/home/ubuntu/dynamic/libvmod-dynamic'\r\nMakefile:396: recipe for target 'all' failed\r\nmake: *** [all] Error 2\r\n```","closed_by":{"login":"nigoroll","id":1528104,"node_id":"MDQ6VXNlcjE1MjgxMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1528104?v=4","gravatar_id":"","url":"https://api.github.com/users/nigoroll","html_url":"https://github.com/nigoroll","followers_url":"https://api.github.com/users/nigoroll/followers","following_url":"https://api.github.com/users/nigoroll/following{/other_user}","gists_url":"https://api.github.com/users/nigoroll/gists{/gist_id}","starred_url":"https://api.github.com/users/nigoroll/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nigoroll/subscriptions","organizations_url":"https://api.github.com/users/nigoroll/orgs","repos_url":"https://api.github.com/users/nigoroll/repos","events_url":"https://api.github.com/users/nigoroll/events{/privacy}","received_events_url":"https://api.github.com/users/nigoroll/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/24/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/24/timeline","performed_via_github_app":null,"state_reason":"completed"},{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/25","repository_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/25/labels{/name}","comments_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/25/comments","events_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/25/events","html_url":"https://github.com/nigoroll/libvmod-dynamic/issues/25","id":260193076,"node_id":"MDU6SXNzdWUyNjAxOTMwNzY=","number":25,"title":"5.0 branch build fails against varnish 4.1.8","user":{"login":"vStone","id":356719,"node_id":"MDQ6VXNlcjM1NjcxOQ==","avatar_url":"https://avatars.githubusercontent.com/u/356719?v=4","gravatar_id":"","url":"https://api.github.com/users/vStone","html_url":"https://github.com/vStone","followers_url":"https://api.github.com/users/vStone/followers","following_url":"https://api.github.com/users/vStone/following{/other_user}","gists_url":"https://api.github.com/users/vStone/gists{/gist_id}","starred_url":"https://api.github.com/users/vStone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vStone/subscriptions","organizations_url":"https://api.github.com/users/vStone/orgs","repos_url":"https://api.github.com/users/vStone/repos","events_url":"https://api.github.com/users/vStone/events{/privacy}","received_events_url":"https://api.github.com/users/vStone/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2017-09-25T08:30:14Z","updated_at":"2017-09-26T10:30:55Z","closed_at":"2017-09-26T08:59:14Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Building branch 5.0 against varnish-4.1.8:\r\n```\r\nmake[2]: Entering directory '/home/jan/SRC/libvmod-dynamic/src'\r\n  VMODTOOL vmod_dynamic.vcc\r\nWARNING: $Event description is not included in .rst:\r\n[(162, '')]\r\n  CC       vmod_dynamic.lo\r\nvmod_dynamic.c: In function dynamic_share_parse:\r\nvmod_dynamic.c:782:2: error: implicit declaration of function NEEDLESS [-Werror=implicit-function-declaration]\r\n  NEEDLESS(return(0));\r\n  ^\r\nvmod_dynamic.c:782:11: error: expected expression before return\r\n  NEEDLESS(return(0));\r\n           ^\r\ncc1: all warnings being treated as errors\r\nmake[2]: *** [Makefile:650: vmod_dynamic.lo] Error 1\r\n```\r\n\r\nMaybe split off a bit too late?","closed_by":{"login":"nigoroll","id":1528104,"node_id":"MDQ6VXNlcjE1MjgxMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1528104?v=4","gravatar_id":"","url":"https://api.github.com/users/nigoroll","html_url":"https://github.com/nigoroll","followers_url":"https://api.github.com/users/nigoroll/followers","following_url":"https://api.github.com/users/nigoroll/following{/other_user}","gists_url":"https://api.github.com/users/nigoroll/gists{/gist_id}","starred_url":"https://api.github.com/users/nigoroll/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nigoroll/subscriptions","organizations_url":"https://api.github.com/users/nigoroll/orgs","repos_url":"https://api.github.com/users/nigoroll/repos","events_url":"https://api.github.com/users/nigoroll/events{/privacy}","received_events_url":"https://api.github.com/users/nigoroll/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/25/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/25/timeline","performed_via_github_app":null,"state_reason":"completed"},{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/26","repository_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/26/labels{/name}","comments_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/26/comments","events_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/26/events","html_url":"https://github.com/nigoroll/libvmod-dynamic/issues/26","id":260411322,"node_id":"MDU6SXNzdWUyNjA0MTEzMjI=","number":26,"title":"PLease tag 5.2","user":{"login":"billnbell","id":25377089,"node_id":"MDQ6VXNlcjI1Mzc3MDg5","avatar_url":"https://avatars.githubusercontent.com/u/25377089?v=4","gravatar_id":"","url":"https://api.github.com/users/billnbell","html_url":"https://github.com/billnbell","followers_url":"https://api.github.com/users/billnbell/followers","following_url":"https://api.github.com/users/billnbell/following{/other_user}","gists_url":"https://api.github.com/users/billnbell/gists{/gist_id}","starred_url":"https://api.github.com/users/billnbell/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/billnbell/subscriptions","organizations_url":"https://api.github.com/users/billnbell/orgs","repos_url":"https://api.github.com/users/billnbell/repos","events_url":"https://api.github.com/users/billnbell/events{/privacy}","received_events_url":"https://api.github.com/users/billnbell/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2017-09-25T20:52:45Z","updated_at":"2017-09-26T09:02:38Z","closed_at":"2017-09-26T09:02:38Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Please tag this for 5.2. The master right now appears to work.\r\n\r\ngit fetch https://github.com/nigoroll/libvmod-dynamic.git 89f489146f129a841ec91467178b28cea57236df ","closed_by":{"login":"nigoroll","id":1528104,"node_id":"MDQ6VXNlcjE1MjgxMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1528104?v=4","gravatar_id":"","url":"https://api.github.com/users/nigoroll","html_url":"https://github.com/nigoroll","followers_url":"https://api.github.com/users/nigoroll/followers","following_url":"https://api.github.com/users/nigoroll/following{/other_user}","gists_url":"https://api.github.com/users/nigoroll/gists{/gist_id}","starred_url":"https://api.github.com/users/nigoroll/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nigoroll/subscriptions","organizations_url":"https://api.github.com/users/nigoroll/orgs","repos_url":"https://api.github.com/users/nigoroll/repos","events_url":"https://api.github.com/users/nigoroll/events{/privacy}","received_events_url":"https://api.github.com/users/nigoroll/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/26/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/26/timeline","performed_via_github_app":null,"state_reason":"completed"},{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/27","repository_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/27/labels{/name}","comments_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/27/comments","events_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/27/events","html_url":"https://github.com/nigoroll/libvmod-dynamic/issues/27","id":261899811,"node_id":"MDU6SXNzdWUyNjE4OTk4MTE=","number":27,"title":"Building issue on RHEL7 with varnish 4.1.8","user":{"login":"imanandshah","id":31092588,"node_id":"MDQ6VXNlcjMxMDkyNTg4","avatar_url":"https://avatars.githubusercontent.com/u/31092588?v=4","gravatar_id":"","url":"https://api.github.com/users/imanandshah","html_url":"https://github.com/imanandshah","followers_url":"https://api.github.com/users/imanandshah/followers","following_url":"https://api.github.com/users/imanandshah/following{/other_user}","gists_url":"https://api.github.com/users/imanandshah/gists{/gist_id}","starred_url":"https://api.github.com/users/imanandshah/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imanandshah/subscriptions","organizations_url":"https://api.github.com/users/imanandshah/orgs","repos_url":"https://api.github.com/users/imanandshah/repos","events_url":"https://api.github.com/users/imanandshah/events{/privacy}","received_events_url":"https://api.github.com/users/imanandshah/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2017-10-01T08:06:50Z","updated_at":"2017-10-01T13:28:13Z","closed_at":"2017-10-01T13:28:13Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"\r\nI get the below error while building on a vanilla RHEL varnish 4.1.8 version. Can you help here?? \r\n\r\n\r\n> make  all-recursive\r\nmake[1]: Entering directory `/var/tmp/libvmod-dynamic'\r\nMaking all in src\r\nmake[2]: Entering directory `/var/tmp/libvmod-dynamic/src'\r\n  VMODTOOL vmod_dynamic.vcc\r\nWARNING: $Event description is not included in .rst:\r\n[(162, '')]\r\n  CC       vmod_dynamic.lo\r\nvmod_dynamic.c: In function 'dynamic_get':\r\nvmod_dynamic.c:698:2: error: passing argument 2 of 'Lck__New' from incompatible pointer type [-Werror]\r\n  Lck_New(&dom->mtx, lck_be);\r\n  ^\r\nIn file included from vmod_dynamic.c:47:0:\r\n/product/varnish/include/varnish/cache/cache.h:828:6: note: expected 'struct VSC_C_lck *' but argument is of type 'struct VSC_lck *'\r\n void Lck__New(struct lock *lck, struct VSC_C_lck *, const char *);\r\n      ^\r\nvmod_dynamic.c: In function 'vmod_event':\r\nvmod_dynamic.c:732:12: error: assignment from incompatible pointer type [-Werror]\r\n    lck_dir = Lck_CreateClass(\"dynamic.director\");\r\n            ^\r\nvmod_dynamic.c:733:11: error: assignment from incompatible pointer type [-Werror]\r\n    lck_be = Lck_CreateClass(\"dynamic.backend\");\r\n           ^\r\nvmod_dynamic.c:744:4: error: implicit declaration of function 'Lck_DestroyClass' [-Werror=implicit-function-declaration]\r\n    Lck_DestroyClass(&lck_dir);\r\n    ^\r\nvmod_dynamic.c: In function 'dynamic_share_parse':\r\nvmod_dynamic.c:782:2: error: implicit declaration of function 'NEEDLESS' [-Werror=implicit-function-declaration]\r\n  NEEDLESS(return(0));\r\n  ^\r\nvmod_dynamic.c:782:11: error: expected expression before 'return'\r\n  NEEDLESS(return(0));\r\n           ^\r\nvmod_dynamic.c: In function 'vmod_director__init':\r\nvmod_dynamic.c:858:2: error: passing argument 2 of 'Lck__New' from incompatible pointer type [-Werror]\r\n  Lck_New(&obj->mtx, lck_dir);\r\n  ^\r\nIn file included from vmod_dynamic.c:47:0:\r\n/product/varnish/include/varnish/cache/cache.h:828:6: note: expected 'struct VSC_C_lck *' but argument is of type 'struct VSC_lck *'\r\n void Lck__New(struct lock *lck, struct VSC_C_lck *, const char *);\r\n      ^\r\ncc1: all warnings being treated as errors\r\n","closed_by":{"login":"nigoroll","id":1528104,"node_id":"MDQ6VXNlcjE1MjgxMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1528104?v=4","gravatar_id":"","url":"https://api.github.com/users/nigoroll","html_url":"https://github.com/nigoroll","followers_url":"https://api.github.com/users/nigoroll/followers","following_url":"https://api.github.com/users/nigoroll/following{/other_user}","gists_url":"https://api.github.com/users/nigoroll/gists{/gist_id}","starred_url":"https://api.github.com/users/nigoroll/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nigoroll/subscriptions","organizations_url":"https://api.github.com/users/nigoroll/orgs","repos_url":"https://api.github.com/users/nigoroll/repos","events_url":"https://api.github.com/users/nigoroll/events{/privacy}","received_events_url":"https://api.github.com/users/nigoroll/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/27/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/27/timeline","performed_via_github_app":null,"state_reason":"completed"},{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/28","repository_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/28/labels{/name}","comments_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/28/comments","events_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/28/events","html_url":"https://github.com/nigoroll/libvmod-dynamic/pull/28","id":261999468,"node_id":"MDExOlB1bGxSZXF1ZXN0MTQ0MTIyNTUx","number":28,"title":"Improve debian package quality","user":{"login":"vStone","id":356719,"node_id":"MDQ6VXNlcjM1NjcxOQ==","avatar_url":"https://avatars.githubusercontent.com/u/356719?v=4","gravatar_id":"","url":"https://api.github.com/users/vStone","html_url":"https://github.com/vStone","followers_url":"https://api.github.com/users/vStone/followers","following_url":"https://api.github.com/users/vStone/following{/other_user}","gists_url":"https://api.github.com/users/vStone/gists{/gist_id}","starred_url":"https://api.github.com/users/vStone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vStone/subscriptions","organizations_url":"https://api.github.com/users/vStone/orgs","repos_url":"https://api.github.com/users/vStone/repos","events_url":"https://api.github.com/users/vStone/events{/privacy}","received_events_url":"https://api.github.com/users/vStone/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2017-10-02T07:16:51Z","updated_at":"2018-09-12T15:27:28Z","closed_at":"2018-09-12T15:27:27Z","author_association":"NONE","active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/pulls/28","html_url":"https://github.com/nigoroll/libvmod-dynamic/pull/28","diff_url":"https://github.com/nigoroll/libvmod-dynamic/pull/28.diff","patch_url":"https://github.com/nigoroll/libvmod-dynamic/pull/28.patch","merged_at":null},"body":"Fixes all lintian (https://lintian.debian.org/manual/chapter-1.html#section-1.1) errors and fix some warnings.\r\n\r\nYou should probably double check what my changes do for the rpm build since I can't easily test that for now.","closed_by":{"login":"nigoroll","id":1528104,"node_id":"MDQ6VXNlcjE1MjgxMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1528104?v=4","gravatar_id":"","url":"https://api.github.com/users/nigoroll","html_url":"https://github.com/nigoroll","followers_url":"https://api.github.com/users/nigoroll/followers","following_url":"https://api.github.com/users/nigoroll/following{/other_user}","gists_url":"https://api.github.com/users/nigoroll/gists{/gist_id}","starred_url":"https://api.github.com/users/nigoroll/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nigoroll/subscriptions","organizations_url":"https://api.github.com/users/nigoroll/orgs","repos_url":"https://api.github.com/users/nigoroll/repos","events_url":"https://api.github.com/users/nigoroll/events{/privacy}","received_events_url":"https://api.github.com/users/nigoroll/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/28/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/28/timeline","performed_via_github_app":null,"state_reason":null},{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/29","repository_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/29/labels{/name}","comments_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/29/comments","events_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/29/events","html_url":"https://github.com/nigoroll/libvmod-dynamic/pull/29","id":261999621,"node_id":"MDExOlB1bGxSZXF1ZXN0MTQ0MTIyNjYx","number":29,"title":"Backport changes made to master for lintian errors and warnings","user":{"login":"vStone","id":356719,"node_id":"MDQ6VXNlcjM1NjcxOQ==","avatar_url":"https://avatars.githubusercontent.com/u/356719?v=4","gravatar_id":"","url":"https://api.github.com/users/vStone","html_url":"https://github.com/vStone","followers_url":"https://api.github.com/users/vStone/followers","following_url":"https://api.github.com/users/vStone/following{/other_user}","gists_url":"https://api.github.com/users/vStone/gists{/gist_id}","starred_url":"https://api.github.com/users/vStone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vStone/subscriptions","organizations_url":"https://api.github.com/users/vStone/orgs","repos_url":"https://api.github.com/users/vStone/repos","events_url":"https://api.github.com/users/vStone/events{/privacy}","received_events_url":"https://api.github.com/users/vStone/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2017-10-02T07:17:45Z","updated_at":"2018-09-12T15:26:15Z","closed_at":"2018-09-12T15:25:43Z","author_association":"NONE","active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/pulls/29","html_url":"https://github.com/nigoroll/libvmod-dynamic/pull/29","diff_url":"https://github.com/nigoroll/libvmod-dynamic/pull/29.diff","patch_url":"https://github.com/nigoroll/libvmod-dynamic/pull/29.patch","merged_at":"2018-09-12T15:25:43Z"},"body":"","closed_by":{"login":"nigoroll","id":1528104,"node_id":"MDQ6VXNlcjE1MjgxMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1528104?v=4","gravatar_id":"","url":"https://api.github.com/users/nigoroll","html_url":"https://github.com/nigoroll","followers_url":"https://api.github.com/users/nigoroll/followers","following_url":"https://api.github.com/users/nigoroll/following{/other_user}","gists_url":"https://api.github.com/users/nigoroll/gists{/gist_id}","starred_url":"https://api.github.com/users/nigoroll/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nigoroll/subscriptions","organizations_url":"https://api.github.com/users/nigoroll/orgs","repos_url":"https://api.github.com/users/nigoroll/repos","events_url":"https://api.github.com/users/nigoroll/events{/privacy}","received_events_url":"https://api.github.com/users/nigoroll/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/29/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/29/timeline","performed_via_github_app":null,"state_reason":null},{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/30","repository_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/30/labels{/name}","comments_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/30/comments","events_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/30/events","html_url":"https://github.com/nigoroll/libvmod-dynamic/issues/30","id":271126401,"node_id":"MDU6SXNzdWUyNzExMjY0MDE=","number":30,"title":"make check fails","user":{"login":"danielmotaleite","id":11890049,"node_id":"MDQ6VXNlcjExODkwMDQ5","avatar_url":"https://avatars.githubusercontent.com/u/11890049?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmotaleite","html_url":"https://github.com/danielmotaleite","followers_url":"https://api.github.com/users/danielmotaleite/followers","following_url":"https://api.github.com/users/danielmotaleite/following{/other_user}","gists_url":"https://api.github.com/users/danielmotaleite/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmotaleite/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmotaleite/subscriptions","organizations_url":"https://api.github.com/users/danielmotaleite/orgs","repos_url":"https://api.github.com/users/danielmotaleite/repos","events_url":"https://api.github.com/users/danielmotaleite/events{/privacy}","received_events_url":"https://api.github.com/users/danielmotaleite/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2017-11-03T21:41:34Z","updated_at":"2017-11-06T18:21:21Z","closed_at":"2017-11-04T10:43:00Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hi\r\n\r\nTrying to update the setup, when i build the latest version on a ubuntu 16.04 with varnish 5.1.2 and do a `make check` i get a  `FAIL: tests/test13.vtc`\r\n\r\nThe test-suite.log says this:\r\n```\r\n=============================================\r\n   libvmod-dynamic 0.2: src/test-suite.log\r\n=============================================\r\n\r\n# TOTAL: 13\r\n# PASS:  12\r\n# SKIP:  0\r\n# XFAIL: 0\r\n# FAIL:  1\r\n# XPASS: 0\r\n# ERROR: 0\r\n\r\n.. contents:: :depth: 2\r\n\r\nFAIL: tests/test13\r\n==================\r\n\r\n**** top   0.0 extmacro def pwd=/usr/src/libvmod-dynamic/src\r\n**** top   0.0 extmacro def vmod_dynamic=dynamic from \"/usr/src/libvmod-dynamic/src/.libs/libvmod_dynamic.so\"\r\n**** top   0.0 extmacro def localhost=127.0.0.1\r\n**** top   0.0 extmacro def bad_backend=127.0.0.1 20163\r\n**** top   0.0 extmacro def bad_ip=192.0.2.255\r\n**** top   0.0 macro def tmpdir=/tmp/vtc.13912.7d7acb57\r\n*    top   0.0 TEST ./tests/test13.vtc starting\r\n**   top   0.0 === varnishtest \"share = HOST and probe hostname\"\r\n*    top   0.0 TEST share = HOST and probe hostname\r\n**   top   0.0 === barrier b1 cond 2\r\n**   top   0.0 === server s1 {\r\n**   s1    0.0 Starting server\r\n**** s1    0.0 macro def s1_addr=127.0.0.1\r\n**** s1    0.0 macro def s1_port=29921\r\n**** s1    0.0 macro def s1_sock=127.0.0.1 29921\r\n*    s1    0.0 Listen on 127.0.0.1 29921\r\n**   top   0.0 === varnish v1 -arg \"-p vcc_allow_inline_c=true\" -vcl {\r\n**   s1    0.0 Started on 127.0.0.1 29921\r\n**   v1    0.0 Launch\r\n***  v1    0.0 CMD: cd ${pwd} && exec varnishd  -d -n /tmp/vtc.13912.7d7acb57/v1 -l 2m,1m,- -p auto_restart=off -p syslog_cli_traffic=off -p sigsegv_handler=on -p thread_pool_min=10 -p debug=+vtc_mode -a '127.0.0.1:0' -M '127.0.0.1 37481' -P /tmp/vtc.13912.7d7acb57/v1/varnishd.pid  -p vcc_allow_inline_c=true\r\n***  v1    0.0 CMD: cd /usr/src/libvmod-dynamic/src && exec varnishd  -d -n /tmp/vtc.13912.7d7acb57/v1 -l 2m,1m,- -p auto_restart=off -p syslog_cli_traffic=off -p sigsegv_handler=on -p thread_pool_min=10 -p debug=+vtc_mode -a '127.0.0.1:0' -M '127.0.0.1 37481' -P /tmp/vtc.13912.7d7acb57/v1/varnishd.pid  -p vcc_allow_inline_c=true\r\n***  v1    0.0 PID: 13918\r\n**** v1    0.0 macro def v1_pid=13918\r\n**** v1    0.0 macro def v1_name=/tmp/vtc.13912.7d7acb57/v1\r\n***  v1    0.0 debug|Debug: Platform: Linux,4.4.0-96-generic,x86_64,-junix,-smalloc,-smalloc,-hcritbit\r\n***  v1    0.0 debug|200 282     \r\n***  v1    0.0 debug|-----------------------------\r\n***  v1    0.0 debug|Varnish Cache CLI 1.0\r\n***  v1    0.0 debug|-----------------------------\r\n***  v1    0.0 debug|Linux,4.4.0-96-generic,x86_64,-junix,-smalloc,-smalloc,-hcritbit\r\n***  v1    0.0 debug|varnish-5.1.2 revision 6ece695\r\n***  v1    0.0 debug|\r\n***  v1    0.0 debug|Type 'help' for command list.\r\n***  v1    0.0 debug|Type 'quit' to close CLI session.\r\n***  v1    0.0 debug|Type 'start' to launch worker process.\r\n***  v1    0.0 debug|\r\n***  v1    0.1 vsl|No VSL chunk found (child not started ?)\r\n**** v1    0.1 CLIPOLL 1 0x1 0x0\r\n***  v1    0.1 CLI connection fd = 10\r\n***  v1    0.1 CLI RX  107\r\n**** v1    0.1 CLI RX|xwjyrinmibtzfxggweunpxsicelyacyp\r\n**** v1    0.1 CLI RX|\r\n**** v1    0.1 CLI RX|Authentication required.\r\n**** v1    0.1 CLI TX|auth b3647e8f5e78d945d02d2b980d6e946615c4372711fa2add9f9220eb7724937d\r\n***  v1    0.1 CLI RX  200\r\n**** v1    0.1 CLI RX|-----------------------------\r\n**** v1    0.1 CLI RX|Varnish Cache CLI 1.0\r\n**** v1    0.1 CLI RX|-----------------------------\r\n**** v1    0.1 CLI RX|Linux,4.4.0-96-generic,x86_64,-junix,-smalloc,-smalloc,-hcritbit\r\n**** v1    0.1 CLI RX|varnish-5.1.2 revision 6ece695\r\n**** v1    0.1 CLI RX|\r\n**** v1    0.1 CLI RX|Type 'help' for command list.\r\n**** v1    0.1 CLI RX|Type 'quit' to close CLI session.\r\n**** v1    0.1 CLI RX|Type 'start' to launch worker process.\r\n**** v1    0.1 CLI TX|vcl.inline vcl1 << %XJEIFLH|)Xspa8P\r\n**** v1    0.1 CLI TX|vcl 4.0;\r\n**** v1    0.1 CLI TX|\r\n**** v1    0.1 CLI TX|\\timport dynamic from \"/usr/src/libvmod-dynamic/src/.libs/libvmod_dynamic.so\";\r\n**** v1    0.1 CLI TX|\r\n**** v1    0.1 CLI TX|\\tbackend dummy {\r\n**** v1    0.1 CLI TX|\\t    .host = \"192.0.2.255\";\r\n**** v1    0.1 CLI TX|\\t}\r\n**** v1    0.1 CLI TX|\r\n**** v1    0.1 CLI TX|\\tprobe simple {\r\n**** v1    0.1 CLI TX|\\t    .initial = 3;\r\n**** v1    0.1 CLI TX|\\t    .timeout = 1s;\r\n**** v1    0.1 CLI TX|\\t    .interval = 10s;\r\n**** v1    0.1 CLI TX|\\t}\r\n**** v1    0.1 CLI TX|\r\n**** v1    0.1 CLI TX|\\tsub vcl_init {\r\n**** v1    0.1 CLI TX|\\t    new d1 = dynamic.director(\r\n**** v1    0.1 CLI TX|\\t      port = \"29921\",\r\n**** v1    0.1 CLI TX|\\t      share = HOST,\r\n**** v1    0.1 CLI TX|\\t      probe = simple\r\n**** v1    0.1 CLI TX|\\t      );\r\n**** v1    0.1 CLI TX|\\t}\r\n**** v1    0.1 CLI TX|\r\n**** v1    0.1 CLI TX|\\tsub vcl_recv {\r\n**** v1    0.1 CLI TX|\\t    set req.backend_hint = d1.backend();\r\n**** v1    0.1 CLI TX|\\t    unset req.http.Host;\r\n**** v1    0.1 CLI TX|\\t    # let the probe win the race for the backend\r\n**** v1    0.1 CLI TX|\\t    C{\r\n**** v1    0.1 CLI TX|\\t\\t#include <unistd.h>\r\n**** v1    0.1 CLI TX|\\t\\t(void)sleep(1);\r\n**** v1    0.1 CLI TX|\\t    }C\r\n**** v1    0.1 CLI TX|\\t    return (pass);\r\n**** v1    0.1 CLI TX|\\t}\r\n**** v1    0.1 CLI TX|\r\n**** v1    0.1 CLI TX|\\tsub vcl_backend_error {\r\n**** v1    0.1 CLI TX|\\t    # the director may resolve ::1 first\r\n**** v1    0.1 CLI TX|\\t    return (retry);\r\n**** v1    0.1 CLI TX|\\t}\r\n**** v1    0.1 CLI TX|\r\n**** v1    0.1 CLI TX|%XJEIFLH|)Xspa8P\r\n***  v1    0.1 CLI RX  106\r\n**** v1    0.1 CLI RX|Message from C-compiler:\r\n**** v1    0.1 CLI RX|In file included from /usr/include/unistd.h:1151:0,\r\n**** v1    0.1 CLI RX|                 from vgc.c:1542:\r\n**** v1    0.1 CLI RX|/usr/include/x86_64-linux-gnu/bits/unistd.h: In function \\342\\200\\230VGC_function_vcl_recv\\342\\200\\231:\r\n**** v1    0.1 CLI RX|/usr/include/x86_64-linux-gnu/bits/unistd.h:34:1: error: nested function \\342\\200\\230read\\342\\200\\231 declared \\342\\200\\230extern\\342\\200\\231\r\n**** v1    0.1 CLI RX| read (int __fd, void *__buf, size_t __nbytes)\r\n**** v1    0.1 CLI RX| ^\r\n**** v1    0.1 CLI RX|/usr/include/x86_64-linux-gnu/bits/unistd.h:34:1: error: static declaration of \\342\\200\\230read\\342\\200\\231 follows non-static declaration\r\n**** v1    0.1 CLI RX|In file included from vgc.c:1542:0:\r\n**** v1    0.1 CLI RX|/usr/include/unistd.h:363:16: note: previous declaration of \\342\\200\\230read\\342\\200\\231 was here\r\n**** v1    0.1 CLI RX| extern ssize_t read (int __fd, void *__buf, size_t __nbytes) __wur;\r\n**** v1    0.1 CLI RX|[110 lines truncated]\r\n**** v1    0.1 CLI RX|Running C-compiler failed, exited with 1\r\n**** v1    0.1 CLI RX|VCL compilation failed\r\n---- v1    0.1 VCL compilation failed expected success\r\n*    top   0.1 RESETTING after ./tests/test13.vtc\r\n**   s1    0.1 Waiting for server (4/-1)\r\n**** s1    0.1 macro undef s1_addr\r\n**** s1    0.1 macro undef s1_port\r\n**** s1    0.1 macro undef s1_sock\r\n**   v1    0.1 Wait\r\n**** v1    0.1 CLI TX|backend.list\r\n***  v1    0.2 CLI RX  101\r\n**** v1    0.2 CLI RX|Unknown request in manager process (child not running).\r\n**** v1    0.2 CLI RX|Type 'help' for more info.\r\n**** v1    0.2 STDOUT poll 0x10\r\n**   v1    0.2 R 13918 Status: 0000 (u 0.016000 s 0.004000)\r\n***  v1    0.2 vsl|No VSL chunk found (child not started ?)\r\n*    top   0.2 TEST ./tests/test13.vtc FAILED\r\n#    top  TEST ./tests/test13.vtc FAILED (0.204) exit=2\r\n```\r\n\r\ni'm using a aws machine, with ubuntu 16.04  (fully updated), the \r\n`deb https://packagecloud.io/varnishcache/varnish5/ubuntu xenial main` and installed varnish  5.2.0-1~xenial (also tried 5.1.x with the 5.1 branch and same result)\r\n\r\nCompiling in a debian jessie machine, this works fine\r\n","closed_by":{"login":"nigoroll","id":1528104,"node_id":"MDQ6VXNlcjE1MjgxMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1528104?v=4","gravatar_id":"","url":"https://api.github.com/users/nigoroll","html_url":"https://github.com/nigoroll","followers_url":"https://api.github.com/users/nigoroll/followers","following_url":"https://api.github.com/users/nigoroll/following{/other_user}","gists_url":"https://api.github.com/users/nigoroll/gists{/gist_id}","starred_url":"https://api.github.com/users/nigoroll/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nigoroll/subscriptions","organizations_url":"https://api.github.com/users/nigoroll/orgs","repos_url":"https://api.github.com/users/nigoroll/repos","events_url":"https://api.github.com/users/nigoroll/events{/privacy}","received_events_url":"https://api.github.com/users/nigoroll/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/30/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/30/timeline","performed_via_github_app":null,"state_reason":"completed"},{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/31","repository_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/31/labels{/name}","comments_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/31/comments","events_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/31/events","html_url":"https://github.com/nigoroll/libvmod-dynamic/issues/31","id":271576264,"node_id":"MDU6SXNzdWUyNzE1NzYyNjQ=","number":31,"title":"ref-backend 3 total where 2 expected","user":{"login":"danielmotaleite","id":11890049,"node_id":"MDQ6VXNlcjExODkwMDQ5","avatar_url":"https://avatars.githubusercontent.com/u/11890049?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmotaleite","html_url":"https://github.com/danielmotaleite","followers_url":"https://api.github.com/users/danielmotaleite/followers","following_url":"https://api.github.com/users/danielmotaleite/following{/other_user}","gists_url":"https://api.github.com/users/danielmotaleite/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmotaleite/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmotaleite/subscriptions","organizations_url":"https://api.github.com/users/danielmotaleite/orgs","repos_url":"https://api.github.com/users/danielmotaleite/repos","events_url":"https://api.github.com/users/danielmotaleite/events{/privacy}","received_events_url":"https://api.github.com/users/danielmotaleite/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2017-11-06T18:33:47Z","updated_at":"2018-09-12T15:13:18Z","closed_at":"2018-09-12T15:13:18Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Trying to compile on a ubuntu 16.04 (same setup as #30 ), it works fine in one machine, but just deployed another machine with the same setup and that one fails in test07. Both are ubuntu 16.04 and have almost the same packages installed (the ones missing have nothing to do with network)\r\n\r\nI have tried to find why it fails, did try comparing the machines, but i'm unable to solve this. i have probably made any manual change in the original machine that i miss to port to ansible.\r\n\r\nHave you any idea what is failing here?\r\n\r\nThanks!\r\n```\r\n$ cat  src/test-suite.log \r\n=============================================\r\n   libvmod-dynamic 0.2: src/test-suite.log\r\n=============================================\r\n\r\n# TOTAL: 13\r\n# PASS:  12\r\n# SKIP:  0\r\n# XFAIL: 0\r\n# FAIL:  1\r\n# XPASS: 0\r\n# ERROR: 0\r\n\r\n.. contents:: :depth: 2\r\n\r\nFAIL: tests/test07\r\n==================\r\n\r\n**** top   0.0 extmacro def pwd=/usr/src/libvmod-dynamic/src\r\n**** top   0.0 extmacro def vmod_dynamic=dynamic from \"/usr/src/libvmod-dynamic/src/.libs/libvmod_dynamic.so\"\r\n**** top   0.0 extmacro def localhost=127.0.0.1\r\n**** top   0.0 extmacro def bad_backend=127.0.0.1 25622\r\n**** top   0.0 extmacro def bad_ip=192.0.2.255\r\n**** top   0.0 macro def tmpdir=/tmp/vtc.23481.62e33210\r\n*    top   0.0 TEST ./tests/test07.vtc starting\r\n**   top   0.0 === varnishtest \"debugging\"\r\n*    top   0.0 TEST debugging\r\n**   top   0.0 === server s1 {\r\n**   s1    0.0 Starting server\r\n**** s1    0.0 macro def s1_addr=127.0.0.1\r\n**** s1    0.0 macro def s1_port=26117\r\n**** s1    0.0 macro def s1_sock=127.0.0.1 26117\r\n*    s1    0.0 Listen on 127.0.0.1 26117\r\n**   top   0.0 === varnish v1 -vcl {\r\n**   s1    0.0 Started on 127.0.0.1 26117\r\n**   v1    0.0 Launch\r\n***  v1    0.0 CMD: cd ${pwd} && exec varnishd  -d -n /tmp/vtc.23481.62e33210/v1 -l 2m -p auto_restart=off -p syslog_cli_traffic=off -p sigsegv_handler=on -p thread_pool_min=10 -p debug=+vtc_mode -a '127.0.0.1:0' -M '127.0.0.1 26490' -P /tmp/vtc.23481.62e33210/v1/varnishd.pid \r\n***  v1    0.0 CMD: cd /usr/src/libvmod-dynamic/src && exec varnishd  -d -n /tmp/vtc.23481.62e33210/v1 -l 2m -p auto_restart=off -p syslog_cli_traffic=off -p sigsegv_handler=on -p thread_pool_min=10 -p debug=+vtc_mode -a '127.0.0.1:0' -M '127.0.0.1 26490' -P /tmp/vtc.23481.62e33210/v1/varnishd.pid \r\n***  v1    0.0 PID: 23489\r\n**** v1    0.0 macro def v1_pid=23489\r\n**** v1    0.0 macro def v1_name=/tmp/vtc.23481.62e33210/v1\r\n***  v1    0.0 debug|Debug: Platform: Linux,4.4.0-1022-aws,x86_64,-junix,-smalloc,-smalloc,-hcritbit\r\n***  v1    0.0 debug|200 282     \r\n***  v1    0.0 debug|-----------------------------\r\n***  v1    0.0 debug|Varnish Cache CLI 1.0\r\n***  v1    0.0 debug|-----------------------------\r\n***  v1    0.0 debug|Linux,4.4.0-1022-aws,x86_64,-junix,-smalloc,-smalloc,-hcritbit\r\n***  v1    0.0 debug|varnish-5.2.0 revision 4c4875cbf\r\n***  v1    0.0 debug|\r\n***  v1    0.0 debug|Type 'help' for command list.\r\n***  v1    0.0 debug|Type 'quit' to close CLI session.\r\n***  v1    0.0 debug|Type 'start' to launch worker process.\r\n***  v1    0.0 debug|\r\n**** v1    0.1 CLIPOLL 1 0x1 0x0\r\n***  v1    0.1 CLI connection fd = 7\r\n***  v1    0.1 CLI RX  107\r\n**** v1    0.1 CLI RX|kaqnblrsztpytugbvfxgxggrykijepui\r\n**** v1    0.1 CLI RX|\r\n**** v1    0.1 CLI RX|Authentication required.\r\n**** v1    0.1 CLI TX|auth b79b104fbcce80da9117931098daae7d82ecba6a97fef9087481393c31166991\r\n***  v1    0.1 CLI RX  200\r\n**** v1    0.1 CLI RX|-----------------------------\r\n**** v1    0.1 CLI RX|Varnish Cache CLI 1.0\r\n**** v1    0.1 CLI RX|-----------------------------\r\n**** v1    0.1 CLI RX|Linux,4.4.0-1022-aws,x86_64,-junix,-smalloc,-smalloc,-hcritbit\r\n**** v1    0.1 CLI RX|varnish-5.2.0 revision 4c4875cbf\r\n**** v1    0.1 CLI RX|\r\n**** v1    0.1 CLI RX|Type 'help' for command list.\r\n**** v1    0.1 CLI RX|Type 'quit' to close CLI session.\r\n**** v1    0.1 CLI RX|Type 'start' to launch worker process.\r\n**** v1    0.1 CLI TX|vcl.inline vcl1 << %XJEIFLH|)Xspa8P\r\n**** v1    0.1 CLI TX|vcl 4.0;\r\n**** v1    0.1 CLI TX|\r\n**** v1    0.1 CLI TX|\\timport dynamic from \"/usr/src/libvmod-dynamic/src/.libs/libvmod_dynamic.so\";\r\n**** v1    0.1 CLI TX|\r\n**** v1    0.1 CLI TX|\\tbackend dummy { .host = \"192.0.2.255\"; .port = \"9080\"; }\r\n**** v1    0.1 CLI TX|\r\n**** v1    0.1 CLI TX|\\tacl ipv4_loopback {\r\n**** v1    0.1 CLI TX|\\t\\t\"127/24\";\r\n**** v1    0.1 CLI TX|\\t}\r\n**** v1    0.1 CLI TX|\r\n**** v1    0.1 CLI TX|\\tsub vcl_init {\r\n**** v1    0.1 CLI TX|\\t\\tnew d1 = dynamic.director(\r\n**** v1    0.1 CLI TX|\\t\\t\\tport = \"26117\",\r\n**** v1    0.1 CLI TX|\\t\\t\\twhitelist = ipv4_loopback,\r\n**** v1    0.1 CLI TX|\\t\\t\\tdomain_usage_timeout = 1s);\r\n**** v1    0.1 CLI TX|\\t\\td1.debug(true);\r\n**** v1    0.1 CLI TX|\\t}\r\n**** v1    0.1 CLI TX|\r\n**** v1    0.1 CLI TX|\\tsub vcl_recv {\r\n**** v1    0.1 CLI TX|\\t\\tset req.backend_hint = d1.backend();\r\n**** v1    0.1 CLI TX|\\t}\r\n**** v1    0.1 CLI TX|\r\n**** v1    0.1 CLI TX|%XJEIFLH|)Xspa8P\r\n***  v1    0.2 vsl|No VSL chunk found (child not started ?)\r\n***  v1    0.2 CLI RX  200\r\n**** v1    0.2 CLI RX|VCL compiled.\r\n**** v1    0.2 CLI TX|vcl.use vcl1\r\n***  v1    0.2 CLI RX  200\r\n**   v1    0.2 Start\r\n**** v1    0.2 CLI TX|start\r\n***  v1    0.3 debug|Debug: Child (23503) Started\r\n***  v1    0.3 CLI RX  200\r\n***  v1    0.3 wait-running\r\n**** v1    0.3 CLI TX|status\r\n***  v1    0.3 debug|Info: Child (23503) said Child starts\r\n**** v1    0.3 vsl|          0 CLI             - Rd vcl.load \"vcl1\" vcl_vcl1.1509992321.789111376/vgc.so 1auto\r\n**** v1    0.3 vsl|          0 CLI             - Wr 200 55 Loaded \"vcl_vcl1.1509992321.789111376/vgc.so\" as \"vcl1\"\r\n**** v1    0.3 vsl|          0 CLI             - Rd vcl.use \"vcl1\"\r\n**** v1    0.3 vsl|          0 CLI             - Wr 200 0 \r\n**** v1    0.3 vsl|          0 CLI             - Rd start\r\n**** v1    0.3 vsl|          0 CLI             - Wr 200 0 \r\n***  v1    0.3 CLI RX  200\r\n**** v1    0.3 CLI RX|Child in state running\r\n**** v1    0.3 CLI TX|debug.xid 999\r\n***  v1    0.4 CLI RX  200\r\n**** v1    0.4 CLI RX|XID is 999\r\n**** v1    0.4 CLI TX|debug.listen_address\r\n***  v1    0.4 CLI RX  200\r\n**** v1    0.4 CLI RX|127.0.0.1 20192\r\n**   v1    0.4 Listen on 127.0.0.1 20192\r\n**** v1    0.4 macro def v1_addr=127.0.0.1\r\n**** v1    0.4 macro def v1_port=20192\r\n**** v1    0.4 macro def v1_sock=127.0.0.1 20192\r\n**   top   0.4 === logexpect l1 -v v1 -g raw {\r\n**   l1    0.4 === expect * * Debug\t\"vmod-dynamic: vcl1 d1 localhost addr 127.0...\r\n**   l1    0.4 === expect * * VCL_acl\t\"^MATCH ipv4_loopback\"\r\n**   l1    0.4 === expect * * Debug\t\"vmod-dynamic: vcl1 d1 localhost add-backen...\r\n**   l1    0.4 === expect * * Debug\t\"vmod-dynamic: vcl1 d1 localhost ref-backen...\r\n**   l1    0.4 === expect * * Debug\t\"vmod-dynamic: vcl1 d1 img.localhost addr 1...\r\n**   l1    0.4 === expect * * VCL_acl\t\"^MATCH ipv4_loopback\"\r\n**   l1    0.4 === expect * * Debug\t\"vmod-dynamic: vcl1 d1 img.localhost ref-ba...\r\n**   l1    0.4 === expect * * VCL_Log\t\"vmod-dynamic: vcl1 d1 localhost deleted\"\r\n**   l1    0.4 === expect * * Debug\t\"vmod-dynamic: vcl1 d1 localhost unref-back...\r\n**   top   0.4 === client c1 {\r\n**   c1    0.4 Starting client\r\n**   c1    0.4 Waiting for client\r\n***  c1    0.4 Connect to 127.0.0.1 20192\r\n***  c1    0.4 connected fd 22 from 127.0.0.1 62387 to 127.0.0.1 20192\r\n**   c1    0.4 === txreq -hdr \"Host: localhost\"\r\n**** c1    0.4 txreq|GET / HTTP/1.1\\r\r\n**** c1    0.4 txreq|Host: localhost\\r\r\n**** c1    0.4 txreq|\\r\r\n**   c1    0.4 === rxresp\r\n**** l1    0.4 begin|\r\n***  l1    0.4 expecting| expect * * Debug vmod-dynamic: vcl1 d1 localhost addr 127.0.0.1\r\n***  s1    0.4 accepted fd 5 127.0.0.1 48766\r\n**   s1    0.4 === rxreq\r\n**** s1    0.4 rxhdr|GET / HTTP/1.1\\r\r\n**** s1    0.4 rxhdr|Host: localhost\\r\r\n**** s1    0.4 rxhdr|X-Forwarded-For: 127.0.0.1\\r\r\n**** s1    0.4 rxhdr|Accept-Encoding: gzip\\r\r\n**** s1    0.4 rxhdr|X-Varnish: 1002\\r\r\n**** s1    0.4 rxhdr|\\r\r\n**** s1    0.4 rxhdrlen = 103\r\n**** s1    0.4 http[ 0] |GET\r\n**** s1    0.4 http[ 1] |/\r\n**** s1    0.4 http[ 2] |HTTP/1.1\r\n**** s1    0.4 http[ 3] |Host: localhost\r\n**** s1    0.4 http[ 4] |X-Forwarded-For: 127.0.0.1\r\n**** s1    0.4 http[ 5] |Accept-Encoding: gzip\r\n**** s1    0.4 http[ 6] |X-Varnish: 1002\r\n**** s1    0.4 bodylen = 0\r\n**   s1    0.4 === txresp\r\n**** s1    0.4 txresp|HTTP/1.1 200 OK\\r\r\n**** s1    0.4 txresp|Content-Length: 0\\r\r\n**** s1    0.4 txresp|\\r\r\n**   s1    0.4 === accept\r\n**** s1    0.4 Accepting\r\n**** v1    0.4 vsl|          0 CLI             - Rd debug.xid 999 \r\n**** v1    0.4 vsl|          0 CLI             - Wr 200 10 XID is 999\r\n**** v1    0.4 vsl|          0 CLI             - Rd debug.listen_address \r\n**** v1    0.4 vsl|          0 CLI             - Wr 200 16 127.0.0.1 20192\r\n\r\n**** v1    0.4 vsl|       1000 Begin           c sess 0 HTTP/1\r\n**** v1    0.4 vsl|       1000 SessOpen        c 127.0.0.1 62387 a0 127.0.0.1 20192 1509992322.088882 23\r\n**** v1    0.4 vsl|       1000 Link            c req 1001 rxreq\r\n**** v1    0.4 vsl|          0 Timestamp       - vmod-dynamic vcl1.d1(localhost) Lookup: 1509992322.089067 0.000000 0.000000\r\n**** v1    0.4 vsl|          0 Timestamp       - vmod-dynamic vcl1.d1(localhost) Results: 1509992322.089150 0.000082 0.000082\r\n**** v1    0.4 vsl|          0 Debug           - vmod-dynamic: vcl1 d1 localhost addr 127.0.0.1\r\n**** v1    0.4 vsl|          0 VCL_acl         - MATCH ipv4_loopback \"127/24\"\r\n**** v1    0.4 vsl|          0 Debug           - vmod-dynamic: vcl1 d1 localhost add-backend d1(127.0.0.1)\r\n**** v1    0.4 vsl|          0 Debug           - vmod-dynamic: vcl1 d1 localhost ref-backend d1(127.0.0.1) (1 in total)\r\n**** v1    0.4 vsl|          0 Debug           - vmod-dynamic: vcl1 d1 localhost addr 127.0.0.1\r\n**** v1    0.4 vsl|          0 VCL_acl         - MATCH ipv4_loopback \"127/24\"\r\n**** v1    0.4 vsl|          0 Debug           - vmod-dynamic: vcl1 d1 localhost ref-backend d1(127.0.0.1) (2 in total)\r\n**** v1    0.4 vsl|          0 Timestamp       - vmod-dynamic vcl1.d1(localhost) Update: 1509992322.089274 0.000207 0.000124\r\n**** v1    0.4 vsl|          0 ExpKill         - EXP_Inbox flg=1e p=0x7f9093fb1020 e=0.000000000 f=0x0\r\n**** v1    0.4 vsl|          0 ExpKill         - EXP_When p=0x7f9093fb1020 e=1509992452.089462042 f=0x1e\r\n**** v1    0.4 vsl|          0 ExpKill         - EXP_expire p=0x7f9093fb1020 e=129.999498844 f=0x0\r\n**** l1    0.4 match|          0 Debug           - vmod-dynamic: vcl1 d1 localhost addr 127.0.0.1\r\n***  l1    0.4 expecting| expect * * VCL_acl ^MATCH ipv4_loopback\r\n**** l1    0.4 match|          0 VCL_acl         - MATCH ipv4_loopback \"127/24\"\r\n***  l1    0.4 expecting| expect * * Debug vmod-dynamic: vcl1 d1 localhost add-backend d1.127.0.0.1.\r\n**** l1    0.4 match|          0 Debug           - vmod-dynamic: vcl1 d1 localhost add-backend d1(127.0.0.1)\r\n***  l1    0.4 expecting| expect * * Debug vmod-dynamic: vcl1 d1 localhost ref-backend d1.127.0.0.1. .1 in total.\r\n**** l1    0.4 match|          0 Debug           - vmod-dynamic: vcl1 d1 localhost ref-backend d1(127.0.0.1) (1 in total)\r\n***  l1    0.4 expecting| expect * * Debug vmod-dynamic: vcl1 d1 img.localhost addr 127.0.0.1\r\n**** c1    0.4 rxhdr|HTTP/1.1 200 OK\\r\r\n**** c1    0.4 rxhdr|Content-Length: 0\\r\r\n**** c1    0.4 rxhdr|Date: Mon, 06 Nov 2017 18:18:42 GMT\\r\r\n**** c1    0.4 rxhdr|X-Varnish: 1001\\r\r\n**** c1    0.4 rxhdr|Age: 0\\r\r\n**** c1    0.4 rxhdr|Via: 1.1 varnish (Varnish/5.2)\\r\r\n**** c1    0.4 rxhdr|Accept-Ranges: bytes\\r\r\n**** c1    0.4 rxhdr|Connection: keep-alive\\r\r\n**** c1    0.4 rxhdr|\\r\r\n**** c1    0.4 rxhdrlen = 178\r\n**** c1    0.4 http[ 0] |HTTP/1.1\r\n**** c1    0.4 http[ 1] |200\r\n**** c1    0.4 http[ 2] |OK\r\n**** c1    0.4 http[ 3] |Content-Length: 0\r\n**** c1    0.4 http[ 4] |Date: Mon, 06 Nov 2017 18:18:42 GMT\r\n**** c1    0.4 http[ 5] |X-Varnish: 1001\r\n**** c1    0.4 http[ 6] |Age: 0\r\n**** c1    0.4 http[ 7] |Via: 1.1 varnish (Varnish/5.2)\r\n**** c1    0.4 http[ 8] |Accept-Ranges: bytes\r\n**** c1    0.4 http[ 9] |Connection: keep-alive\r\n**** c1    0.4 bodylen = 0\r\n**   c1    0.4 === expect resp.status == 200\r\n**** c1    0.4 EXPECT resp.status (200) == \"200\" match\r\n**   c1    0.4 === delay 1.5\r\n***  c1    0.4 delaying 1.5 second(s)\r\n**** v1    0.5 vsl|       1002 Begin           b bereq 1001 fetch\r\n**** v1    0.5 vsl|       1002 Timestamp       b Start: 1509992322.089027 0.000000 0.000000\r\n**** v1    0.5 vsl|       1002 BereqMethod     b GET\r\n**** v1    0.5 vsl|       1002 BereqURL        b /\r\n**** v1    0.5 vsl|       1002 BereqProtocol   b HTTP/1.1\r\n**** v1    0.5 vsl|       1002 BereqHeader     b Host: localhost\r\n**** v1    0.5 vsl|       1002 BereqHeader     b X-Forwarded-For: 127.0.0.1\r\n**** v1    0.5 vsl|       1002 BereqHeader     b Accept-Encoding: gzip\r\n**** v1    0.5 vsl|       1002 BereqHeader     b X-Varnish: 1002\r\n**** v1    0.5 vsl|       1002 VCL_call        b BACKEND_FETCH\r\n**** v1    0.5 vsl|       1002 VCL_return      b fetch\r\n**** v1    0.5 vsl|       1002 BackendOpen     b 26 vcl1.d1(127.0.0.1) 127.0.0.1 26117 127.0.0.1 48766\r\n**** v1    0.5 vsl|       1002 BackendStart    b 127.0.0.1 26117\r\n**** v1    0.5 vsl|       1002 Timestamp       b Bereq: 1509992322.089329 0.000302 0.000302\r\n**** v1    0.5 vsl|       1002 Timestamp       b Beresp: 1509992322.089462 0.000435 0.000134\r\n**** v1    0.5 vsl|       1002 BerespProtocol  b HTTP/1.1\r\n**** v1    0.5 vsl|       1002 BerespStatus    b 200\r\n**** v1    0.5 vsl|       1002 BerespReason    b OK\r\n**** v1    0.5 vsl|       1002 BerespHeader    b Content-Length: 0\r\n**** v1    0.5 vsl|       1002 BerespHeader    b Date: Mon, 06 Nov 2017 18:18:42 GMT\r\n**** v1    0.5 vsl|       1002 TTL             b RFC 120 10 0 1509992322 1509992322 1509992322 0 0\r\n**** v1    0.5 vsl|       1002 VCL_call        b BACKEND_RESPONSE\r\n**** v1    0.5 vsl|       1002 VCL_return      b deliver\r\n**** v1    0.5 vsl|       1002 Storage         b malloc s0\r\n**** v1    0.5 vsl|       1002 ObjProtocol     b HTTP/1.1\r\n**** v1    0.5 vsl|       1002 ObjStatus       b 200\r\n**** v1    0.5 vsl|       1002 ObjReason       b OK\r\n**** v1    0.5 vsl|       1002 ObjHeader       b Content-Length: 0\r\n**** v1    0.5 vsl|       1002 ObjHeader       b Date: Mon, 06 Nov 2017 18:18:42 GMT\r\n**** v1    0.5 vsl|       1002 Fetch_Body      b 0 none -\r\n**** v1    0.5 vsl|       1002 BackendReuse    b 26 vcl1.d1(127.0.0.1)\r\n**** v1    0.5 vsl|       1002 Timestamp       b BerespBody: 1509992322.100090 0.011063 0.010628\r\n**** v1    0.5 vsl|       1002 Length          b 0\r\n**** v1    0.5 vsl|       1002 BereqAcct       b 103 0 103 38 0 38\r\n**** v1    0.5 vsl|       1002 End             b \r\n**** v1    0.5 vsl|       1001 Begin           c req 1000 rxreq\r\n**** v1    0.5 vsl|       1001 Timestamp       c Start: 1509992322.088958 0.000000 0.000000\r\n**** v1    0.5 vsl|       1001 Timestamp       c Req: 1509992322.088958 0.000000 0.000000\r\n**** v1    0.5 vsl|       1001 ReqStart        c 127.0.0.1 62387\r\n**** v1    0.5 vsl|       1001 ReqMethod       c GET\r\n**** v1    0.5 vsl|       1001 ReqURL          c /\r\n**** v1    0.5 vsl|       1001 ReqProtocol     c HTTP/1.1\r\n**** v1    0.5 vsl|       1001 ReqHeader       c Host: localhost\r\n**** v1    0.5 vsl|       1001 ReqHeader       c X-Forwarded-For: 127.0.0.1\r\n**** v1    0.5 vsl|       1001 VCL_call        c RECV\r\n**** v1    0.5 vsl|       1001 VCL_return      c hash\r\n**** v1    0.5 vsl|       1001 VCL_call        c HASH\r\n**** v1    0.5 vsl|       1001 VCL_return      c lookup\r\n**** v1    0.5 vsl|       1001 VCL_call        c MISS\r\n**** v1    0.5 vsl|       1001 VCL_return      c fetch\r\n**** v1    0.5 vsl|       1001 Link            c bereq 1002 fetch\r\n**** v1    0.5 vsl|       1001 Timestamp       c Fetch: 1509992322.100111 0.011153 0.011153\r\n**** v1    0.5 vsl|       1001 RespProtocol    c HTTP/1.1\r\n**** v1    0.5 vsl|       1001 RespStatus      c 200\r\n**** v1    0.5 vsl|       1001 RespReason      c OK\r\n**** v1    0.5 vsl|       1001 RespHeader      c Content-Length: 0\r\n**** v1    0.5 vsl|       1001 RespHeader      c Date: Mon, 06 Nov 2017 18:18:42 GMT\r\n**** v1    0.5 vsl|       1001 RespHeader      c X-Varnish: 1001\r\n**** v1    0.5 vsl|       1001 RespHeader      c Age: 0\r\n**** v1    0.5 vsl|       1001 RespHeader      c Via: 1.1 varnish (Varnish/5.2)\r\n**** v1    0.5 vsl|       1001 VCL_call        c DELIVER\r\n**** v1    0.5 vsl|       1001 VCL_return      c deliver\r\n**** v1    0.5 vsl|       1001 Timestamp       c Process: 1509992322.100124 0.011167 0.000013\r\n**** v1    0.5 vsl|       1001 RespHeader      c Accept-Ranges: bytes\r\n**** v1    0.5 vsl|       1001 RespHeader      c Connection: keep-alive\r\n**** v1    0.5 vsl|       1001 Timestamp       c Resp: 1509992322.100143 0.011186 0.000019\r\n**** v1    0.5 vsl|       1001 ReqAcct         c 35 0 35 178 0 178\r\n**** v1    0.5 vsl|       1001 End             c \r\n**   c1    1.9 === txreq -hdr \"Host: img.localhost\"\r\n**** c1    1.9 txreq|GET / HTTP/1.1\\r\r\n**** c1    1.9 txreq|Host: img.localhost\\r\r\n**** c1    1.9 txreq|\\r\r\n**   c1    1.9 === rxresp\r\n***  s1    1.9 Accepted socket fd is 5\r\n**   s1    1.9 === rxreq\r\n**** s1    1.9 rxhdr|GET / HTTP/1.1\\r\r\n**** s1    1.9 rxhdr|Host: img.localhost\\r\r\n**** s1    1.9 rxhdr|X-Forwarded-For: 127.0.0.1\\r\r\n**** s1    1.9 rxhdr|Accept-Encoding: gzip\\r\r\n**** s1    1.9 rxhdr|X-Varnish: 1004\\r\r\n**** s1    1.9 rxhdr|\\r\r\n**** s1    1.9 rxhdrlen = 107\r\n**** s1    1.9 http[ 0] |GET\r\n**** s1    1.9 http[ 1] |/\r\n**** s1    1.9 http[ 2] |HTTP/1.1\r\n**** s1    1.9 http[ 3] |Host: img.localhost\r\n**** s1    1.9 http[ 4] |X-Forwarded-For: 127.0.0.1\r\n**** s1    1.9 http[ 5] |Accept-Encoding: gzip\r\n**** s1    1.9 http[ 6] |X-Varnish: 1004\r\n**** s1    1.9 bodylen = 0\r\n**   s1    1.9 === txresp\r\n**** s1    1.9 txresp|HTTP/1.1 200 OK\\r\r\n**** s1    1.9 txresp|Content-Length: 0\\r\r\n**** s1    1.9 txresp|\\r\r\n**   s1    1.9 === accept\r\n**** s1    1.9 Accepting\r\n**** l1    1.9 match|          0 Debug           - vmod-dynamic: vcl1 d1 img.localhost addr 127.0.0.1\r\n***  l1    1.9 expecting| expect * * VCL_acl ^MATCH ipv4_loopback\r\n**** l1    1.9 match|          0 VCL_acl         - MATCH ipv4_loopback \"127/24\"\r\n***  l1    1.9 expecting| expect * * Debug vmod-dynamic: vcl1 d1 img.localhost ref-backend d1.127.0.0.1. .2 in total.\r\n**** c1    1.9 rxhdr|HTTP/1.1 200 OK\\r\r\n**** c1    1.9 rxhdr|Content-Length: 0\\r\r\n**** c1    1.9 rxhdr|Date: Mon, 06 Nov 2017 18:18:43 GMT\\r\r\n**** c1    1.9 rxhdr|X-Varnish: 1003\\r\r\n**** c1    1.9 rxhdr|Age: 0\\r\r\n**** c1    1.9 rxhdr|Via: 1.1 varnish (Varnish/5.2)\\r\r\n**** c1    1.9 rxhdr|Accept-Ranges: bytes\\r\r\n**** c1    1.9 rxhdr|Connection: keep-alive\\r\r\n**** c1    1.9 rxhdr|\\r\r\n**** c1    1.9 rxhdrlen = 178\r\n**** c1    1.9 http[ 0] |HTTP/1.1\r\n**** c1    1.9 http[ 1] |200\r\n**** c1    1.9 http[ 2] |OK\r\n**** c1    1.9 http[ 3] |Content-Length: 0\r\n**** c1    1.9 http[ 4] |Date: Mon, 06 Nov 2017 18:18:43 GMT\r\n**** c1    1.9 http[ 5] |X-Varnish: 1003\r\n**** c1    1.9 http[ 6] |Age: 0\r\n**** c1    1.9 http[ 7] |Via: 1.1 varnish (Varnish/5.2)\r\n**** c1    1.9 http[ 8] |Accept-Ranges: bytes\r\n**** c1    1.9 http[ 9] |Connection: keep-alive\r\n**** c1    1.9 bodylen = 0\r\n**   c1    1.9 === expect resp.status == 200\r\n**** c1    1.9 EXPECT resp.status (200) == \"200\" match\r\n**   c1    1.9 === txreq -hdr \"Host: www.localhost\"\r\n**** c1    1.9 txreq|GET / HTTP/1.1\\r\r\n**** c1    1.9 txreq|Host: www.localhost\\r\r\n**** c1    1.9 txreq|\\r\r\n**   c1    1.9 === rxresp\r\n***  s1    1.9 Accepted socket fd is 5\r\n**   s1    1.9 === rxreq\r\n**** s1    1.9 rxhdr|GET / HTTP/1.1\\r\r\n**** s1    1.9 rxhdr|Host: www.localhost\\r\r\n**** s1    1.9 rxhdr|X-Forwarded-For: 127.0.0.1\\r\r\n**** s1    1.9 rxhdr|Accept-Encoding: gzip\\r\r\n**** s1    1.9 rxhdr|X-Varnish: 1006\\r\r\n**** s1    1.9 rxhdr|\\r\r\n**** s1    1.9 rxhdrlen = 107\r\n**** s1    1.9 http[ 0] |GET\r\n**** s1    1.9 http[ 1] |/\r\n**** s1    1.9 http[ 2] |HTTP/1.1\r\n**** s1    1.9 http[ 3] |Host: www.localhost\r\n**** s1    1.9 http[ 4] |X-Forwarded-For: 127.0.0.1\r\n**** s1    1.9 http[ 5] |Accept-Encoding: gzip\r\n**** s1    1.9 http[ 6] |X-Varnish: 1006\r\n**** s1    1.9 bodylen = 0\r\n**   s1    1.9 === txresp\r\n**** s1    1.9 txresp|HTTP/1.1 200 OK\\r\r\n**** s1    1.9 txresp|Content-Length: 0\\r\r\n**** s1    1.9 txresp|\\r\r\n***  s1    1.9 shutting fd 5\r\n**   s1    1.9 Ending\r\n**** c1    1.9 rxhdr|HTTP/1.1 200 OK\\r\r\n**** c1    1.9 rxhdr|Content-Length: 0\\r\r\n**** c1    1.9 rxhdr|Date: Mon, 06 Nov 2017 18:18:43 GMT\\r\r\n**** c1    1.9 rxhdr|X-Varnish: 1005\\r\r\n**** c1    1.9 rxhdr|Age: 0\\r\r\n**** c1    1.9 rxhdr|Via: 1.1 varnish (Varnish/5.2)\\r\r\n**** c1    1.9 rxhdr|Accept-Ranges: bytes\\r\r\n**** c1    1.9 rxhdr|Connection: keep-alive\\r\r\n**** c1    1.9 rxhdr|\\r\r\n**** c1    1.9 rxhdrlen = 178\r\n**** c1    1.9 http[ 0] |HTTP/1.1\r\n**** c1    1.9 http[ 1] |200\r\n**** c1    1.9 http[ 2] |OK\r\n**** c1    1.9 http[ 3] |Content-Length: 0\r\n**** c1    1.9 http[ 4] |Date: Mon, 06 Nov 2017 18:18:43 GMT\r\n**** c1    1.9 http[ 5] |X-Varnish: 1005\r\n**** c1    1.9 http[ 6] |Age: 0\r\n**** c1    1.9 http[ 7] |Via: 1.1 varnish (Varnish/5.2)\r\n**** c1    1.9 http[ 8] |Accept-Ranges: bytes\r\n**** c1    1.9 http[ 9] |Connection: keep-alive\r\n**** c1    1.9 bodylen = 0\r\n**   c1    1.9 === expect resp.status == 200\r\n**** c1    1.9 EXPECT resp.status (200) == \"200\" match\r\n***  c1    1.9 closing fd 22\r\n**   c1    1.9 Ending\r\n**   top   1.9 === logexpect l1 -wait\r\n**   l1    1.9 Waiting for logexp\r\n**** v1    2.0 vsl|       1000 Link            c req 1003 rxreq\r\n**** v1    2.0 vsl|          0 Timestamp       - vmod-dynamic vcl1.d1(localhost) Done: 1509992323.601068 0.000000 0.000000\r\n**** v1    2.0 vsl|          0 Timestamp       - vmod-dynamic vcl1.d1(img.localhost) Lookup: 1509992323.601132 0.000000 0.000000\r\n**** v1    2.0 vsl|          0 Timestamp       - vmod-dynamic vcl1.d1(img.localhost) Results: 1509992323.601148 0.000016 0.000016\r\n**** v1    2.0 vsl|          0 Debug           - vmod-dynamic: vcl1 d1 img.localhost addr 127.0.0.1\r\n**** v1    2.0 vsl|          0 VCL_acl         - MATCH ipv4_loopback \"127/24\"\r\n**** v1    2.0 vsl|          0 Debug           - vmod-dynamic: vcl1 d1 img.localhost ref-backend d1(127.0.0.1) (3 in total)\r\n**** v1    2.0 vsl|          0 Timestamp       - vmod-dynamic vcl1.d1(img.localhost) Update: 1509992323.601160 0.000028 0.000011\r\n**** v1    2.0 vsl|          0 ExpKill         - EXP_expire p=0x7f9093fb1020 e=128.488030434 f=0x0\r\n**** v1    2.0 vsl|          0 ExpKill         - EXP_Inbox flg=1e p=0x7f9093fb10c0 e=0.000000000 f=0x0\r\n**** v1    2.0 vsl|          0 ExpKill         - EXP_When p=0x7f9093fb10c0 e=1509992453.601392269 f=0x1e\r\n**** v1    2.0 vsl|          0 ExpKill         - EXP_expire p=0x7f9093fb1020 e=128.488025188 f=0x0\r\n**** v1    2.0 vsl|       1004 Begin           b bereq 1003 fetch\r\n**** v1    2.0 vsl|       1004 Timestamp       b Start: 1509992323.601037 0.000000 0.000000\r\n**** v1    2.0 vsl|       1004 BereqMethod     b GET\r\n**** v1    2.0 vsl|       1004 BereqURL        b /\r\n**** v1    2.0 vsl|       1004 BereqProtocol   b HTTP/1.1\r\n**** v1    2.0 vsl|       1004 BereqHeader     b Host: img.localhost\r\n**** v1    2.0 vsl|       1004 BereqHeader     b X-Forwarded-For: 127.0.0.1\r\n**** v1    2.0 vsl|       1004 BereqHeader     b Accept-Encoding: gzip\r\n**** v1    2.0 vsl|       1004 BereqHeader     b X-Varnish: 1004\r\n**** v1    2.0 vsl|       1004 VCL_call        b BACKEND_FETCH\r\n**** v1    2.0 vsl|       1004 VCL_return      b fetch\r\n**** v1    2.0 vsl|       1004 BackendOpen     b 26 vcl1.d1(127.0.0.1) 127.0.0.1 26117 127.0.0.1 48770\r\n**** v1    2.0 vsl|       1004 BackendStart    b 127.0.0.1 26117\r\n**** v1    2.0 vsl|       1004 Timestamp       b Bereq: 1509992323.601244 0.000207 0.000207\r\n**** v1    2.0 vsl|       1004 Timestamp       b Beresp: 1509992323.601392 0.000355 0.000148\r\n**** v1    2.0 vsl|       1004 BerespProtocol  b HTTP/1.1\r\n**** v1    2.0 vsl|       1004 BerespStatus    b 200\r\n**** v1    2.0 vsl|       1004 BerespReason    b OK\r\n**** v1    2.0 vsl|       1004 BerespHeader    b Content-Length: 0\r\n**** v1    2.0 vsl|       1004 BerespHeader    b Date: Mon, 06 Nov 2017 18:18:43 GMT\r\n**** v1    2.0 vsl|       1004 TTL             b RFC 120 10 0 1509992324 1509992324 1509992323 0 0\r\n**** v1    2.0 vsl|       1004 VCL_call        b BACKEND_RESPONSE\r\n**** v1    2.0 vsl|       1004 VCL_return      b deliver\r\n**** v1    2.0 vsl|       1004 Storage         b malloc s0\r\n**** v1    2.0 vsl|       1004 ObjProtocol     b HTTP/1.1\r\n**** v1    2.0 vsl|       1004 ObjStatus       b 200\r\n**** v1    2.0 vsl|       1004 ObjReason       b OK\r\n**** v1    2.0 vsl|       1004 ObjHeader       b Content-Length: 0\r\n**** v1    2.0 vsl|       1004 ObjHeader       b Date: Mon, 06 Nov 2017 18:18:43 GMT\r\n**** v1    2.0 vsl|       1004 Fetch_Body      b 0 none -\r\n**** v1    2.0 vsl|       1004 BackendReuse    b 26 vcl1.d1(127.0.0.1)\r\n**** v1    2.0 vsl|       1004 Timestamp       b BerespBody: 1509992323.611567 0.010530 0.010175\r\n**** v1    2.0 vsl|       1004 Length          b 0\r\n**** v1    2.0 vsl|       1004 BereqAcct       b 107 0 107 38 0 38\r\n**** v1    2.0 vsl|       1004 End             b \r\n**** v1    2.0 vsl|       1003 Begin           c req 1000 rxreq\r\n**** v1    2.0 vsl|       1003 Timestamp       c Start: 1509992323.600570 0.000000 0.000000\r\n**** v1    2.0 vsl|       1003 Timestamp       c Req: 1509992323.600570 0.000000 0.000000\r\n**** v1    2.0 vsl|       1003 ReqStart        c 127.0.0.1 62387\r\n**** v1    2.0 vsl|       1003 ReqMethod       c GET\r\n**** v1    2.0 vsl|       1003 ReqURL          c /\r\n**** v1    2.0 vsl|       1003 ReqProtocol     c HTTP/1.1\r\n**** v1    2.0 vsl|       1003 ReqHeader       c Host: img.localhost\r\n**** v1    2.0 vsl|       1003 ReqHeader       c X-Forwarded-For: 127.0.0.1\r\n**** v1    2.0 vsl|       1003 VCL_call        c RECV\r\n**** v1    2.0 vsl|       1003 VCL_Log         c vmod-dynamic: vcl1 d1 localhost timeout\r\n**** v1    2.0 vsl|       1003 VCL_return      c hash\r\n**** v1    2.0 vsl|       1003 VCL_call        c HASH\r\n**** v1    2.0 vsl|       1003 VCL_return      c lookup\r\n**** v1    2.0 vsl|       1003 VCL_call        c MISS\r\n**** v1    2.0 vsl|       1003 VCL_return      c fetch\r\n**** v1    2.0 vsl|       1003 Link            c bereq 1004 fetch\r\n**** v1    2.0 vsl|       1003 Timestamp       c Fetch: 1509992323.611600 0.011030 0.011030\r\n**** v1    2.0 vsl|       1003 RespProtocol    c HTTP/1.1\r\n**** v1    2.0 vsl|       1003 RespStatus      c 200\r\n**** v1    2.0 vsl|       1003 RespReason      c OK\r\n**** v1    2.0 vsl|       1003 RespHeader      c Content-Length: 0\r\n**** v1    2.0 vsl|       1003 RespHeader      c Date: Mon, 06 Nov 2017 18:18:43 GMT\r\n**** v1    2.0 vsl|       1003 RespHeader      c X-Varnish: 1003\r\n**** v1    2.0 vsl|       1003 RespHeader      c Age: 0\r\n**** v1    2.0 vsl|       1003 RespHeader      c Via: 1.1 varnish (Varnish/5.2)\r\n**** v1    2.0 vsl|       1003 VCL_call        c DELIVER\r\n**** v1    2.0 vsl|       1003 VCL_return      c deliver\r\n**** v1    2.0 vsl|       1003 Timestamp       c Process: 1509992323.611609 0.011038 0.000008\r\n**** v1    2.0 vsl|       1003 RespHeader      c Accept-Ranges: bytes\r\n**** v1    2.0 vsl|       1003 RespHeader      c Connection: keep-alive\r\n**** v1    2.0 vsl|       1003 Timestamp       c Resp: 1509992323.611627 0.011057 0.000019\r\n**** v1    2.0 vsl|       1003 ReqAcct         c 39 0 39 178 0 178\r\n**** v1    2.0 vsl|       1003 End             c \r\n**** v1    2.0 vsl|       1000 Link            c req 1005 rxreq\r\n**** v1    2.0 vsl|          0 Timestamp       - vmod-dynamic vcl1.d1(www.localhost) Lookup: 1509992323.611864 0.000000 0.000000\r\n**** v1    2.0 vsl|          0 Timestamp       - vmod-dynamic vcl1.d1(www.localhost) Results: 1509992323.611876 0.000013 0.000013\r\n**** v1    2.0 vsl|          0 Debug           - vmod-dynamic: vcl1 d1 www.localhost addr 127.0.0.1\r\n**** v1    2.0 vsl|          0 VCL_acl         - MATCH ipv4_loopback \"127/24\"\r\n**** v1    2.0 vsl|          0 Debug           - vmod-dynamic: vcl1 d1 www.localhost ref-backend d1(127.0.0.1) (2 in total)\r\n**** v1    2.0 vsl|          0 Timestamp       - vmod-dynamic vcl1.d1(www.localhost) Update: 1509992323.611887 0.000023 0.000010\r\n**** v1    2.0 vsl|          0 ExpKill         - EXP_expire p=0x7f9093fb1020 e=128.477345943 f=0x0\r\n**** v1    2.0 vsl|          0 ExpKill         - EXP_Inbox flg=1e p=0x7f9093fb1160 e=0.000000000 f=0x0\r\n**** v1    2.0 vsl|          0 ExpKill         - EXP_When p=0x7f9093fb1160 e=1509992453.612084389 f=0x1e\r\n**** v1    2.0 vsl|          0 ExpKill         - EXP_expire p=0x7f9093fb1020 e=128.477341175 f=0x0\r\n**** v1    2.0 vsl|       1006 Begin           b bereq 1005 fetch\r\n**** v1    2.0 vsl|       1006 Timestamp       b Start: 1509992323.611839 0.000000 0.000000\r\n**** v1    2.0 vsl|       1006 BereqMethod     b GET\r\n**** v1    2.0 vsl|       1006 BereqURL        b /\r\n**** v1    2.0 vsl|       1006 BereqProtocol   b HTTP/1.1\r\n**** v1    2.0 vsl|       1006 BereqHeader     b Host: www.localhost\r\n**** v1    2.0 vsl|       1006 BereqHeader     b X-Forwarded-For: 127.0.0.1\r\n**** v1    2.0 vsl|       1006 BereqHeader     b Accept-Encoding: gzip\r\n**** v1    2.0 vsl|       1006 BereqHeader     b X-Varnish: 1006\r\n**** v1    2.0 vsl|       1006 VCL_call        b BACKEND_FETCH\r\n**** v1    2.0 vsl|       1006 VCL_return      b fetch\r\n**** v1    2.0 vsl|       1006 BackendOpen     b 26 vcl1.d1(127.0.0.1) 127.0.0.1 26117 127.0.0.1 48772\r\n**** v1    2.0 vsl|       1006 BackendStart    b 127.0.0.1 26117\r\n**** v1    2.0 vsl|       1006 Timestamp       b Bereq: 1509992323.611935 0.000096 0.000096\r\n**** v1    2.0 vsl|       1006 Timestamp       b Beresp: 1509992323.612084 0.000245 0.000150\r\n**** v1    2.0 vsl|       1006 BerespProtocol  b HTTP/1.1\r\n**** v1    2.0 vsl|       1006 BerespStatus    b 200\r\n**** v1    2.0 vsl|       1006 BerespReason    b OK\r\n**** v1    2.0 vsl|       1006 BerespHeader    b Content-Length: 0\r\n**** v1    2.0 vsl|       1006 BerespHeader    b Date: Mon, 06 Nov 2017 18:18:43 GMT\r\n**** v1    2.0 vsl|       1006 TTL             b RFC 120 10 0 1509992324 1509992324 1509992323 0 0\r\n**** v1    2.0 vsl|       1006 VCL_call        b BACKEND_RESPONSE\r\n**** v1    2.0 vsl|       1006 VCL_return      b deliver\r\n**** v1    2.0 vsl|       1006 Storage         b malloc s0\r\n**** v1    2.0 vsl|       1006 ObjProtocol     b HTTP/1.1\r\n**** v1    2.0 vsl|       1006 ObjStatus       b 200\r\n**** v1    2.0 vsl|       1006 ObjReason       b OK\r\n**** v1    2.0 vsl|       1006 ObjHeader       b Content-Length: 0\r\n**** v1    2.0 vsl|       1006 ObjHeader       b Date: Mon, 06 Nov 2017 18:18:43 GMT\r\n**** v1    2.0 vsl|       1006 Fetch_Body      b 0 none -\r\n**** v1    2.0 vsl|       1006 BackendReuse    b 26 vcl1.d1(127.0.0.1)\r\n**** v1    2.0 vsl|       1006 Timestamp       b BerespBody: 1509992323.622266 0.010427 0.010182\r\n**** v1    2.0 vsl|       1006 Length          b 0\r\n**** v1    2.0 vsl|       1006 BereqAcct       b 107 0 107 38 0 38\r\n**** v1    2.0 vsl|       1006 End             b \r\n**** v1    2.0 vsl|       1005 Begin           c req 1000 rxreq\r\n**** v1    2.0 vsl|       1005 Timestamp       c Start: 1509992323.611790 0.000000 0.000000\r\n**** v1    2.0 vsl|       1005 Timestamp       c Req: 1509992323.611790 0.000000 0.000000\r\n**** v1    2.0 vsl|       1005 ReqStart        c 127.0.0.1 62387\r\n**** v1    2.0 vsl|       1005 ReqMethod       c GET\r\n**** v1    2.0 vsl|       1005 ReqURL          c /\r\n**** v1    2.0 vsl|       1005 ReqProtocol     c HTTP/1.1\r\n**** v1    2.0 vsl|       1005 ReqHeader       c Host: www.localhost\r\n**** v1    2.0 vsl|       1005 ReqHeader       c X-Forwarded-For: 127.0.0.1\r\n**** v1    2.0 vsl|       1005 VCL_call        c RECV\r\n**** v1    2.0 vsl|       1005 VCL_Log         c vmod-dynamic: vcl1 d1 localhost deleted\r\n**** v1    2.0 vsl|       1005 Debug           c vmod-dynamic: vcl1 d1 localhost unref-backend d1(127.0.0.1) (2 remaining)\r\n**** v1    2.0 vsl|       1005 Debug           c vmod-dynamic: vcl1 d1 localhost unref-backend d1(127.0.0.1) (1 remaining)\r\n**** v1    2.0 vsl|       1005 VCL_return      c hash\r\n**** v1    2.0 vsl|       1005 VCL_call        c HASH\r\n**** v1    2.0 vsl|       1005 VCL_return      c lookup\r\n**** v1    2.0 vsl|       1005 VCL_call        c MISS\r\n**** v1    2.0 vsl|       1005 VCL_return      c fetch\r\n**** v1    2.0 vsl|       1005 Link            c bereq 1006 fetch\r\n**** v1    2.0 vsl|       1005 Timestamp       c Fetch: 1509992323.622296 0.010506 0.010506\r\n**** v1    2.0 vsl|       1005 RespProtocol    c HTTP/1.1\r\n**** v1    2.0 vsl|       1005 RespStatus      c 200\r\n**** v1    2.0 vsl|       1005 RespReason      c OK\r\n**** v1    2.0 vsl|       1005 RespHeader      c Content-Length: 0\r\n**** v1    2.0 vsl|       1005 RespHeader      c Date: Mon, 06 Nov 2017 18:18:43 GMT\r\n**** v1    2.0 vsl|       1005 RespHeader      c X-Varnish: 1005\r\n**** v1    2.0 vsl|       1005 RespHeader      c Age: 0\r\n**** v1    2.0 vsl|       1005 RespHeader      c Via: 1.1 varnish (Varnish/5.2)\r\n**** v1    2.0 vsl|       1005 VCL_call        c DELIVER\r\n**** v1    2.0 vsl|       1005 VCL_return      c deliver\r\n**** v1    2.0 vsl|       1005 Timestamp       c Process: 1509992323.622311 0.010521 0.000015\r\n**** v1    2.0 vsl|       1005 RespHeader      c Accept-Ranges: bytes\r\n**** v1    2.0 vsl|       1005 RespHeader      c Connection: keep-alive\r\n**** v1    2.0 vsl|       1005 Timestamp       c Resp: 1509992323.622345 0.010555 0.000034\r\n**** v1    2.0 vsl|       1005 ReqAcct         c 39 0 39 178 0 178\r\n**** v1    2.0 vsl|       1005 End             c \r\n**** v1    2.0 vsl|       1000 SessClose       c REM_CLOSE 1.534\r\n**** v1    2.0 vsl|       1000 End             c \r\n**** v1    3.3 vsl|          0 CLI             - Rd ping\r\n**** v1    3.3 vsl|          0 CLI             - Wr 200 19 PONG 1509992324 1.0\r\n**** v1    6.3 vsl|          0 CLI             - Rd ping\r\n**** v1    6.3 vsl|          0 CLI             - Wr 200 19 PONG 1509992327 1.0\r\n**** v1    9.3 vsl|          0 CLI             - Rd ping\r\n**** v1    9.3 vsl|          0 CLI             - Wr 200 19 PONG 1509992330 1.0\r\n**** v1   12.3 vsl|          0 CLI             - Rd ping\r\n**** v1   12.3 vsl|          0 CLI             - Wr 200 19 PONG 1509992333 1.0\r\n**** v1   15.3 vsl|          0 CLI             - Rd ping\r\n**** v1   15.3 vsl|          0 CLI             - Wr 200 19 PONG 1509992336 1.0\r\n**** v1   18.3 vsl|          0 CLI             - Rd ping\r\n**** v1   18.3 vsl|          0 CLI             - Wr 200 19 PONG 1509992339 1.0\r\n**** v1   21.3 vsl|          0 CLI             - Rd ping\r\n**** v1   21.3 vsl|          0 CLI             - Wr 200 19 PONG 1509992342 1.0\r\n**** v1   24.3 vsl|          0 CLI             - Rd ping\r\n**** v1   24.3 vsl|          0 CLI             - Wr 200 19 PONG 1509992345 1.0\r\n**** v1   27.4 vsl|          0 CLI             - Rd ping\r\n**** v1   27.4 vsl|          0 CLI             - Wr 200 19 PONG 1509992348 1.0\r\n**** v1   30.4 vsl|          0 CLI             - Rd ping\r\n**** v1   30.4 vsl|          0 CLI             - Wr 200 19 PONG 1509992351 1.0\r\n**** v1   33.4 vsl|          0 CLI             - Rd ping\r\n**** v1   33.4 vsl|          0 CLI             - Wr 200 19 PONG 1509992354 1.0\r\n**** v1   36.4 vsl|          0 CLI             - Rd ping\r\n**** v1   36.4 vsl|          0 CLI             - Wr 200 19 PONG 1509992357 1.0\r\n**** v1   39.4 vsl|          0 CLI             - Rd ping\r\n**** v1   39.4 vsl|          0 CLI             - Wr 200 19 PONG 1509992360 1.0\r\n**** v1   42.4 vsl|          0 CLI             - Rd ping\r\n**** v1   42.4 vsl|          0 CLI             - Wr 200 19 PONG 1509992363 1.0\r\n**** v1   45.3 vsl|          0 CLI             - Rd ping\r\n**** v1   45.3 vsl|          0 CLI             - Wr 200 19 PONG 1509992366 1.0\r\n**** v1   48.3 vsl|          0 CLI             - Rd ping\r\n**** v1   48.3 vsl|          0 CLI             - Wr 200 19 PONG 1509992369 1.0\r\n**** v1   51.3 vsl|          0 CLI             - Rd ping\r\n**** v1   51.3 vsl|          0 CLI             - Wr 200 19 PONG 1509992372 1.0\r\n**** v1   54.3 vsl|          0 CLI             - Rd ping\r\n**** v1   54.3 vsl|          0 CLI             - Wr 200 19 PONG 1509992375 1.0\r\n**** v1   57.3 vsl|          0 CLI             - Rd ping\r\n**** v1   57.3 vsl|          0 CLI             - Wr 200 19 PONG 1509992378 1.0\r\n#    top  TEST ./tests/test07.vtc TIMED OUT (kill -9)\r\n#    top  TEST ./tests/test07.vtc FAILED (60.031) signal=9\r\nFAIL tests/test07.vtc (exit status: 2)\r\n\r\n```","closed_by":{"login":"nigoroll","id":1528104,"node_id":"MDQ6VXNlcjE1MjgxMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1528104?v=4","gravatar_id":"","url":"https://api.github.com/users/nigoroll","html_url":"https://github.com/nigoroll","followers_url":"https://api.github.com/users/nigoroll/followers","following_url":"https://api.github.com/users/nigoroll/following{/other_user}","gists_url":"https://api.github.com/users/nigoroll/gists{/gist_id}","starred_url":"https://api.github.com/users/nigoroll/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nigoroll/subscriptions","organizations_url":"https://api.github.com/users/nigoroll/orgs","repos_url":"https://api.github.com/users/nigoroll/repos","events_url":"https://api.github.com/users/nigoroll/events{/privacy}","received_events_url":"https://api.github.com/users/nigoroll/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/31/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/31/timeline","performed_via_github_app":null,"state_reason":"completed"},{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/32","repository_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/32/labels{/name}","comments_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/32/comments","events_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/32/events","html_url":"https://github.com/nigoroll/libvmod-dynamic/issues/32","id":275660712,"node_id":"MDU6SXNzdWUyNzU2NjA3MTI=","number":32,"title":"Assert error in vca_acct(), cache/cache_acceptor.c line 497 while initailly loading the module","user":{"login":"jpastuszek","id":20052,"node_id":"MDQ6VXNlcjIwMDUy","avatar_url":"https://avatars.githubusercontent.com/u/20052?v=4","gravatar_id":"","url":"https://api.github.com/users/jpastuszek","html_url":"https://github.com/jpastuszek","followers_url":"https://api.github.com/users/jpastuszek/followers","following_url":"https://api.github.com/users/jpastuszek/following{/other_user}","gists_url":"https://api.github.com/users/jpastuszek/gists{/gist_id}","starred_url":"https://api.github.com/users/jpastuszek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpastuszek/subscriptions","organizations_url":"https://api.github.com/users/jpastuszek/orgs","repos_url":"https://api.github.com/users/jpastuszek/repos","events_url":"https://api.github.com/users/jpastuszek/events{/privacy}","received_events_url":"https://api.github.com/users/jpastuszek/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2017-11-21T10:33:18Z","updated_at":"2017-11-21T14:00:37Z","closed_at":"2017-11-21T14:00:37Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I am using varnish 4.1.3.\r\nWhen loading this module into running Varnish instance it crashes on assertion an I lose my cache:\r\n```Assert error in vca_acct(), cache/cache_acceptor.c line 497:   Condition(ls->sock > 0) not true. thread = (cache-acceptor) version = varnish-4.1.3 revision 5e3b6d2 ident = Linux,4.4.16-27.56.amzn1.x86_64,x86_64,-junix,-smalloc,-smalloc,-hcritbit,epoll Backtrace:   0x432f23: varnishd() [0x432f23]   0x40efc0: varnishd(VCA_NewPool+0) [0x40efc0]   0x7f6f5ea69dc5: libpthread.so.0(+0x7dc5) [0x7f6f5ea69dc5]   0x7f6f5e796c9d: libc.so.6(clone+0x6d) [0x7f6f5e796c9d]```\r\nThis makes it difficult to introduce it to running system (cache loss).","closed_by":{"login":"nigoroll","id":1528104,"node_id":"MDQ6VXNlcjE1MjgxMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1528104?v=4","gravatar_id":"","url":"https://api.github.com/users/nigoroll","html_url":"https://github.com/nigoroll","followers_url":"https://api.github.com/users/nigoroll/followers","following_url":"https://api.github.com/users/nigoroll/following{/other_user}","gists_url":"https://api.github.com/users/nigoroll/gists{/gist_id}","starred_url":"https://api.github.com/users/nigoroll/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nigoroll/subscriptions","organizations_url":"https://api.github.com/users/nigoroll/orgs","repos_url":"https://api.github.com/users/nigoroll/repos","events_url":"https://api.github.com/users/nigoroll/events{/privacy}","received_events_url":"https://api.github.com/users/nigoroll/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/32/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/32/timeline","performed_via_github_app":null,"state_reason":"completed"},{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/33","repository_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/33/labels{/name}","comments_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/33/comments","events_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/33/events","html_url":"https://github.com/nigoroll/libvmod-dynamic/issues/33","id":291752206,"node_id":"MDU6SXNzdWUyOTE3NTIyMDY=","number":33,"title":"libvmod-dynamic only uses 3 ips from 10: add tcp query support","user":{"login":"danielmotaleite","id":11890049,"node_id":"MDQ6VXNlcjExODkwMDQ5","avatar_url":"https://avatars.githubusercontent.com/u/11890049?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmotaleite","html_url":"https://github.com/danielmotaleite","followers_url":"https://api.github.com/users/danielmotaleite/followers","following_url":"https://api.github.com/users/danielmotaleite/following{/other_user}","gists_url":"https://api.github.com/users/danielmotaleite/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmotaleite/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmotaleite/subscriptions","organizations_url":"https://api.github.com/users/danielmotaleite/orgs","repos_url":"https://api.github.com/users/danielmotaleite/repos","events_url":"https://api.github.com/users/danielmotaleite/events{/privacy}","received_events_url":"https://api.github.com/users/danielmotaleite/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2018-01-25T23:28:19Z","updated_at":"2019-07-13T16:47:45Z","closed_at":"2018-01-26T02:17:48Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I have a setup where i have multiple backends (10) and use consul to manage the available backend list.  Today i noticed that only a few backends (usually 3) are used, but they are always changing, on every minute, as i set `TTL= 60s`\r\n\r\n```\r\n$ while sleep 60; do varnishadm -n $HOSTNAME.live backend.list | grep _p  ; echo ; done \r\nvcl_7da98ec3-be47-4ef6-88f6-42c0208b12e0.alice_p(172.30.154.202) probe      Healthy             5/5 Thu, 25 Jan 2018 23:00:06 GMT\r\nvcl_7da98ec3-be47-4ef6-88f6-42c0208b12e0.alice_p(172.30.243.214) probe      Healthy             5/5 Thu, 25 Jan 2018 23:01:06 GMT\r\nvcl_7da98ec3-be47-4ef6-88f6-42c0208b12e0.alice_p(172.30.249.132) probe      Healthy             5/5 Thu, 25 Jan 2018 23:01:06 GMT\r\n\r\nvcl_7da98ec3-be47-4ef6-88f6-42c0208b12e0.alice_p(172.30.243.214) probe      Healthy             5/5 Thu, 25 Jan 2018 23:01:06 GMT\r\nvcl_7da98ec3-be47-4ef6-88f6-42c0208b12e0.alice_p(172.30.219.96) probe      Healthy             5/5 Thu, 25 Jan 2018 23:02:06 GMT\r\nvcl_7da98ec3-be47-4ef6-88f6-42c0208b12e0.alice_p(172.30.150.186) probe      Healthy             5/5 Thu, 25 Jan 2018 23:02:06 GMT\r\n\r\nvcl_7da98ec3-be47-4ef6-88f6-42c0208b12e0.alice_p(172.30.249.132) probe      Healthy             5/5 Thu, 25 Jan 2018 23:03:06 GMT\r\nvcl_7da98ec3-be47-4ef6-88f6-42c0208b12e0.alice_p(172.30.251.37) probe      Healthy             5/5 Thu, 25 Jan 2018 23:03:06 GMT\r\nvcl_7da98ec3-be47-4ef6-88f6-42c0208b12e0.alice_p(172.30.154.202) probe      Healthy             5/5 Thu, 25 Jan 2018 23:03:06 GMT\r\n\r\nvcl_7da98ec3-be47-4ef6-88f6-42c0208b12e0.alice_p(172.30.251.37) probe      Healthy             5/5 Thu, 25 Jan 2018 23:03:06 GMT\r\nvcl_7da98ec3-be47-4ef6-88f6-42c0208b12e0.alice_p(172.30.161.48) probe      Healthy             5/5 Thu, 25 Jan 2018 23:04:06 GMT\r\nvcl_7da98ec3-be47-4ef6-88f6-42c0208b12e0.alice_p(172.30.209.195) probe      Healthy             5/5 Thu, 25 Jan 2018 23:04:06 GMT\r\n```\r\n\r\nA normal udp query return 3 entries:\r\n```\r\n$ host  alice-live-p.service.consul.\r\nalice-live-p.service.consul has address 172.30.209.195\r\nalice-live-p.service.consul has address 172.30.251.37\r\nalice-live-p.service.consul has address 172.30.161.48\r\n```\r\nbut using TCP query, we get the list of 10 IPs:\r\n```\r\n$ host -T  alice-live-p.service.consul.\r\nalice-live-p.service.consul has address 172.30.251.37\r\nalice-live-p.service.consul has address 172.30.219.96\r\nalice-live-p.service.consul has address 172.30.150.186\r\nalice-live-p.service.consul has address 172.30.209.195\r\nalice-live-p.service.consul has address 172.30.133.54\r\nalice-live-p.service.consul has address 172.30.154.202\r\nalice-live-p.service.consul has address 172.30.161.48\r\nalice-live-p.service.consul has address 172.30.137.218\r\nalice-live-p.service.consul has address 172.30.249.132\r\nalice-live-p.service.consul has address 172.30.243.214\r\n```\r\n\r\nSo looks like the module is using UDP for the query... i think if there is support  for TCP queries, it maybe would return the 10 IP list and use all the available backends\r\n\r\n","closed_by":{"login":"danielmotaleite","id":11890049,"node_id":"MDQ6VXNlcjExODkwMDQ5","avatar_url":"https://avatars.githubusercontent.com/u/11890049?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmotaleite","html_url":"https://github.com/danielmotaleite","followers_url":"https://api.github.com/users/danielmotaleite/followers","following_url":"https://api.github.com/users/danielmotaleite/following{/other_user}","gists_url":"https://api.github.com/users/danielmotaleite/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmotaleite/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmotaleite/subscriptions","organizations_url":"https://api.github.com/users/danielmotaleite/orgs","repos_url":"https://api.github.com/users/danielmotaleite/repos","events_url":"https://api.github.com/users/danielmotaleite/events{/privacy}","received_events_url":"https://api.github.com/users/danielmotaleite/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/33/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/33/timeline","performed_via_github_app":null,"state_reason":"completed"},{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/35","repository_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/35/labels{/name}","comments_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/35/comments","events_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/35/events","html_url":"https://github.com/nigoroll/libvmod-dynamic/issues/35","id":305604786,"node_id":"MDU6SXNzdWUzMDU2MDQ3ODY=","number":35,"title":"Backend seems sick on first access","user":{"login":"ghost","id":10137,"node_id":"MDQ6VXNlcjEwMTM3","avatar_url":"https://avatars.githubusercontent.com/u/10137?v=4","gravatar_id":"","url":"https://api.github.com/users/ghost","html_url":"https://github.com/ghost","followers_url":"https://api.github.com/users/ghost/followers","following_url":"https://api.github.com/users/ghost/following{/other_user}","gists_url":"https://api.github.com/users/ghost/gists{/gist_id}","starred_url":"https://api.github.com/users/ghost/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ghost/subscriptions","organizations_url":"https://api.github.com/users/ghost/orgs","repos_url":"https://api.github.com/users/ghost/repos","events_url":"https://api.github.com/users/ghost/events{/privacy}","received_events_url":"https://api.github.com/users/ghost/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":17,"created_at":"2018-03-15T15:36:34Z","updated_at":"2018-04-17T09:58:02Z","closed_at":"2018-03-16T16:10:07Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hi.\r\n\r\nI have Varnish 5.2.1 with vmod dynamic installed from Yum Repositories on CentOS7 Server, and i'm facing this situation: after a vcl reload the first call to a site server by vmod_dynamic director give me the mainenance page, like the backend was sick, bat the backend is up and running, so simply hitting F5 gave me access to the site.\r\n\r\nMaybe a problem with the first dns lookup? Or maybe i've made some misconfiguration?\r\n\r\nWhat other info do you need to help me with this problem?\r\n\r\nBest Regard","closed_by":{"login":"nigoroll","id":1528104,"node_id":"MDQ6VXNlcjE1MjgxMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1528104?v=4","gravatar_id":"","url":"https://api.github.com/users/nigoroll","html_url":"https://github.com/nigoroll","followers_url":"https://api.github.com/users/nigoroll/followers","following_url":"https://api.github.com/users/nigoroll/following{/other_user}","gists_url":"https://api.github.com/users/nigoroll/gists{/gist_id}","starred_url":"https://api.github.com/users/nigoroll/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nigoroll/subscriptions","organizations_url":"https://api.github.com/users/nigoroll/orgs","repos_url":"https://api.github.com/users/nigoroll/repos","events_url":"https://api.github.com/users/nigoroll/events{/privacy}","received_events_url":"https://api.github.com/users/nigoroll/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/35/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/35/timeline","performed_via_github_app":null,"state_reason":"completed"},{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/36","repository_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/36/labels{/name}","comments_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/36/comments","events_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/36/events","html_url":"https://github.com/nigoroll/libvmod-dynamic/issues/36","id":307665895,"node_id":"MDU6SXNzdWUzMDc2NjU4OTU=","number":36,"title":"Difficulty building against varnish 5.2.1 for xkey vmod","user":{"login":"hardik8585","id":32997161,"node_id":"MDQ6VXNlcjMyOTk3MTYx","avatar_url":"https://avatars.githubusercontent.com/u/32997161?v=4","gravatar_id":"","url":"https://api.github.com/users/hardik8585","html_url":"https://github.com/hardik8585","followers_url":"https://api.github.com/users/hardik8585/followers","following_url":"https://api.github.com/users/hardik8585/following{/other_user}","gists_url":"https://api.github.com/users/hardik8585/gists{/gist_id}","starred_url":"https://api.github.com/users/hardik8585/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hardik8585/subscriptions","organizations_url":"https://api.github.com/users/hardik8585/orgs","repos_url":"https://api.github.com/users/hardik8585/repos","events_url":"https://api.github.com/users/hardik8585/events{/privacy}","received_events_url":"https://api.github.com/users/hardik8585/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2018-03-22T14:25:40Z","updated_at":"2018-03-22T14:35:00Z","closed_at":"2018-03-22T14:35:00Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"./bootstrap\r\n+ mkdir -p m4\r\n+ aclocal -I m4 -I /usr/share/aclocal\r\n+ libtoolize --copy --force\r\nlibtoolize: putting auxiliary files in AC_CONFIG_AUX_DIR, `build-aux'.\r\nlibtoolize: copying file `build-aux/ltmain.sh'\r\nlibtoolize: putting macros in AC_CONFIG_MACRO_DIR, `m4'.\r\nlibtoolize: copying file `m4/libtool.m4'\r\nlibtoolize: copying file `m4/ltoptions.m4'\r\nlibtoolize: copying file `m4/ltsugar.m4'\r\nlibtoolize: copying file `m4/ltversion.m4'\r\nlibtoolize: copying file `m4/lt~obsolete.m4'\r\n+ autoheader\r\n+ automake --add-missing --copy --foreign\r\nsrc/Makefile.am:24: error: 'vmod_LTLIBRARIES' is used but 'vmoddir' is undefined\r\nsrc/Makefile.am:51: warning: variable 'libvmod_header_la_SOURCES' is defined but no program or\r\nsrc/Makefile.am:51: library has 'libvmod_header_la' as canonical name (possible typo)\r\nsrc/Makefile.am:65: warning: variable 'nodist_libvmod_xkey_la_SOURCES' is defined but no program or\r\nsrc/Makefile.am:65: library has 'libvmod_xkey_la' as canonical name (possible typo)\r\nsrc/Makefile.am:61: warning: variable 'nodist_libvmod_vsthrottle_la_SOURCES' is defined but no program or\r\nsrc/Makefile.am:61: library has 'libvmod_vsthrottle_la' as canonical name (possible typo)\r\nsrc/Makefile.am:56: warning: variable 'libvmod_xkey_la_SOURCES' is defined but no program or\r\nsrc/Makefile.am:56: library has 'libvmod_xkey_la' as canonical name (possible typo)\r\nsrc/Makefile.am:64: warning: variable 'nodist_libvmod_var_la_SOURCES' is defined but no program or\r\nsrc/Makefile.am:64: library has 'libvmod_var_la' as canonical name (possible typo)\r\nsrc/Makefile.am:53: warning: variable 'libvmod_saintmode_la_SOURCES' is defined but no program or\r\nsrc/Makefile.am:53: library has 'libvmod_saintmode_la' as canonical name (possible typo)\r\nsrc/Makefile.am:58: warning: variable 'nodist_libvmod_bodyaccess_la_SOURCES' is defined but no program or\r\nsrc/Makefile.am:58: library has 'libvmod_bodyaccess_la' as canonical name (possible typo)\r\nsrc/Makefile.am:63: warning: variable 'nodist_libvmod_tcp_la_SOURCES' is defined but no program or\r\nsrc/Makefile.am:63: library has 'libvmod_tcp_la' as canonical name (possible typo)\r\nsrc/Makefile.am:59: warning: variable 'nodist_libvmod_cookie_la_SOURCES' is defined but no program or\r\nsrc/Makefile.am:59: library has 'libvmod_cookie_la' as canonical name (possible typo)\r\nsrc/Makefile.am:62: warning: variable 'nodist_libvmod_saintmode_la_SOURCES' is defined but no program or\r\nsrc/Makefile.am:62: library has 'libvmod_saintmode_la' as canonical name (possible typo)\r\nsrc/Makefile.am:50: warning: variable 'libvmod_cookie_la_SOURCES' is defined but no program or\r\nsrc/Makefile.am:50: library has 'libvmod_cookie_la' as canonical name (possible typo)\r\nsrc/Makefile.am:55: warning: variable 'libvmod_var_la_SOURCES' is defined but no program or\r\nsrc/Makefile.am:55: library has 'libvmod_var_la' as canonical name (possible typo)\r\nsrc/Makefile.am:83: warning: variable 'nodist_libvmod_softpurge_la_SOURCES' is defined but no program or\r\nsrc/Makefile.am:83: library has 'libvmod_softpurge_la' as canonical name (possible typo)\r\nsrc/Makefile.am:60: warning: variable 'nodist_libvmod_header_la_SOURCES' is defined but no program or\r\nsrc/Makefile.am:60: library has 'libvmod_header_la' as canonical name (possible typo)\r\nsrc/Makefile.am:52: warning: variable 'libvmod_vsthrottle_la_SOURCES' is defined but no program or\r\nsrc/Makefile.am:52: library has 'libvmod_vsthrottle_la' as canonical name (possible typo)\r\nsrc/Makefile.am:49: warning: variable 'libvmod_bodyaccess_la_SOURCES' is defined but no program or\r\nsrc/Makefile.am:49: library has 'libvmod_bodyaccess_la' as canonical name (possible typo)\r\nsrc/Makefile.am:54: warning: variable 'libvmod_tcp_la_SOURCES' is defined but no program or\r\nsrc/Makefile.am:54: library has 'libvmod_tcp_la' as canonical name (possible typo)\r\nsrc/Makefile.am:82: warning: variable 'libvmod_softpurge_la_SOURCES' is defined but no program or\r\nsrc/Makefile.am:82: library has 'libvmod_softpurge_la' as canonical name (possible typo)\r\n\r\n\r\nBecause of this error, its now generating configure file.","closed_by":{"login":"nigoroll","id":1528104,"node_id":"MDQ6VXNlcjE1MjgxMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1528104?v=4","gravatar_id":"","url":"https://api.github.com/users/nigoroll","html_url":"https://github.com/nigoroll","followers_url":"https://api.github.com/users/nigoroll/followers","following_url":"https://api.github.com/users/nigoroll/following{/other_user}","gists_url":"https://api.github.com/users/nigoroll/gists{/gist_id}","starred_url":"https://api.github.com/users/nigoroll/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nigoroll/subscriptions","organizations_url":"https://api.github.com/users/nigoroll/orgs","repos_url":"https://api.github.com/users/nigoroll/repos","events_url":"https://api.github.com/users/nigoroll/events{/privacy}","received_events_url":"https://api.github.com/users/nigoroll/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/36/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/36/timeline","performed_via_github_app":null,"state_reason":"completed"},{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/37","repository_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/37/labels{/name}","comments_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/37/comments","events_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/37/events","html_url":"https://github.com/nigoroll/libvmod-dynamic/issues/37","id":308541202,"node_id":"MDU6SXNzdWUzMDg1NDEyMDI=","number":37,"title":"ABI mismatch against Varnish 6.0 - RPM package needs a bump?","user":{"login":"slawekm","id":4246560,"node_id":"MDQ6VXNlcjQyNDY1NjA=","avatar_url":"https://avatars.githubusercontent.com/u/4246560?v=4","gravatar_id":"","url":"https://api.github.com/users/slawekm","html_url":"https://github.com/slawekm","followers_url":"https://api.github.com/users/slawekm/followers","following_url":"https://api.github.com/users/slawekm/following{/other_user}","gists_url":"https://api.github.com/users/slawekm/gists{/gist_id}","starred_url":"https://api.github.com/users/slawekm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/slawekm/subscriptions","organizations_url":"https://api.github.com/users/slawekm/orgs","repos_url":"https://api.github.com/users/slawekm/repos","events_url":"https://api.github.com/users/slawekm/events{/privacy}","received_events_url":"https://api.github.com/users/slawekm/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"slimhazard","id":6084911,"node_id":"MDQ6VXNlcjYwODQ5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/6084911?v=4","gravatar_id":"","url":"https://api.github.com/users/slimhazard","html_url":"https://github.com/slimhazard","followers_url":"https://api.github.com/users/slimhazard/followers","following_url":"https://api.github.com/users/slimhazard/following{/other_user}","gists_url":"https://api.github.com/users/slimhazard/gists{/gist_id}","starred_url":"https://api.github.com/users/slimhazard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/slimhazard/subscriptions","organizations_url":"https://api.github.com/users/slimhazard/orgs","repos_url":"https://api.github.com/users/slimhazard/repos","events_url":"https://api.github.com/users/slimhazard/events{/privacy}","received_events_url":"https://api.github.com/users/slimhazard/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"slimhazard","id":6084911,"node_id":"MDQ6VXNlcjYwODQ5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/6084911?v=4","gravatar_id":"","url":"https://api.github.com/users/slimhazard","html_url":"https://github.com/slimhazard","followers_url":"https://api.github.com/users/slimhazard/followers","following_url":"https://api.github.com/users/slimhazard/following{/other_user}","gists_url":"https://api.github.com/users/slimhazard/gists{/gist_id}","starred_url":"https://api.github.com/users/slimhazard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/slimhazard/subscriptions","organizations_url":"https://api.github.com/users/slimhazard/orgs","repos_url":"https://api.github.com/users/slimhazard/repos","events_url":"https://api.github.com/users/slimhazard/events{/privacy}","received_events_url":"https://api.github.com/users/slimhazard/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":7,"created_at":"2018-03-26T11:55:15Z","updated_at":"2018-04-02T09:44:10Z","closed_at":"2018-04-02T09:44:10Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hi, \r\n\r\nI'm getting ABI mismatch error when running against Varnish 6.0:\r\n\r\n```\r\nbash-4.2# /usr/sbin/varnish_reload_vcl\r\nLoading vcl from /etc/varnish/default.vcl\r\nCurrent running config name is boot\r\nUsing new config name reload_2018-03-26T114607\r\nMessage from VCC-compiler:\r\nIncompatible VMOD dynamic\r\n\tFile name: /usr/lib64/varnish/vmods/libvmod_dynamic.so\r\n\tABI mismatch, expected <Varnish 6.0.0 a068361dff0d25a0d85cf82a6e5fdaf315e06a7d>, got <Varnish 5.2.1 67e562482>\r\n('/etc/varnish/default.vcl' Line 60 Pos 8)\r\nimport dynamic;\r\n-------#######-\r\n\r\nRunning VCC-compiler failed, exited with 2\r\nVCL compilation failed\r\nCommand failed with error code 106\r\n```\r\n\r\n```\r\nbash-4.2# rpm -qi vmod-dynamic\r\nName        : vmod-dynamic\r\nVersion     : 0.3\r\nRelease     : 12.el7\r\nSource RPM  : vmod-dynamic-0.3-12.el7.src.rpm\r\nBuild Date  : Fri Nov 24 17:17:58 2017\r\nBuild Host  : 5f3d6e6b911d\r\n```\r\n\r\nWorks fine when I've compiled vmod from source.\r\n\r\nThanks.","closed_by":{"login":"slimhazard","id":6084911,"node_id":"MDQ6VXNlcjYwODQ5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/6084911?v=4","gravatar_id":"","url":"https://api.github.com/users/slimhazard","html_url":"https://github.com/slimhazard","followers_url":"https://api.github.com/users/slimhazard/followers","following_url":"https://api.github.com/users/slimhazard/following{/other_user}","gists_url":"https://api.github.com/users/slimhazard/gists{/gist_id}","starred_url":"https://api.github.com/users/slimhazard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/slimhazard/subscriptions","organizations_url":"https://api.github.com/users/slimhazard/orgs","repos_url":"https://api.github.com/users/slimhazard/repos","events_url":"https://api.github.com/users/slimhazard/events{/privacy}","received_events_url":"https://api.github.com/users/slimhazard/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/37/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/37/timeline","performed_via_github_app":null,"state_reason":"completed"},{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/38","repository_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/38/labels{/name}","comments_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/38/comments","events_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/38/events","html_url":"https://github.com/nigoroll/libvmod-dynamic/issues/38","id":358483593,"node_id":"MDU6SXNzdWUzNTg0ODM1OTM=","number":38,"title":"502 when cache beresp.ttl is exhausted  ","user":{"login":"lloiacono","id":1889160,"node_id":"MDQ6VXNlcjE4ODkxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1889160?v=4","gravatar_id":"","url":"https://api.github.com/users/lloiacono","html_url":"https://github.com/lloiacono","followers_url":"https://api.github.com/users/lloiacono/followers","following_url":"https://api.github.com/users/lloiacono/following{/other_user}","gists_url":"https://api.github.com/users/lloiacono/gists{/gist_id}","starred_url":"https://api.github.com/users/lloiacono/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lloiacono/subscriptions","organizations_url":"https://api.github.com/users/lloiacono/orgs","repos_url":"https://api.github.com/users/lloiacono/repos","events_url":"https://api.github.com/users/lloiacono/events{/privacy}","received_events_url":"https://api.github.com/users/lloiacono/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2018-09-10T06:23:57Z","updated_at":"2018-10-11T06:48:08Z","closed_at":"2018-09-12T15:11:44Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I'm using dynamic directors with rancher and am getting a 502 error once the TTL of my cache object expires, if I try again then it works properly. I can request any URL and I would get a 200, then the page is cache for 5s (I set the TTL to 5s for testing), then after 5s I request the same URL again and I get the 502, then I request the same URL once again and it works. If I repeat the whole process I get the same results over and over.\r\n\r\nError:\r\n> HTTP/1.0 502 Bad Gateway\r\nCache-Control: no-cache\r\nContent-Type: text/html\r\nX-Via: varnish-test\r\n\r\n<html><body><h1>502 Bad Gateway</h1>\r\nThe server returned an invalid or incomplete response.\r\n</body></html>\r\n\r\nConfiguration: \r\n\r\nI have setup varnish with dynamic directors like this:\r\n\r\n```\r\nsub vcl_init {\r\n  new www_dir = dynamic.director(\r\n    port = 80,\r\n    ttl = 5m\r\n  );\r\n  www_dir.debug(true);\r\n}\r\n```\r\n\r\nAnd added the director as backend in `vcl_recv` like this:\r\n\r\n`set req.backend_hint = www_dir.backend(app);`\r\n\r\n`app` is the name of my backend service in rancher. If I dig to `app` I get something like:\r\n\r\n```\r\napp.                    1       IN      A       10.42.166.171\r\napp.                    1       IN      A       10.42.215.78\r\n```\r\n\r\nAlso in `vcl_backend_response` I've this:\r\n\r\n`set beresp.ttl = 5s;`\r\n\r\nI set the cache TTL to 5s to debug this easily.\r\n\r\nOn the varnish instance if I run this `varnishlog -g raw -q '* ~ vmod-dynamic'`, after the 502 error I see this in the logs:\r\n\r\n`Log abandoned (vsl)`\r\n`Log reacquired`\r\n\r\n\r\n\r\n","closed_by":{"login":"nigoroll","id":1528104,"node_id":"MDQ6VXNlcjE1MjgxMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1528104?v=4","gravatar_id":"","url":"https://api.github.com/users/nigoroll","html_url":"https://github.com/nigoroll","followers_url":"https://api.github.com/users/nigoroll/followers","following_url":"https://api.github.com/users/nigoroll/following{/other_user}","gists_url":"https://api.github.com/users/nigoroll/gists{/gist_id}","starred_url":"https://api.github.com/users/nigoroll/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nigoroll/subscriptions","organizations_url":"https://api.github.com/users/nigoroll/orgs","repos_url":"https://api.github.com/users/nigoroll/repos","events_url":"https://api.github.com/users/nigoroll/events{/privacy}","received_events_url":"https://api.github.com/users/nigoroll/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/38/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/38/timeline","performed_via_github_app":null,"state_reason":"completed"},{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/39","repository_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/39/labels{/name}","comments_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/39/comments","events_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/39/events","html_url":"https://github.com/nigoroll/libvmod-dynamic/issues/39","id":358557823,"node_id":"MDU6SXNzdWUzNTg1NTc4MjM=","number":39,"title":"Not able to build master","user":{"login":"lloiacono","id":1889160,"node_id":"MDQ6VXNlcjE4ODkxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1889160?v=4","gravatar_id":"","url":"https://api.github.com/users/lloiacono","html_url":"https://github.com/lloiacono","followers_url":"https://api.github.com/users/lloiacono/followers","following_url":"https://api.github.com/users/lloiacono/following{/other_user}","gists_url":"https://api.github.com/users/lloiacono/gists{/gist_id}","starred_url":"https://api.github.com/users/lloiacono/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lloiacono/subscriptions","organizations_url":"https://api.github.com/users/lloiacono/orgs","repos_url":"https://api.github.com/users/lloiacono/repos","events_url":"https://api.github.com/users/lloiacono/events{/privacy}","received_events_url":"https://api.github.com/users/lloiacono/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2018-09-10T10:16:16Z","updated_at":"2018-09-10T10:24:48Z","closed_at":"2018-09-10T10:24:48Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I was previously using the v 0.4 tag and it was working fine. Now switched to master and I get the following error:\r\n\r\n```\r\nMaking install in src\r\nmake[1]: Entering directory '/varnish-modules/libvmod-dynamic-master/src'\r\nCC       vmod_dynamic.lo\r\nvmod_dynamic.c:105:33: error: array type has incomplete element type 'struct vdi_methods'\r\n static const struct vdi_methods vmod_dynamic_methods[1] = {{\r\n                                 ^~~~~~~~~~~~~~~~~~~~\r\nvmod_dynamic.c:106:2: error: field name not in record or union initializer\r\n  .magic = VDI_METHODS_MAGIC,\r\n  ^\r\nvmod_dynamic.c:106:2: note: (near initialization for 'vmod_dynamic_methods')\r\nvmod_dynamic.c:106:11: error: 'VDI_METHODS_MAGIC' undeclared here (not in a function)\r\n  .magic = VDI_METHODS_MAGIC,\r\n           ^~~~~~~~~~~~~~~~~\r\nvmod_dynamic.c:107:2: error: field name not in record or union initializer\r\n  .type =  \"dynamic\",\r\n  ^\r\nvmod_dynamic.c:107:2: note: (near initialization for 'vmod_dynamic_methods')\r\nvmod_dynamic.c:108:2: error: field name not in record or union initializer\r\n  .healthy = dynamic_healthy,\r\n  ^\r\nvmod_dynamic.c:108:2: note: (near initialization for 'vmod_dynamic_methods')\r\nvmod_dynamic.c:109:2: error: field name not in record or union initializer\r\n  .resolve = dynamic_resolve\r\n  ^\r\nvmod_dynamic.c:109:2: note: (near initialization for 'vmod_dynamic_methods')\r\nvmod_dynamic.c: In function 'dynamic_resolve':\r\nvmod_dynamic.c:151:5: error: too many arguments to function 'VRT_Healthy'\r\n    !VRT_Healthy(ctx, next->be->dir, NULL));\r\n     ^~~~~~~~~~~\r\nIn file included from /usr/include/varnish/cache/cache.h:45:0,\r\n                 from vmod_dynamic.c:45:\r\n/usr/include/varnish/vrt.h:419:5: note: declared here\r\n int VRT_Healthy(VRT_CTX, VCL_BACKEND);\r\n     ^~~~~~~~~~~\r\nvmod_dynamic.c:156:7: error: too many arguments to function 'VRT_Healthy'\r\n      !VRT_Healthy(ctx, next->be->dir, NULL))\r\n       ^~~~~~~~~~~\r\nIn file included from /usr/include/varnish/cache/cache.h:45:0,\r\n                 from vmod_dynamic.c:45:\r\n/usr/include/varnish/vrt.h:419:5: note: declared here\r\n int VRT_Healthy(VRT_CTX, VCL_BACKEND);\r\n     ^~~~~~~~~~~\r\nvmod_dynamic.c: In function 'dynamic_healthy':\r\nvmod_dynamic.c:184:12: error: too many arguments to function 'VRT_Healthy'\r\n   retval = VRT_Healthy(ctx, r->be->dir, &c);\r\n            ^~~~~~~~~~~\r\nIn file included from /usr/include/varnish/cache/cache.h:45:0,\r\n                 from vmod_dynamic.c:45:\r\n/usr/include/varnish/vrt.h:419:5: note: declared here\r\n int VRT_Healthy(VRT_CTX, VCL_BACKEND);\r\n     ^~~~~~~~~~~\r\nvmod_dynamic.c: In function 'dynamic_del':\r\nvmod_dynamic.c:248:27: error: passing argument 2 of 'VRT_delete_backend' from incompatible pointer type [-Werror=incompatible-pointer-types]\r\n   VRT_delete_backend(ctx, &b->dir);\r\n                           ^\r\nIn file included from /usr/include/varnish/cache/cache.h:45:0,\r\n                 from vmod_dynamic.c:45:\r\n/usr/include/varnish/vrt.h:411:6: note: expected 'struct director **' but argument is of type 'const struct director **'\r\n void VRT_delete_backend(VRT_CTX, struct director **);\r\n      ^~~~~~~~~~~~~~~~~~\r\nvmod_dynamic.c: In function 'dynamic_get':\r\nvmod_dynamic.c:708:13: error: implicit declaration of function 'VRT_AddDirector' [-Werror=implicit-function-declaration]\r\n  dom->dir = VRT_AddDirector(ctx, vmod_dynamic_methods, dom,\r\n             ^~~~~~~~~~~~~~~\r\nAt top level:\r\nvmod_dynamic.c:105:33: error: 'vmod_dynamic_methods' defined but not used [-Werror=unused-variable]\r\n static const struct vdi_methods vmod_dynamic_methods[1] = {{\r\n                                 ^~~~~~~~~~~~~~~~~~~~\r\n```\r\n\r\nMy Dockerfile is \r\n\r\n```\r\nFROM alpine:3.8\r\n\r\nRUN apk update \\\r\n    && apk add --no-cache varnish=6.0.0-r1 \\\r\n    && apk add git curl \\\r\n    && git clone https://github.com/varnish/varnish-modules.git \\\r\n    && apk add automake && apk add varnish-dev \\\r\n    && apk add autoconf && apk add libtool \\\r\n    && apk add py-docutils && apk add make \\\r\n    && cd varnish-modules/ \\\r\n    && ./bootstrap && ./configure && make && make install\r\n\r\n#\r\n# install libvmod-dynamic\r\n#\r\nENV LIBVMOD_DYNAMIC_VERSION=master\r\n\r\nRUN curl -sfL https://github.com/nigoroll/libvmod-dynamic/archive/${LIBVMOD_DYNAMIC_VERSION}.tar.gz \\\r\n        -o libvmod-dynamic-${LIBVMOD_DYNAMIC_VERSION}.tar.gz  && \\\r\n    tar -xzf libvmod-dynamic-${LIBVMOD_DYNAMIC_VERSION}.tar.gz && \\\r\n    cd libvmod-dynamic-${LIBVMOD_DYNAMIC_VERSION} && \\\r\n    ./autogen.sh && \\\r\n    ./configure && \\\r\n    make install && \\\r\n    cd .. &&  rm -rf libvmod-dynamic-${LIBVMOD_DYNAMIC_VERSION}.tar.gz \r\n\r\n```","closed_by":{"login":"nigoroll","id":1528104,"node_id":"MDQ6VXNlcjE1MjgxMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1528104?v=4","gravatar_id":"","url":"https://api.github.com/users/nigoroll","html_url":"https://github.com/nigoroll","followers_url":"https://api.github.com/users/nigoroll/followers","following_url":"https://api.github.com/users/nigoroll/following{/other_user}","gists_url":"https://api.github.com/users/nigoroll/gists{/gist_id}","starred_url":"https://api.github.com/users/nigoroll/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nigoroll/subscriptions","organizations_url":"https://api.github.com/users/nigoroll/orgs","repos_url":"https://api.github.com/users/nigoroll/repos","events_url":"https://api.github.com/users/nigoroll/events{/privacy}","received_events_url":"https://api.github.com/users/nigoroll/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/39/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/39/timeline","performed_via_github_app":null,"state_reason":"completed"},{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/40","repository_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/40/labels{/name}","comments_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/40/comments","events_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/40/events","html_url":"https://github.com/nigoroll/libvmod-dynamic/issues/40","id":367386874,"node_id":"MDU6SXNzdWUzNjczODY4NzQ=","number":40,"title":"Unable to compile on Debian Stretch","user":{"login":"AdrienBigot","id":12624309,"node_id":"MDQ6VXNlcjEyNjI0MzA5","avatar_url":"https://avatars.githubusercontent.com/u/12624309?v=4","gravatar_id":"","url":"https://api.github.com/users/AdrienBigot","html_url":"https://github.com/AdrienBigot","followers_url":"https://api.github.com/users/AdrienBigot/followers","following_url":"https://api.github.com/users/AdrienBigot/following{/other_user}","gists_url":"https://api.github.com/users/AdrienBigot/gists{/gist_id}","starred_url":"https://api.github.com/users/AdrienBigot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AdrienBigot/subscriptions","organizations_url":"https://api.github.com/users/AdrienBigot/orgs","repos_url":"https://api.github.com/users/AdrienBigot/repos","events_url":"https://api.github.com/users/AdrienBigot/events{/privacy}","received_events_url":"https://api.github.com/users/AdrienBigot/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":443804423,"node_id":"MDU6TGFiZWw0NDM4MDQ0MjM=","url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/labels/duplicate","name":"duplicate","color":"cccccc","default":true,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2018-10-05T22:23:36Z","updated_at":"2018-10-10T05:21:28Z","closed_at":"2018-10-10T05:21:21Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hello,\r\n\r\nWhen trying to build in Debian Strech I encounter these errors :\r\n\r\nmake  all-recursive\r\nmake[1]: Entering directory '/tmp/libvmod-dynamic'\r\nMaking all in src\r\nmake[2]: Entering directory '/tmp/libvmod-dynamic/src'\r\n  CC       vmod_dynamic.lo\r\nvmod_dynamic.c:105:33: error: array type has incomplete element type struct vdi_methods\r\n static const struct vdi_methods vmod_dynamic_methods[1] = {{\r\n                                 ^~~~~~~~~~~~~~~~~~~~\r\nvmod_dynamic.c:106:2: error: field name not in record or union initializer\r\n  .magic = VDI_METHODS_MAGIC,\r\n  ^\r\nvmod_dynamic.c:106:2: note: (near initialization for vmod_dynamic_methods)\r\nvmod_dynamic.c:106:11: error: VDI_METHODS_MAGIC undeclared here (not in a function)\r\n  .magic = VDI_METHODS_MAGIC,\r\n           ^~~~~~~~~~~~~~~~~\r\nvmod_dynamic.c:107:2: error: field name not in record or union initializer\r\n  .type =  \"dynamic\",\r\n  ^\r\nvmod_dynamic.c:107:2: note: (near initialization for vmod_dynamic_methods)\r\nvmod_dynamic.c:108:2: error: field name not in record or union initializer\r\n  .healthy = dynamic_healthy,\r\n  ^\r\nvmod_dynamic.c:108:2: note: (near initialization for vmod_dynamic_methods)\r\nvmod_dynamic.c:109:2: error: field name not in record or union initializer\r\n  .resolve = dynamic_resolve\r\n  ^\r\nvmod_dynamic.c:109:2: note: (near initialization for vmod_dynamic_methods)\r\nvmod_dynamic.c: In function dynamic_resolve:\r\nvmod_dynamic.c:151:5: error: too many arguments to function VRT_Healthy\r\n    !VRT_Healthy(ctx, next->be->dir, NULL));\r\n     ^~~~~~~~~~~\r\nIn file included from /usr/include/varnish/cache/cache.h:45:0,\r\n                 from vmod_dynamic.c:45:\r\n/usr/include/varnish/vrt.h:420:5: note: declared here\r\n int VRT_Healthy(VRT_CTX, VCL_BACKEND);\r\n     ^~~~~~~~~~~\r\nvmod_dynamic.c:156:7: error: too many arguments to function VRT_Healthy\r\n      !VRT_Healthy(ctx, next->be->dir, NULL))\r\n       ^~~~~~~~~~~\r\nIn file included from /usr/include/varnish/cache/cache.h:45:0,\r\n                 from vmod_dynamic.c:45:\r\n/usr/include/varnish/vrt.h:420:5: note: declared here\r\n int VRT_Healthy(VRT_CTX, VCL_BACKEND);\r\n     ^~~~~~~~~~~\r\nvmod_dynamic.c: In function dynamic_healthy:\r\nvmod_dynamic.c:184:12: error: too many arguments to function VRT_Healthy\r\n   retval = VRT_Healthy(ctx, r->be->dir, &c);\r\n            ^~~~~~~~~~~\r\nIn file included from /usr/include/varnish/cache/cache.h:45:0,\r\n                 from vmod_dynamic.c:45:\r\n/usr/include/varnish/vrt.h:420:5: note: declared here\r\n int VRT_Healthy(VRT_CTX, VCL_BACKEND);\r\n     ^~~~~~~~~~~\r\nvmod_dynamic.c: In function dynamic_del:\r\nvmod_dynamic.c:248:27: error: passing argument 2 of VRT_delete_backend from incompatible pointer type [-Werror=incompatible-pointer-types]\r\n   VRT_delete_backend(ctx, &b->dir);\r\n                           ^\r\nIn file included from /usr/include/varnish/cache/cache.h:45:0,\r\n                 from vmod_dynamic.c:45:\r\n/usr/include/varnish/vrt.h:412:6: note: expected struct director ** but argument is of type const struct director **\r\n void VRT_delete_backend(VRT_CTX, struct director **);\r\n      ^~~~~~~~~~~~~~~~~~\r\nvmod_dynamic.c: In function dynamic_free:\r\nvmod_dynamic.c:546:2: error: implicit declaration of function VRT_DelDirector [-Werror=implicit-function-declaration]\r\n  VRT_DelDirector(&dom->dir);\r\n  ^~~~~~~~~~~~~~~\r\nvmod_dynamic.c: In function dynamic_get:\r\nvmod_dynamic.c:710:13: error: implicit declaration of function VRT_AddDirector [-Werror=implicit-function-declaration]\r\n  dom->dir = VRT_AddDirector(ctx, vmod_dynamic_methods, dom,\r\n             ^~~~~~~~~~~~~~~\r\nAt top level:\r\nvmod_dynamic.c:105:33: error: vmod_dynamic_methods defined but not used [-Werror=unused-variable]\r\n static const struct vdi_methods vmod_dynamic_methods[1] = {{\r\n                                 ^~~~~~~~~~~~~~~~~~~~\r\ncc1: all warnings being treated as errors\r\nMakefile:659: recipe for target 'vmod_dynamic.lo' failed\r\nmake[2]: *** [vmod_dynamic.lo] Error 1\r\nmake[2]: Leaving directory '/tmp/libvmod-dynamic/src'\r\nMakefile:492: recipe for target 'all-recursive' failed\r\nmake[1]: *** [all-recursive] Error 1\r\nmake[1]: Leaving directory '/tmp/libvmod-dynamic'\r\nMakefile:403: recipe for target 'all' failed\r\nmake: *** [all] Error 2\r\n\r\nThanks in advance.\r\n\r\nAdrien","closed_by":{"login":"nigoroll","id":1528104,"node_id":"MDQ6VXNlcjE1MjgxMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1528104?v=4","gravatar_id":"","url":"https://api.github.com/users/nigoroll","html_url":"https://github.com/nigoroll","followers_url":"https://api.github.com/users/nigoroll/followers","following_url":"https://api.github.com/users/nigoroll/following{/other_user}","gists_url":"https://api.github.com/users/nigoroll/gists{/gist_id}","starred_url":"https://api.github.com/users/nigoroll/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nigoroll/subscriptions","organizations_url":"https://api.github.com/users/nigoroll/orgs","repos_url":"https://api.github.com/users/nigoroll/repos","events_url":"https://api.github.com/users/nigoroll/events{/privacy}","received_events_url":"https://api.github.com/users/nigoroll/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/40/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/40/timeline","performed_via_github_app":null,"state_reason":"completed"},{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/41","repository_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/41/labels{/name}","comments_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/41/comments","events_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/41/events","html_url":"https://github.com/nigoroll/libvmod-dynamic/issues/41","id":368464148,"node_id":"MDU6SXNzdWUzNjg0NjQxNDg=","number":41,"title":"Can't install on Centos7 Varnish 6.0.1","user":{"login":"chuyenim","id":12079343,"node_id":"MDQ6VXNlcjEyMDc5MzQz","avatar_url":"https://avatars.githubusercontent.com/u/12079343?v=4","gravatar_id":"","url":"https://api.github.com/users/chuyenim","html_url":"https://github.com/chuyenim","followers_url":"https://api.github.com/users/chuyenim/followers","following_url":"https://api.github.com/users/chuyenim/following{/other_user}","gists_url":"https://api.github.com/users/chuyenim/gists{/gist_id}","starred_url":"https://api.github.com/users/chuyenim/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chuyenim/subscriptions","organizations_url":"https://api.github.com/users/chuyenim/orgs","repos_url":"https://api.github.com/users/chuyenim/repos","events_url":"https://api.github.com/users/chuyenim/events{/privacy}","received_events_url":"https://api.github.com/users/chuyenim/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":443804423,"node_id":"MDU6TGFiZWw0NDM4MDQ0MjM=","url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/labels/duplicate","name":"duplicate","color":"cccccc","default":true,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2018-10-10T02:00:20Z","updated_at":"2018-10-10T05:20:35Z","closed_at":"2018-10-10T05:19:20Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hello,\r\nI want to use this vmod on my system but when I install I got tons of errors messages:\r\nMy steps:\r\n-- Download libvmod-dynamic into directory ``/var/lib/varnish/vmods/``\r\n-- Unzip file\r\n-- ``./autogent.sh``  --> OK\r\n-- ``./configure``  --> OK\r\n-- ``make`` --> Errrors:\r\n\r\n    [root@vultr libvmod-dynamic-master]# make\r\n    make  all-recursive\r\n    make[1]: Entering directory `/var/lib/varnish/vmods/libvmod-dynamic-master'\r\n    Making all in src\r\n    make[2]: Entering directory `/var/lib/varnish/vmods/libvmod-dynamic-master/src'\r\n      CC       vmod_dynamic.lo\r\n    vmod_dynamic.c:105:33: error: array type has incomplete element type\r\n     static const struct vdi_methods vmod_dynamic_methods[1] = {{\r\n                                     ^\r\n    vmod_dynamic.c:106:2: error: field name not in record or union initializer\r\n      .magic = VDI_METHODS_MAGIC,\r\n      ^\r\n    vmod_dynamic.c:106:2: error: (near initialization for vmod_dynamic_methods)\r\n    vmod_dynamic.c:106:11: error: VDI_METHODS_MAGIC undeclared here (not in a function)\r\n      .magic = VDI_METHODS_MAGIC,\r\n               ^\r\n    vmod_dynamic.c:107:2: error: field name not in record or union initializer\r\n      .type =  \"dynamic\",\r\n      ^\r\n    vmod_dynamic.c:107:2: error: (near initialization for vmod_dynamic_methods)\r\n    vmod_dynamic.c:108:2: error: field name not in record or union initializer\r\n      .healthy = dynamic_healthy,\r\n      ^\r\n    vmod_dynamic.c:108:2: error: (near initialization for vmod_dynamic_methods)\r\n    vmod_dynamic.c:109:2: error: field name not in record or union initializer\r\n      .resolve = dynamic_resolve\r\n      ^\r\n    vmod_dynamic.c:109:2: error: (near initialization for vmod_dynamic_methods)\r\n    vmod_dynamic.c: In function dynamic_resolve:\r\n    vmod_dynamic.c:151:4: error: too many arguments to function VRT_Healthy\r\n        !VRT_Healthy(ctx, next->be->dir, NULL));\r\n        ^\r\n    In file included from /usr/include/varnish/cache/cache.h:45:0,\r\n                     from vmod_dynamic.c:45:\r\n    /usr/include/varnish/vrt.h:420:5: note: declared here\r\n     int VRT_Healthy(VRT_CTX, VCL_BACKEND);\r\n         ^\r\n    vmod_dynamic.c:156:6: error: too many arguments to function VRT_Healthy\r\n          !VRT_Healthy(ctx, next->be->dir, NULL))\r\n          ^\r\n    In file included from /usr/include/varnish/cache/cache.h:45:0,\r\n                     from vmod_dynamic.c:45:\r\n    /usr/include/varnish/vrt.h:420:5: note: declared here\r\n     int VRT_Healthy(VRT_CTX, VCL_BACKEND);\r\n         ^\r\n    vmod_dynamic.c: In function dynamic_healthy:\r\n    vmod_dynamic.c:184:3: error: too many arguments to function VRT_Healthy\r\n       retval = VRT_Healthy(ctx, r->be->dir, &c);\r\n       ^\r\n    In file included from /usr/include/varnish/cache/cache.h:45:0,\r\n                     from vmod_dynamic.c:45:\r\n    /usr/include/varnish/vrt.h:420:5: note: declared here\r\n     int VRT_Healthy(VRT_CTX, VCL_BACKEND);\r\n         ^\r\n    vmod_dynamic.c: In function dynamic_del:\r\n    vmod_dynamic.c:248:3: error: passing argument 2 of VRT_delete_backend from incompatible pointer type [-Werror]\r\n       VRT_delete_backend(ctx, &b->dir);\r\n       ^\r\n    In file included from /usr/include/varnish/cache/cache.h:45:0,\r\n                     from vmod_dynamic.c:45:\r\n    /usr/include/varnish/vrt.h:412:6: note: expected struct director ** but argument is of type const struct director **\r\n     void VRT_delete_backend(VRT_CTX, struct director **);\r\n          ^\r\n    vmod_dynamic.c: In function dynamic_free:\r\n    vmod_dynamic.c:546:2: error: implicit declaration of function VRT_DelDirector [-Werror=implicit-function-declaration]\r\n      VRT_DelDirector(&dom->dir);\r\n      ^\r\n    vmod_dynamic.c: In function dynamic_get:\r\n    vmod_dynamic.c:710:2: error: implicit declaration of function VRT_AddDirector [-Werror=implicit-function-declaration]\r\n      dom->dir = VRT_AddDirector(ctx, vmod_dynamic_methods, dom,\r\n      ^\r\n    vmod_dynamic.c: At top level:\r\n    vmod_dynamic.c:105:33: error: vmod_dynamic_methods defined but not used [-Werror=unused-variable]\r\n     static const struct vdi_methods vmod_dynamic_methods[1] = {{\r\n                                     ^\r\n    cc1: all warnings being treated as errors\r\n    make[2]: *** [vmod_dynamic.lo] Error 1\r\n    make[2]: Leaving directory `/var/lib/varnish/vmods/libvmod-dynamic-master/src'\r\n    make[1]: *** [all-recursive] Error 1\r\n    make[1]: Leaving directory `/var/lib/varnish/vmods/libvmod-dynamic-master'\r\n    make: *** [all] Error 2\r\n\r\nSoftware: Varnish 6.0.1\r\nEnvironment: Centos 7\r\n\r\nPlease give me the helps or some suggestions. Thank you","closed_by":{"login":"nigoroll","id":1528104,"node_id":"MDQ6VXNlcjE1MjgxMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1528104?v=4","gravatar_id":"","url":"https://api.github.com/users/nigoroll","html_url":"https://github.com/nigoroll","followers_url":"https://api.github.com/users/nigoroll/followers","following_url":"https://api.github.com/users/nigoroll/following{/other_user}","gists_url":"https://api.github.com/users/nigoroll/gists{/gist_id}","starred_url":"https://api.github.com/users/nigoroll/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nigoroll/subscriptions","organizations_url":"https://api.github.com/users/nigoroll/orgs","repos_url":"https://api.github.com/users/nigoroll/repos","events_url":"https://api.github.com/users/nigoroll/events{/privacy}","received_events_url":"https://api.github.com/users/nigoroll/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/41/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/41/timeline","performed_via_github_app":null,"state_reason":"completed"},{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/42","repository_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/42/labels{/name}","comments_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/42/comments","events_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/42/events","html_url":"https://github.com/nigoroll/libvmod-dynamic/issues/42","id":388773285,"node_id":"MDU6SXNzdWUzODg3NzMyODU=","number":42,"title":"Feature request: SRV support for port finding","user":{"login":"danielmotaleite","id":11890049,"node_id":"MDQ6VXNlcjExODkwMDQ5","avatar_url":"https://avatars.githubusercontent.com/u/11890049?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmotaleite","html_url":"https://github.com/danielmotaleite","followers_url":"https://api.github.com/users/danielmotaleite/followers","following_url":"https://api.github.com/users/danielmotaleite/following{/other_user}","gists_url":"https://api.github.com/users/danielmotaleite/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmotaleite/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmotaleite/subscriptions","organizations_url":"https://api.github.com/users/danielmotaleite/orgs","repos_url":"https://api.github.com/users/danielmotaleite/repos","events_url":"https://api.github.com/users/danielmotaleite/events{/privacy}","received_events_url":"https://api.github.com/users/danielmotaleite/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2018-12-07T18:54:05Z","updated_at":"2019-07-13T16:39:47Z","closed_at":"2019-07-13T16:39:47Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Right now we can find the backend via DNS, but the port is required to be the same for all the backends.\r\n\r\nWith docker, we start to get more and more backends with dynamic ports and to keep using static ports we need some \"load-balancers\". It would be great if we could remove those and allow varnish to find the backends AND ports using DNS SRV entries. \r\nSRV DNS entries give us not only the host/IP for the service, but also the correct port for it.\r\nConsul service discovery do this automatically and gives great flexibility to deploy and manage services\r\n\r\nExample:\r\n$ host -t SRV consul.service.consul.internal.\r\nconsul.service.consul.internal has SRV record 1 2 8300 consul-a01.node.interxion-fra6.consul.internal.\r\nconsul.service.consul.internal has SRV record 1 3 8301 consul-b01.node.interxion-fra6.consul.internal.\r\nconsul.service.consul.internal has SRV record 2 1 8302 consul-a02.node.interxion-fra6.consul.internal.\r\n\r\n\r\nA varnish backend \"consul\" would setup 3 backends for each DNS:PORT\r\n\r\nBonus:\r\nSRV could also later use the priority (1, 1, 2 above)  and then weight value (2,3 for priority 1 group, 1 for priority 2 group) to balance the load between nodes \r\n\r\nyes, i know that SRV is not as simple as simple A/CNAME DNS, but they are way more flexible and in a long run they can help a lot","closed_by":{"login":"nigoroll","id":1528104,"node_id":"MDQ6VXNlcjE1MjgxMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1528104?v=4","gravatar_id":"","url":"https://api.github.com/users/nigoroll","html_url":"https://github.com/nigoroll","followers_url":"https://api.github.com/users/nigoroll/followers","following_url":"https://api.github.com/users/nigoroll/following{/other_user}","gists_url":"https://api.github.com/users/nigoroll/gists{/gist_id}","starred_url":"https://api.github.com/users/nigoroll/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nigoroll/subscriptions","organizations_url":"https://api.github.com/users/nigoroll/orgs","repos_url":"https://api.github.com/users/nigoroll/repos","events_url":"https://api.github.com/users/nigoroll/events{/privacy}","received_events_url":"https://api.github.com/users/nigoroll/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/42/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/42/timeline","performed_via_github_app":null,"state_reason":"completed"},{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/43","repository_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/43/labels{/name}","comments_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/43/comments","events_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/43/events","html_url":"https://github.com/nigoroll/libvmod-dynamic/issues/43","id":388822767,"node_id":"MDU6SXNzdWUzODg4MjI3Njc=","number":43,"title":"Usage clarification","user":{"login":"absolutejam","id":6817942,"node_id":"MDQ6VXNlcjY4MTc5NDI=","avatar_url":"https://avatars.githubusercontent.com/u/6817942?v=4","gravatar_id":"","url":"https://api.github.com/users/absolutejam","html_url":"https://github.com/absolutejam","followers_url":"https://api.github.com/users/absolutejam/followers","following_url":"https://api.github.com/users/absolutejam/following{/other_user}","gists_url":"https://api.github.com/users/absolutejam/gists{/gist_id}","starred_url":"https://api.github.com/users/absolutejam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/absolutejam/subscriptions","organizations_url":"https://api.github.com/users/absolutejam/orgs","repos_url":"https://api.github.com/users/absolutejam/repos","events_url":"https://api.github.com/users/absolutejam/events{/privacy}","received_events_url":"https://api.github.com/users/absolutejam/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":443804427,"node_id":"MDU6TGFiZWw0NDM4MDQ0Mjc=","url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/labels/question","name":"question","color":"cc317c","default":true,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2018-12-07T21:36:53Z","updated_at":"2018-12-10T13:54:13Z","closed_at":"2018-12-10T13:07:49Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hey!\r\n\r\nFirst of all, I want to apologise for posting this as I think it may be a bit outside the realm of what you expect in an issue, but I was hoping you could help clarify usage of the this director. Secondly, thanks for providing this, as all of my searches for similar functionality have been dead ends (Varnish 3, varnish-plus). I'm pretty new to Varnish as a whole, and looking to use it in a dynamic Kubernetes environment.\r\n\r\nBasically, I'm just trying to understand at what I need to facilitate the usage of this director and the limitations. As an overview, my current setup that I'm toying with is a layer of Varnish servers using the shard director to load-balance caching, and a backend 'content' layer (Nginx) for the actual content to be cached.\r\n\r\nFrom my understanding of the man page..\r\n  - I set up the director in `sub vcl_init`\r\n  - Then in `sub vcl_recv` I basically add any kind of routing logic (eg. based on `req.http.host`) *nothing out of the ordinary so far*\r\n  - And then ultimately define `set req.backend_hint = content.backend(\"mybackend\");` which declares my (dns)resolved backend.\r\n\r\nDoes this mean that I cannot now leverage a load-balanced director (as the dynamic director must resolve a hostname), and in turn must use another load-balancing service for my content nodes (ideally. with a hostname that can be resolved by this director). This obviously contrasts from the current setup of my director declaring all 4 or so backends and load-balancing, vs. the dynamic director only being able to target a single, unless there's something like DNS RR in place, which would mean another service for my setup.\r\n\r\nThanks for your time!","closed_by":{"login":"nigoroll","id":1528104,"node_id":"MDQ6VXNlcjE1MjgxMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1528104?v=4","gravatar_id":"","url":"https://api.github.com/users/nigoroll","html_url":"https://github.com/nigoroll","followers_url":"https://api.github.com/users/nigoroll/followers","following_url":"https://api.github.com/users/nigoroll/following{/other_user}","gists_url":"https://api.github.com/users/nigoroll/gists{/gist_id}","starred_url":"https://api.github.com/users/nigoroll/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nigoroll/subscriptions","organizations_url":"https://api.github.com/users/nigoroll/orgs","repos_url":"https://api.github.com/users/nigoroll/repos","events_url":"https://api.github.com/users/nigoroll/events{/privacy}","received_events_url":"https://api.github.com/users/nigoroll/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/43/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/43/timeline","performed_via_github_app":null,"state_reason":"completed"},{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/44","repository_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/44/labels{/name}","comments_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/44/comments","events_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/44/events","html_url":"https://github.com/nigoroll/libvmod-dynamic/issues/44","id":395324483,"node_id":"MDU6SXNzdWUzOTUzMjQ0ODM=","number":44,"title":"Tests failing on Varnish 6.0.2","user":{"login":"philipseidel","id":2425213,"node_id":"MDQ6VXNlcjI0MjUyMTM=","avatar_url":"https://avatars.githubusercontent.com/u/2425213?v=4","gravatar_id":"","url":"https://api.github.com/users/philipseidel","html_url":"https://github.com/philipseidel","followers_url":"https://api.github.com/users/philipseidel/followers","following_url":"https://api.github.com/users/philipseidel/following{/other_user}","gists_url":"https://api.github.com/users/philipseidel/gists{/gist_id}","starred_url":"https://api.github.com/users/philipseidel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/philipseidel/subscriptions","organizations_url":"https://api.github.com/users/philipseidel/orgs","repos_url":"https://api.github.com/users/philipseidel/repos","events_url":"https://api.github.com/users/philipseidel/events{/privacy}","received_events_url":"https://api.github.com/users/philipseidel/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"slimhazard","id":6084911,"node_id":"MDQ6VXNlcjYwODQ5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/6084911?v=4","gravatar_id":"","url":"https://api.github.com/users/slimhazard","html_url":"https://github.com/slimhazard","followers_url":"https://api.github.com/users/slimhazard/followers","following_url":"https://api.github.com/users/slimhazard/following{/other_user}","gists_url":"https://api.github.com/users/slimhazard/gists{/gist_id}","starred_url":"https://api.github.com/users/slimhazard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/slimhazard/subscriptions","organizations_url":"https://api.github.com/users/slimhazard/orgs","repos_url":"https://api.github.com/users/slimhazard/repos","events_url":"https://api.github.com/users/slimhazard/events{/privacy}","received_events_url":"https://api.github.com/users/slimhazard/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"slimhazard","id":6084911,"node_id":"MDQ6VXNlcjYwODQ5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/6084911?v=4","gravatar_id":"","url":"https://api.github.com/users/slimhazard","html_url":"https://github.com/slimhazard","followers_url":"https://api.github.com/users/slimhazard/followers","following_url":"https://api.github.com/users/slimhazard/following{/other_user}","gists_url":"https://api.github.com/users/slimhazard/gists{/gist_id}","starred_url":"https://api.github.com/users/slimhazard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/slimhazard/subscriptions","organizations_url":"https://api.github.com/users/slimhazard/orgs","repos_url":"https://api.github.com/users/slimhazard/repos","events_url":"https://api.github.com/users/slimhazard/events{/privacy}","received_events_url":"https://api.github.com/users/slimhazard/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":4,"created_at":"2019-01-02T17:44:19Z","updated_at":"2019-01-03T15:26:27Z","closed_at":"2019-01-03T15:26:27Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I am trying to build the latest `libvmod-dynamic` module based on varnish 6.0.2 and tests 03 and 13 are failing.  I am building from c48be899f1f9078b67daf406ba3188fa4ca1a5bd on the 6.0 branch.\r\n```\r\n# varnishd -V\r\nvarnishd (varnish-6.0.2 revision 0458b54db26cfbea79af45ca5c4767c7c2925a91)\r\nCopyright (c) 2006 Verdens Gang AS\r\nCopyright (c) 2006-2018 Varnish Software AS\r\n```\r\n[test-suite.log](https://github.com/nigoroll/libvmod-dynamic/files/2721431/test-suite.log)\r\n","closed_by":{"login":"slimhazard","id":6084911,"node_id":"MDQ6VXNlcjYwODQ5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/6084911?v=4","gravatar_id":"","url":"https://api.github.com/users/slimhazard","html_url":"https://github.com/slimhazard","followers_url":"https://api.github.com/users/slimhazard/followers","following_url":"https://api.github.com/users/slimhazard/following{/other_user}","gists_url":"https://api.github.com/users/slimhazard/gists{/gist_id}","starred_url":"https://api.github.com/users/slimhazard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/slimhazard/subscriptions","organizations_url":"https://api.github.com/users/slimhazard/orgs","repos_url":"https://api.github.com/users/slimhazard/repos","events_url":"https://api.github.com/users/slimhazard/events{/privacy}","received_events_url":"https://api.github.com/users/slimhazard/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/44/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/44/timeline","performed_via_github_app":null,"state_reason":"completed"},{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/45","repository_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/45/labels{/name}","comments_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/45/comments","events_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/45/events","html_url":"https://github.com/nigoroll/libvmod-dynamic/issues/45","id":395938107,"node_id":"MDU6SXNzdWUzOTU5MzgxMDc=","number":45,"title":"Worker crashing when calling std.healthy on dynamic director","user":{"login":"b3k","id":903674,"node_id":"MDQ6VXNlcjkwMzY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/903674?v=4","gravatar_id":"","url":"https://api.github.com/users/b3k","html_url":"https://github.com/b3k","followers_url":"https://api.github.com/users/b3k/followers","following_url":"https://api.github.com/users/b3k/following{/other_user}","gists_url":"https://api.github.com/users/b3k/gists{/gist_id}","starred_url":"https://api.github.com/users/b3k/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/b3k/subscriptions","organizations_url":"https://api.github.com/users/b3k/orgs","repos_url":"https://api.github.com/users/b3k/repos","events_url":"https://api.github.com/users/b3k/events{/privacy}","received_events_url":"https://api.github.com/users/b3k/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"nigoroll","id":1528104,"node_id":"MDQ6VXNlcjE1MjgxMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1528104?v=4","gravatar_id":"","url":"https://api.github.com/users/nigoroll","html_url":"https://github.com/nigoroll","followers_url":"https://api.github.com/users/nigoroll/followers","following_url":"https://api.github.com/users/nigoroll/following{/other_user}","gists_url":"https://api.github.com/users/nigoroll/gists{/gist_id}","starred_url":"https://api.github.com/users/nigoroll/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nigoroll/subscriptions","organizations_url":"https://api.github.com/users/nigoroll/orgs","repos_url":"https://api.github.com/users/nigoroll/repos","events_url":"https://api.github.com/users/nigoroll/events{/privacy}","received_events_url":"https://api.github.com/users/nigoroll/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"nigoroll","id":1528104,"node_id":"MDQ6VXNlcjE1MjgxMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1528104?v=4","gravatar_id":"","url":"https://api.github.com/users/nigoroll","html_url":"https://github.com/nigoroll","followers_url":"https://api.github.com/users/nigoroll/followers","following_url":"https://api.github.com/users/nigoroll/following{/other_user}","gists_url":"https://api.github.com/users/nigoroll/gists{/gist_id}","starred_url":"https://api.github.com/users/nigoroll/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nigoroll/subscriptions","organizations_url":"https://api.github.com/users/nigoroll/orgs","repos_url":"https://api.github.com/users/nigoroll/repos","events_url":"https://api.github.com/users/nigoroll/events{/privacy}","received_events_url":"https://api.github.com/users/nigoroll/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":2,"created_at":"2019-01-04T14:09:35Z","updated_at":"2019-03-22T10:23:43Z","closed_at":"2019-03-22T10:23:43Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hi,\r\n\r\nWe have problems with crashing worker, it works fine until cache is fresh, when it's stale then crash occures, looks like the problem is in vcl_hit():\r\n\r\n```vcl\r\nsub vcl_hit {\r\n if (obj.ttl >= 0s) {\r\n    # If object is fresh everything works\r\n    return (deliver);\r\n  }\r\n  # if object is not fresh it crash here:\r\n  if (std.healthy(req.backend_hint)) {\r\n    if (obj.ttl + 10s > 0s) {\r\n      return (deliver);\r\n    } else {\r\n      return(miss);\r\n    }\r\n  } else {\r\n      if (obj.ttl + obj.grace > 0s) {\r\n      return (deliver);\r\n    } else {\r\n      return (miss);\r\n    }\r\n  }\r\n}\r\n```\r\n\r\npanic.show dump:\r\n```\r\nPanic at: Fri, 04 Jan 2019 13:55:23 GMT                                                                                                                                                                                [301/1873]\r\nWrong turn at cache/cache_director.c:284:                                                      \r\nWrong admin health                                                \r\nversion = varnish-6.0.2 revision 0458b54db26cfbea79af45ca5c4767c7c2925a91, vrt api = 7.0\r\nident = Linux,4.14.56+,x86_64,-junix,-smalloc,-sdefault,-hcritbit,epoll                     \r\nnow = 6044301.424466 (mono), 1546610123.991261 (real)                                                                                                             \r\nBacktrace:                                                        \r\n  0x5555b6827e77: /usr/sbin/varnishd(+0x4be77) [0x5555b6827e77]                                         \r\n  0x5555b688f9d0: /usr/sbin/varnishd(VAS_Fail+0x40) [0x5555b688f9d0]                        \r\n  0x5555b680d790: /usr/sbin/varnishd(VRT_Healthy+0) [0x5555b680d790]                           \r\n  0x5555b680d7c4: /usr/sbin/varnishd(VRT_Healthy+0x34) [0x5555b680d7c4]    \r\n  0x7f1e2fc4dc47: vcl_new.1546610095.661100/vgc.so(VGC_function_vcl_hit+0x87) [0x7f1e2fc4dc47]\r\n  0x5555b683a505: /usr/sbin/varnishd(+0x5e505) [0x5555b683a505]                             \r\n  0x5555b683c4cd: /usr/sbin/varnishd(VCL_hit_method+0x5d) [0x5555b683c4cd]                     \r\n  0x5555b682be4e: /usr/sbin/varnishd(+0x4fe4e) [0x5555b682be4e]                             \r\n  0x5555b682d119: /usr/sbin/varnishd(CNT_Request+0xde9) [0x5555b682d119]    \r\n  0x5555b68526fa: /usr/sbin/varnishd(+0x766fa) [0x5555b68526fa]                                   \r\nthread = (cache-worker)                                                                                                                                                                                                          \r\nthr.req = 0x7f1e2f23e020 {                                                                                                                                                                                                       \r\n  vxid = 27, transport = HTTP/1 {                                                                                                                                                                                                \r\n    state = HTTP1::Proc                                                                                                                                                                                                          \r\n  }                                                                                                                                                                                                                              \r\n  step = R_STP_LOOKUP,                                                                                                                                                                                                           \r\n  req_body = R_BODY_NONE,\r\n  restarts = 0, esi_level = 0,\r\n  sp = 0x7f1e2f097420 {\r\n    fd = 21, vxid = 26,\r\n    t_open = 1546610123.988345,\r\n    t_idle = 1546610123.988345,\r\n    ws = 0x7f1e2f097460 {\r\n      id = \\\"ses\\\",\r\n      {s, f, r, e} = {0x7f1e2f097498, +96, (nil), +352},\r\n    },\r\n    transport = HTTP/1 {\r\n      state = HTTP1::Proc\r\n    }\r\n    client = 10.114.108.15 19332 0.0.0.0:80,\r\n  },\r\n  worker = 0x7f1e33978de0 {\r\n    ws = 0x7f1e33978e88 {\r\n      id = \\\"wrk\\\",\r\n      {s, f, r, e} = {0x7f1e339783e0, +0, (nil), +2040},\r\n    },                                                                                                                                                                                                                 [259/1873]\r\n    VCL::method = inside HIT,\r\n    VCL::return = 0x0,\r\n    VCL::methods = {RECV, HASH, HIT},\r\n  },\r\n  ws = 0x7f1e2f23e170 {\r\n    id = \\\"req\\\",\r\n    {s, f, r, e} = {0x7f1e2f2400a8, +53552, (nil), +57168},\r\n  },\r\n  http_conn = 0x7f1e2f240048 {\r\n    fd = 21 (@0x7f1e2f097444),\r\n    doclose = NULL,\r\n    ws = 0x7f1e2f23e170 {\r\n      [Already dumped, see above]\r\n    },\r\n    {rxbuf_b, rxbuf_e} = {0x7f1e2f2400a8, 0x7f1e2f2414fb},\r\n    {pipeline_b, pipeline_e} = {(nil), (nil)},\r\n    content_length = -1,\r\n    body_status = none,\r\n    first_byte_timeout = 0.000000,\r\n    between_bytes_timeout = 0.000000,\r\n  },\r\n...\r\n```","closed_by":{"login":"nigoroll","id":1528104,"node_id":"MDQ6VXNlcjE1MjgxMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1528104?v=4","gravatar_id":"","url":"https://api.github.com/users/nigoroll","html_url":"https://github.com/nigoroll","followers_url":"https://api.github.com/users/nigoroll/followers","following_url":"https://api.github.com/users/nigoroll/following{/other_user}","gists_url":"https://api.github.com/users/nigoroll/gists{/gist_id}","starred_url":"https://api.github.com/users/nigoroll/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nigoroll/subscriptions","organizations_url":"https://api.github.com/users/nigoroll/orgs","repos_url":"https://api.github.com/users/nigoroll/repos","events_url":"https://api.github.com/users/nigoroll/events{/privacy}","received_events_url":"https://api.github.com/users/nigoroll/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/45/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/45/timeline","performed_via_github_app":null,"state_reason":"completed"},{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/46","repository_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic","labels_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/46/labels{/name}","comments_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/46/comments","events_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/46/events","html_url":"https://github.com/nigoroll/libvmod-dynamic/issues/46","id":423910933,"node_id":"MDU6SXNzdWU0MjM5MTA5MzM=","number":46,"title":"Sometimes vmod_dynamic stops refreshing DNS","user":{"login":"garadox","id":466469,"node_id":"MDQ6VXNlcjQ2NjQ2OQ==","avatar_url":"https://avatars.githubusercontent.com/u/466469?v=4","gravatar_id":"","url":"https://api.github.com/users/garadox","html_url":"https://github.com/garadox","followers_url":"https://api.github.com/users/garadox/followers","following_url":"https://api.github.com/users/garadox/following{/other_user}","gists_url":"https://api.github.com/users/garadox/gists{/gist_id}","starred_url":"https://api.github.com/users/garadox/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/garadox/subscriptions","organizations_url":"https://api.github.com/users/garadox/orgs","repos_url":"https://api.github.com/users/garadox/repos","events_url":"https://api.github.com/users/garadox/events{/privacy}","received_events_url":"https://api.github.com/users/garadox/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":443804426,"node_id":"MDU6TGFiZWw0NDM4MDQ0MjY=","url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/labels/invalid","name":"invalid","color":"e6e6e6","default":true,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":10,"created_at":"2019-03-21T19:46:46Z","updated_at":"2019-03-29T15:19:53Z","closed_at":"2019-03-29T15:19:07Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Even using `varnishlog -g raw -q '* ~ vmod-dynamic'` to watch logs of the DNS refresh occurring, I haven't managed to isolate a repeatable scenario where DNS stops being refreshed.\r\n\r\nWe have docker containers running centos 7 and varnish 4.1.8, and over time some of those containers will stop outputting logs for vmod-dynamic and the backend list will become stale. Eventually if undetected, the backend list has no healthy entries and varnish starts returning 503's.\r\n\r\nWe have found that killing the varnish child process or using varnishadm to reload the existing vcl is enough to fix the dns lookup and everything is good again.\r\n\r\nOne thing I will call out is that our DNS ttl is set to 10 seconds, as we're running in kubernetes and pods can go away pretty quickly.\r\n\r\nExample VCL:\r\n\r\n```\r\nvcl 4.0;\r\n\r\n    import std;\r\n    import directors;\r\n    import saintmode;\r\n    import dynamic;\r\n    import xkey;\r\n    import statsd;\r\n    import timers;\r\n    import vsthrottle;\r\n    import header;\r\n\r\n    # Default backend definition.\r\n    backend default {\r\n     .host = \"0.0.0.0\";\r\n     .port = \"80\";\r\n    }\r\n\r\n    probe default_probe {\r\n      .url = \"/test\";\r\n      .interval = 4s;\r\n      .timeout = 1s;\r\n      .window = 3;\r\n      .threshold = 2;\r\n      .initial = 2;\r\n    }\r\n\r\n    sub vcl_init {\r\n      new default_dir = dynamic.director(\r\n        port = \"5050\",\r\n        probe = default_probe,\r\n        ttl = 10s);\r\n\r\n      statsd.server( \"127.0.0.1\", \"8126\" );\r\n    }\r\n\r\n    \r\n    sub vcl_recv {\r\n      if ( req.method == \"GET\" || req.method == \"HEAD\" ) {\r\n        return(hash);\r\n      }\r\n    }\r\n\r\n    sub vcl_deliver {\r\n      if (obj.hits > 0) {\r\n        set resp.http.X-CACHE = \"hit\";\r\n      } else {\r\n        set resp.http.X-CACHE = \"miss\";\r\n      }\r\n      return (deliver);\r\n    }\r\n\r\n    sub vcl_backend_response {\r\n         set beresp.ttl = 2s;\r\n         set beresp.grace = 20s;\r\n         set beresp.keep = 2s;\r\n         if ( beresp.status == 200 || beresp.status == 400 || beresp.status == 404 ) {\r\n          # if s-maxage is not set then set some defaults\r\n          set beresp.ttl = 120s;\r\n          set beresp.grace = 2m;\r\n          set beresp.keep = 0s;\r\n         }\r\n       }\r\n       if (beresp.http.content-type ~ \"(text|json|xml|javascript)\" ) {\r\n           set beresp.do_gzip = true;\r\n       }\r\n    }\r\n\r\n    sub vcl_backend_fetch {\r\n      set bereq.backend = default_dir.backend(\"example-service\");\r\n\r\n      return (fetch);\r\n    }\r\n\r\n    sub vcl_backend_error {\r\n       set beresp.http.Content-Type = \"text/html; charset=utf-8\";\r\n       set beresp.http.Retry-After = \"5\";\r\n       synthetic( {\"<!DOCTYPE html>\r\n    <html>\r\n     <head>\r\n       <title>\"} + beresp.status + \" \" + beresp.reason + {\"</title>\r\n     </head>\r\n     <body>\r\n       <h1>Error \"} + beresp.status + \" \" + beresp.reason + {\"</h1>\r\n       <p>\"} + beresp.reason + {\"</p>\r\n       <h3>Redsky TX:</h3>\r\n       <p>X-REQUEST-ID: \"} + bereq.http.X-REQUEST-ID + {\"</p>\r\n       <hr>\r\n       <p>Redsky</p>\r\n     </body>\r\n    </html>\r\n    \"} );\r\n       return (deliver);\r\n    }\r\n\r\n```","closed_by":{"login":"nigoroll","id":1528104,"node_id":"MDQ6VXNlcjE1MjgxMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1528104?v=4","gravatar_id":"","url":"https://api.github.com/users/nigoroll","html_url":"https://github.com/nigoroll","followers_url":"https://api.github.com/users/nigoroll/followers","following_url":"https://api.github.com/users/nigoroll/following{/other_user}","gists_url":"https://api.github.com/users/nigoroll/gists{/gist_id}","starred_url":"https://api.github.com/users/nigoroll/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nigoroll/subscriptions","organizations_url":"https://api.github.com/users/nigoroll/orgs","repos_url":"https://api.github.com/users/nigoroll/repos","events_url":"https://api.github.com/users/nigoroll/events{/privacy}","received_events_url":"https://api.github.com/users/nigoroll/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/46/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/nigoroll/libvmod-dynamic/issues/46/timeline","performed_via_github_app":null,"state_reason":"completed"}]